<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
  <title>Palmer's Penguins</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Penguins at Palmer Station Antarctica">
  <meta name="author" content="Justin Chill">
  <!-- OpenGraph tags -->
  <meta name="keywords" content="penguins, chart, graph, data viz, Palmer's Penguins">
  <meta name="robots" content="all">
  <meta content="en_US" property="og:locale">
  <meta content="website" property="og:type">
  <meta content="Palmer's Penguins" property="og:title">
  <meta content="Penguins at Palmer Station Antarctica." property="og:description">
  <meta property="og:image" content="https://public.tableau.com/static/images/Pe/PenguinsatPalmerStationAntarcticaLTER/Week28/4_3_hd.png" data-rh="true">
  <meta content="1200" property="og:image:width">
  <meta content="630" property="og:image:height">
  <meta content="Penguins at Palmer Station Antarctica" property="og:image:alt">
  <meta content="https://www.justinchill.com/blog.html" property="og:see_also">
  <link rel="canonical" href="https://www.justinchill.com/penguins.html">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Penguins at Palmer Station Antarctica">
  <meta name="twitter:description" content="Data visualization of penguins at Palmer Station Antarctica.">
  <meta name="twitter:image" content="https://public.tableau.com/static/images/Pe/PenguinsatPalmerStationAntarcticaLTER/Week28/4_3_hd.png">
  <meta name="twitter:image:width" content="800">
  <meta name="twitter:image:height" content="418">
  <meta name="twitter:image:alt" content="Penguins at Palmer Station Antarctica">

  <link type="text/plain" href="humans.txt" rel="author">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#4C63B6">

  <script type="module">
    document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('js');
  </script>

  <style type="text/css">
    p img {
      float: right;
      border-radius: 4px;
      padding: var(--spacer-1);
    }

    [aria-label="x-axis label"],
    [aria-label="y-axis label"] {
      font-size: 1rem;
    }

    #facets [aria-label="fx-axis tick label"],
    #islands [aria-label="fx-axis tick label"] g {
      font-size: 18.9px;
    }
    #waffle > figure > div > span {
      text-transform: lowercase; 
      /* CSS Capitalize is not working here?  */
    }
  </style>
</head>

<body>
  <nav class="nav" role="navigation">
    <div class="nav__list">
      <a href="index.html" class="nav__item" aria-label="Homepage">Home</a>
      <a href="blog.html" class="nav__item" aria-label="Blog section">Blog</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>

  <main role="main">
    <article>
      <div class="article-hero">
        <h2 class="article-category">Post</h2>
        <h1 class="article-title">Palmer's Penguins</h1>
        <h2 class="article-subtitle">Penguins at the Palmer Station Antarctica Long-Term Ecological Research site</h2>
      </div>
      <!-- <img src="https://impact.economist.com/ocean/images/macaroni-penguins-on-their-voyage?f=auto&w=1920" loading="lazy" alt="Macaroni Penguins on their voyage"> -->
      <figure id="map"></figure>
      <figcaption class="right">Research stations in Antarctica</figcaption>
      <p>The Palmer Penguins dataset contains size measurements, clutch observations, and blood isotope ratios for 344 penguins of 3 penguin species observed on three islands in the <strong>Palmer Archipelago</strong>, Antarctica over a study period of three years.</p>
      <p>This dataset is commonly used when introducing students to new data science concepts because it is easy to understand and work with. It contains variables such as island name (Dream, Torgersen, or Biscoe), species name (Adelie, Chinstrap, or Gentoo), bill length (mm), bill depth (mm), flipper length (mm), body mass (g), and sex.</p>
      <p>The canonical paper from Gorman et al. presents the research in detail<a href="#gorman" aria-describedby="footnote-label" id="gorman-ref"></a>. Palmer's Penguins is an alternative to the <a href="https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/iris.html">Iris</a> sample dataset.</p>
      <h2>Meet the penguins</h2>
      <img src="imgs/lter_penguins.png" alt="The Palmer Archipelago penguins. Artwork by @allison_horst.">
      <p>In the icy realm of Antarctica, there are seven magnificent types of penguins that call the frozen wilderness their home: Gentoo, King, Adélie, Chinstrap, Southern Rockhopper, Emperor, and Macaroni Penguins. Each of these penguin species possesses its own distinct characteristics, from size and coloration to unique adaptations that enable them to thrive in this harsh environment.</p>
      <p> While the <strong style="color: orangered">Gentoo</strong> penguin demonstrates impressive swimming abilities, the King Penguin claims the title of the second largest penguin species. <strong style="color: blue">Adélie</strong> penguins, on the other hand, are known for their extensive range and their ability to survive in extreme cold with their thick layer of fat. The <strong style="color: orange">Chinstrap</strong> penguin reveals its feisty side, amidst the freezing waters it calls its playground. Southern Rockhopper penguins display their striking yellow eyebrows and complex hunting behaviors. Emperor Penguins, the heavyweight champions, have developed extraordinary adaptations to endure the most extreme conditions. Lastly, the Macaroni penguins show off their distinctive crests and large breeding colonies, although their numbers unfortunately continue to decline. For these incredible creatures, vulnerable to the effects of climate change and human activities, conservation efforts now play a crucial role in ensuring their survival.</p>
      <aside>Fun fact! The <a href="https://wiki.gentoo.org/wiki/FAQ">Gentoo</a> Linux distribution is named after this penguin species &#129299;</aside>
      <h3>Bill length vs. body mass</h3>
      <figure id="facets" class=""></figure>
      <figcaption>Source: Structural size measurements and isotopic signatures</figcaption>
      <p>The data included in <em>Palmer's Penguins</em> were collected from 2007 - 2009 by Dr.&nbsp;Kristen Gorman with the <a href="https://pal.lternet.edu/" class="external-link">Palmer Station Long Term Ecological Research Program</a>, part of the <a href="https://lternet.edu/" class="external-link">US Long Term Ecological Research Network</a>.<img src="imgs/penguin-bill.jpg" loading="lazy" class="float-right" alt="Inset clarifying that in the raw data, bill dimensions are recorded as 'culmen length' and 'culmen depth'. The culmen is the dorsal ridge atop the bill."></p>
      <p>At the Palmer Station, three species of Penguins were measured on various structural aspects like body mass, bill Length, bill depth and flipper length. PAL scientists have documented an 85 percent reduction in Adélie penguin populations along the western Antarctic Peninsula since 1974.</p>
      <h3>Penguins by island</h3>
      <figure id="islands"></figure>
      <figcaption>Source: <a href="https://environmentaldatainitiative.org/">Environmental Data Initiative</a></figcaption>
      <p>The penguins were studied on three islands: Biscoe, Dream, and Torgersen.</p>
      <p>Most penguins spend the majority of their life at sea and return to land to reproduce. Getting to and from their reproductive areas (called rookeries) on land can be quite a walk but when there is snow to traverse, they often sled downhill to make quick descents.</p>
      <p>Penguins are unique birds in that they do not fly. Their wings are adapted as swimming flippers by their wing bones being flattened and rather solidly joined so that they are very useful for swimming (up to 30 miles per hour). Penguins often look like they are flying when viewed under water.</p>
      <figure id="waffle" class=""></figure>
      <p>The Adelie penguin (<em>Pygoscelis adeliae</em>) was named after the wife of one of the early Antarctic explorers (Dumont D'Urville). This small penguin (rarely over 11 pounds) nests on rocky areas that are free of snow in the summer. Adults return to the same rookery (nesting area) where they were born and build nests out of pebbles. The giving of pebbles to the female by the male is part of the nesting courtship. Nesting pairs may stay together for six years although each year about half the birds change their mate. Eggs are laid in November and chicks hatch in December. The females lay two eggs and the parents take turns incubating the eggs. When they hatch they are fed by the parents who take turns both feeding and watching the chicks very closely for their first several weeks. Unattended chicks are vulnerable to predators, especially the Skua. The rookeries are busy places as parents attend their chicks keeping them well fed, protected, and their nests in order.</p>      
      <p>The <strong style="color: blue">Adelies</strong> have an all black head. After only four weeks, the chicks molt their charcoal downy coat and grow the dense, waterproof feathers that allow them to leave the rookery and begin their lives feeding for themselves.</p>
      <h3>Bill Length vs. Bill Depth</h3>
      <figure id="scatter" class=""></figure>
      <figcaption>Source: Structural size measurements and isotopic signatures</figcaption>
      <p>With a distinctive thin black stripe under their chin, the <strong style="color: orange">chinstrap</strong> penguin resembles the numerous Adelie penguins but is easily distinguished by their "chinstrap." These penguins also feed on krill. They are scientifically named <em>Pygoscelis antarctica</em>. Their chicks take about nine weeks before they are ready to go to sea. Chinstraps are more aggressive than the Adelies in their breeding behavior.</p>
      <figure id="density" class=""></figure>
      <p>The colorful orange bill (and white spot on the head) of the <strong style="color: orangered">gentoo</strong> penguin, <em>Pygoscelis papua</em>, sets them apart from other penguin species. Their breeding habits are similar to Adelies and chinstraps - they return to the same rookeries each year, building nests of pebbles on bare ground, and laying two eggs. The chicks are ready to go to sea at eight weeks but they return each evening to be fed by their parents for an additional two weeks.</p>
      <h3>Simpson's Paradox</h3>
      <figure id="regression"></figure>
      <p>If you measure the relationship between culmen depth and length in a mixed population of penguins, it is <a href="https://observablehq.com/plot/marks/linear-regression">positively correlated</a> in each of the three species (bigger penguins with the longer culmens also tend to have the deeper ones); however, the <strong style="color: orangered">Gentoo</strong> population has a smaller aspect ratio of depth against length, and the overall correlation across the three species is negative. This is called <a href="https://en.wikipedia.org/wiki/Simpson%27s_paradox">Simpson’s paradox</a>, and it applies to any data that contains underlying populations with different properties or outcomes.</p>

      <h2>Penguins and Climate Change</h2>
      <p>Climate change has significant implications for penguin species in Antarctica. One of the most immediate impacts is the reduction of sea ice, which many penguins rely on for breeding and foraging. Changes in sea ice patterns disrupt the availability of suitable nesting sites and can lead to higher chick mortality rates. Additionally, declining sea ice affects the distribution of prey species, making it more challenging for penguins to find food.</p>
      <h3>Effects on Penguin Populations</h3>
      <p>Climate change also has indirect effects on penguin populations through altering predator-prey dynamics and causing shifts in ecosystem balance. The decline of krill, a crucial food source for many penguin species, can lead to population declines and decreased reproductive success. Rising sea temperatures and ocean acidification further compound the challenges facing penguins, as they are highly sensitive to these changes.</p>
      <h3>Conservation Efforts</h3>
      <p>Conservation efforts are essential to mitigating the impacts of climate change on penguin populations. Establishing marine protected areas and implementing sustainable fishing practices can help protect critical foraging grounds and prey species. Monitoring and research programs can provide valuable data on the status and trends of penguin populations, enabling informed conservation strategies. Education and awareness campaigns can also encourage public support and involvement in penguin conservation.</p>
      <h3>Penguin body mass</h3>
      <figure id="weightBars"></figure>
      <figcaption>Source: <a href="https://environmentaldatainitiative.org/">Environmental Data Initiative</a></figcaption>
      <h2>Challenges Facing Antarctic Penguins</h2>
      <h3>Human Activities and Penguin Conservation</h3>
      <p>Human activities in Antarctica, such as tourism, scientific research, and fishing, can have significant impacts on penguin populations. Disturbance from human presence can disrupt breeding and nesting behaviors, leading to lower reproductive success. It is important to establish guidelines and regulations to minimize these disturbances and ensure responsible tourism practices. Research and monitoring can also help identify areas of concern and inform management decisions to protect penguin habitats.</p>
      <h3>Overfishing and Competition for Food</h3>
      <p>Overfishing in the Southern Ocean poses a significant threat to penguins, as it depletes their main food sources, such as krill and fish. Penguins compete with commercial fisheries for limited resources, potentially affecting their breeding success and overall population health. Implementing sustainable fishing practices and setting catch limits can help mitigate the impacts of overfishing on penguin populations.</p>
      <h3>Pollution and Habitat Destruction</h3>
      <p>Pollution, such as oil spills and marine debris, can have devastating effects on penguins and their habitats. Oil spills, in particular, can contaminate their feathers, impairing their waterproofing abilities and exposing them to hypothermia. Habitat destruction, including the degradation of nesting sites and pollution of breeding grounds, further threatens penguin populations. Strict regulations and protocols to prevent pollution and ecological damage are crucial to protect penguin habitats and ensure their long-term survival.</p>
      <div class="videoContainer">
        <video controls="" height="360" id="sunVideo" poster="https://antarcticsun.usap.gov/science/images8/lteranniversary-banner.jpg" preload="none" width="100%">
          <source src="/science/images8/lteranniversary.mp4" type="video/mp4">
          <source src="https://antarcticsun.usap.gov/science/images8/lteranniversary.mp4" type="video/webm">
        </video>

        <div id="videoButton" style="visibility: visible;">&nbsp;</div>

        <div class="videoText visually-hidden">Produced by Lauren Lipuma for the U.S. Antarctic Program. This animation shows how the populations of Adélie, Chinstrap, and Gentoo penguins around Anvers Island have changed from 1980 to 2020. One penguin represents 500 breeding pairs. Data courtesy of Bill Fraser. Numbers of penguins are estimates.</div>
      </div>
      <img src="https://impact.economist.com/ocean/images/more-penguins?f=auto&w=1920" loading="lazy" alt="Two king penguins face each other on a sandy beach near the ocean.">
      <h2>References</h2>
      <p>Individual data can be accessed directly via the <a href="https://environmentaldatainitiative.org/">Environmental Data Initiative</a>:</p>
      <ul>
        <li>
          <p>Palmer Station Antarctica LTER and K. Gorman, 2020. Structural size measurements and isotopic signatures of foraging among adult male and female Adélie penguins (<em>Pygoscelis adeliae</em>) nesting along the Palmer Archipelago near Palmer Station, 2007-2009 ver 5. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/98b16d7d563f265cb52372c8ca99e60f">doi.org</a>.</p>
        </li>
        <li>
          <p>Palmer Station Antarctica LTER and K. Gorman, 2020. Structural size measurements and isotopic signatures of foraging among adult male and female Gentoo penguin (<em>Pygoscelis papua</em>) nesting along the Palmer Archipelago near Palmer Station, 2007-2009 ver 5. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/7fca67fb28d56ee2ffa3d9370ebda689">doi.org</a>.</p>
        </li>
        <li>
          <p>Palmer Station Antarctica LTER and K. Gorman, 2020. Structural size measurements and isotopic signatures of foraging among adult male and female Chinstrap penguin (<em>Pygoscelis antarcticus</em>) nesting along the Palmer Archipelago near Palmer Station, 2007-2009 ver 6. Environmental Data Initiative. <a href="https://doi.org/10.6073/pasta/c14dfcfada8ea13a17536e73eb6fbe9e">doi.org</a>.</p>
        </li>
      </ul>
      <img src="https://education.rstudio.com/blog/2020/07/palmerpenguins-cran/antarctica-map.png" alt="3 study sites on a map of Antarctic Peninsula">
    </article>
  </main>
  <footer>
    <h2 id="footnote-label">Footnotes</h2>
    <ol>
      <li id="gorman"><a href="https://doi.org/10.1371/journal.pone.0090081">Kristen Gorman, Tony Williams, William Fraser, <i>Ecological sexual dimorphism and environmental variability within a community of Antarctic penguins (genus Pygoscelis)</i> </a>.<a href="#gorman-ref" aria-label="Back to content">↩</a></li>
    </ol>

    <div>
      <p>Justin Chill &copy; 2025. Thanks&nbsp;for&nbsp;reading!</p>
      <span><a href="https://github.com/JustinChill/JustinChill.github.io" target="_blank"><img src="imgs/github.svg" alt="GitHub logo" class="icon">Source code</a></span>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/d3"></script>
  <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/2.5.1/d3-annotation.min.js" integrity="sha512-iBAeBWWWFb8HqSBcrqcz98iIpuVH1la39dEYHtyQ/pGpeCQTQVvLJOWAuhv2Q7JSHp9k7hWA7sGxU3hHJe+tFg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/topojson@3.0.2/dist/topojson.min.js"></script>

  <script>
    var element = d3.select('figure').node();
    var width = element.getBoundingClientRect().width; // get width of article so graphic is responsive
    var size = 12;

    // Use Promises to async request data
    // Todo remove "State laws" from .csv
    var promises = [d3.csv("data/penguins.csv", d3.autoType), d3.json("data/geo/land.json"), ];

    myDataPromises = Promise.all(promises);

    // After data is successfully fetched, generate viz
    myDataPromises.then(function(data) {
      // Define the data. There's gotta be a better way to do this:
      var penguins = data[0];
      var land = data[1];

      var scatter = {
        width: width,
        marginRight: 0,
        style: {
          fontSize: size,
          paddingBottom: "1rem",
          paddingRight: 10,
        },
        grid: true,
        nice: true,
        x: {
          nice: true,
          domain: [30,60],
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 45,
          frameAnchor: "left",
          label: "Culmen length (mm)",
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d3.format('3,')(d)}mm` : d), // Format last tick only
          // labelArrow: null,
        },
        y: {
          nice: true,
          domain: [12,22],
          ticks: 4,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 50,
          frameAnchor: "left",
          label: "Culmen depth (mm)",
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d3.format('3,')(d)}mm` : d), // Format first tick only
          // labelArrow: null,
        },
        color: {
          legend: true
        },
        marks: [
          Plot.frame({
            stroke: "hsl(209, 23%, 60%)",
            strokeOpacity: .35
          }),
          Plot.dot(penguins, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm",
            stroke: "species"
          }),
          Plot.density(penguins, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm",
            fill: "species",
            fillOpacity: 0.05
          })
        ]
      };

      var facets = {
        width: width,
        marginRight: 0,
        style: {
          fontSize: size,
          paddingLeft: "2.2rem",
          paddingBottom: "1rem",
        },
        grid: true,
        nice: true,
        inset: 10,
        color: {
          legend: false
        },
        facet: {
          data: penguins,
          x: "species",
          label: null,
        },
        x: {
          nice: true,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 40,
          frameAnchor: "bottom",
          label: "Culmen length (mm)",
          labelArrow: null,
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d}mm` : d), // Format last tick only
        },
        y: {
          nice: true,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 75,
          frameAnchor: "left",
          label: "Body mass",
          labelArrow: null,
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d3.format('3,')(d)} grams` : d), // Format first tick only
        },
        marks: [
          Plot.frame({
            stroke: "hsl(209, 23%, 60%)",
            strokeOpacity: .35
          }),
          Plot.linearRegressionY(penguins, {
            x: "culmen_length_mm",
            y: "body_mass_g",
            stroke: "currentColor",
            ci: .99,
            strokeDasharray: [4, 8],
            strokeOpacity: .25,
          }),
          Plot.dot(penguins, {
            x: "culmen_length_mm",
            y: "body_mass_g",
            stroke: "species",
            symbol: "sex",
            tip: {
              opacity: 0.9,
              textPadding: 10,
              lineHeight: 1.65,
              fontSize: size
            },
          }),
        ]
      };

      var density = {
        height: 300,
        width: width,
        marginRight: 0,
        style: {
          fontSize: size,
          paddingLeft: 10,
        },
        y: {
          axis: null
        },
        x: {
          nice: true,
          label: "Culmen length (mm)"
        },
        fy: {
          domain: ["FEMALE", "MALE"],
          label: null
        }, // excludes N/A
        color: {
          legend: true
        },
        facet: {
          data: penguins,
          y: "sex"
        },
        marks: [
          Plot.areaY(
            penguins,
            Plot.binX({
                y2: "proportion"
              }, // using y2 to avoid areaY’s implicit stacking
              {
                x: "culmen_length_mm",
                fill: "species",
                fillOpacity: 0.1,
                thresholds: 10,
                curve: "natural"
              }
            )
          ),
          Plot.ruleY([0]),
          Plot.lineY(
            penguins,
            Plot.binX({
              y: "proportion"
            }, {
              x: "culmen_length_mm",
              stroke: "species",
              thresholds: 10,
              curve: "natural"
            })
          )
        ]
      }

      var waffle = {
        width: width,
        style: {
          fontSize: width > 450 ? size : size - 1,
        },
        marginLeft: 60,
        marginRight: 60,
        grid: true,
        y: {label: null, tickSize: 0},
        fy: {label: null},
        color: {
          legend: true, 
          range: ["hsl(360, 91%, 69%)", "hsl(245, 79%, 52%)", "rgba(226, 226, 226, .85)"]
        },
        x: {
          nice: true,
          // tickSize: 0,
          labelAnchor: "center",
          labelOffset: 40,
          frameAnchor: "bottom",
          label: "Count",
          labelArrow: null,
          // tickFormat: (d, i, _) => (i === _.length - 1 ? `${d}mm` : d), // Format last tick only
        },
        marks: [
          Plot.barX(penguins, Plot.groupY({x: "count"}, {fy: "species", y: "island", fill: "sex", tip: true})),
          Plot.text([`While Chinstrap and Gentoo penguins were each observed on only one island, Adelie penguins were observed on all three islands.`], {
            fy: ["Adelie"],
            frameAnchor: "top-right",
            lineWidth: 18,
            dx: -6,
            dy: 6
          }),
          Plot.frame()
        ]
      }

      var regression = {
        width: width,
        marginRight: 0,
        style: {
          fontSize: size,
          textTransform: "capitalize",
          paddingBottom: "1rem",
          paddingRight: 10,
          paddingLeft: 20,
        },
        x: {
          nice: true,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 40,
          frameAnchor: "bottom",
          label: "Culmen length (mm)",
          // labelArrow: null,
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d}mm` : d), // Format last tick only
        },
        y: {
          nice: true,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 55,
          frameAnchor: "left",
          label: "Culmen depth (mm)",
          // labelArrow: null,
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d3.format('3,')(d)} grams` : d), // Format first tick only
        },
        grid: true,
        color: {
          legend: true
        },
        marks: [
          Plot.frame({
            stroke: "hsl(209, 23%, 60%)",
            strokeOpacity: .35
          }),
          Plot.dot(penguins, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm",
            fill: "species"
          }),
          Plot.linearRegressionY(penguins, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm",
            stroke: "species"
          }),
          Plot.linearRegressionY(penguins, {
            x: "culmen_length_mm",
            y: "culmen_depth_mm"
          })
        ]
      };

      var islands = {
        width: width,
        marginRight: 0,
        style: {
          fontSize: size,
          textTransform: "capitalize",
          paddingLeft: "2.2rem",
        },
        symbol: {
          legend: true
        },
        facet: {
          data: penguins,
          x: "island",
          label: null
        },
        x: {
          nice: true,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 40,
          frameAnchor: "bottom",
          label: "Flipper length (mm)",
          labelArrow: null,
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d}mm` : d), // Format last tick only
        },
        y: {
          nice: true,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 75,
          frameAnchor: "left",
          label: "Body mass (g)",
          labelArrow: null,
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d3.format('3,')(d)} grams` : d), // Format first tick only
        },
        grid: true,
        marks: [
          Plot.frame({
            stroke: "hsl(209, 23%, 60%)",
            strokeOpacity: .35
          }),
          Plot.dot(penguins, {
            x: "flipper_length_mm",
            y: "body_mass_g",
            fill: "species",
            symbol: "species",
            opacity: 0.7,
            r: 4
          })
        ],
      };

      var weightBars = {
        width: width,
        marginRight: 0,
        style: {
          fontSize: size,
          paddingBottom: "1rem",
          paddingLeft: 10,
        },
        color: {
          legend: true,
        },
        x: {
          nice: true,
          tickSize: 0,
          labelAnchor: "center",
          labelOffset: 45,
          frameAnchor: "left",
          label: "Penguin body mass (grams)",
          tickFormat: (d, i, _) => (i === _.length - 1 ? `${d3.format('3,')(d)} grams` : d), // Format last tick only
          labelArrow: null,
        },
        y: {
          nice: true,
          ticks: 4,
          tickSize: 0,
          grid: true,
          labelAnchor: "center",
          labelOffset: 55,
          frameAnchor: "left",
          label: "Count",
          labelArrow: null,
        },
        marks: [
          Plot.frame({
            stroke: "hsl(209, 23%, 60%)",
            strokeOpacity: .35
          }),
          Plot.rectY(penguins,
            Plot.binX({
              y: "count"
            }, {
              x: "body_mass_g",
              thresholds: 30, // Updates bin number for histogram
              fill: "species"
            }))
        ]
      };

      // Adapting map from https://observablehq.com/d/8b4d860e5c277bf3
      var projection = ({
          width,
          height
        }) => d3.geoAzimuthalEquidistant()
        .rotate([0, 90])
        .translate([width / 2, height / 2])
        .scale(width)
        .clipAngle(40);
      var locations = [{
          name: "Palmer Research Station",
          lat: -64.7700000,
          lon: -64.0500000,
          comment: "The Palmer Research Station is where the below penguin study took place.",
          dx: -80,
          dy: -20
        },
        {
          name: "Great Wall Station",
          lat: -62.21667,
          lon: -58.96444,
          comment: "The Great Wall Station is the \nfirst Chinese research station \nin Antarctica and opened on \n20 February 1985.",
          dx: -80,
          dy: -20
        },
        {
          name: "Zhongshan Station",
          lat: -69.37333,
          lon: 76.37778,
          comment: "Zhongshan Station is the second \nChinese research station in Antarctica \n nd was opened on February 26, 1989.",
          dx: 170,
          dy: -80
        },
        {
          name: "Kunlun Station",
          lat: -80.25,
          lon: 77,
          comment: "Kunlun Station is the southernmost \nof four Chinese research stations \nin Antarctica. ",
          dx: -50,
          dy: -130
        },
        {
          name: "Taishan Station",
          lat: -73.85,
          lon: 76.9667,
          comment: "Taishan station serve as a \nrelay point between Kunlun \nstation and Zhongshan station.",
          dx: 150,
          dy: 150
        },
        {
          name: "Ross Sea Station",
          lat: -74.91667,
          lon: 163.7,
          comment: "The Ross Sea Station is China's \nfifth Antarctic research station, \nexpected to be completed in 2024.",
          dx: -150,
          dy: 50
        }
      ];
      var d3_annotation = d3.annotation();

      // Takes an SVG and using d3 + d3-annotation adds an annotation to the svg
      function doAnnotation(targetSVG, annotation, annotationType, textWrap = 120) {
        const makeAnnotations = d3_annotation
          .editMode(false)
          .notePadding(4)
          .type(annotationType ?? d3_annotation.annotationLabel)
          .annotations([annotation]);

        const renderAnnotation = () => {
          const svg = d3.select(targetSVG).append("svg");
          svg.attr(
            "style",
            "font: initial;text-anchor: initial; fill: red; font-family: Arial; font-size: 15px;"
          );
          svg.call(makeAnnotations);
        };

        // need to wait a tick for the dom to be rendered
        window.requestAnimationFrame(renderAnnotation);
      };

      var map = {
        width: width,
        projection: projection,
        height: 550,
        inset: 2,
        marks: [
          Plot.sphere({
            fill: "#F5FBFF",
            stroke: "#222",
            strokeWidth: 0.2
          }),
          Plot.graticule({
            opacity: 0.8
          }),
          Plot.geo(land, {
            fill: "#fffffe",
            stroke: "#222",
            strokeWidth: 0.5
          }),

          Plot.dot(locations, {
            x: "lon",
            y: "lat",
            r: 10,
            fill: "#DA70D6",
            fillOpacity: 0.6,
            stroke: "#222",
            strokeWidth: 1,
            tip: true,
            title: "comment"
          }),
          Plot.text(locations, Plot.selectFirst({
            x: "lon",
            y: "lat",
            dx: 12,
            dy: 12,
            text: "name",
            fill: "#222",
            stroke: "white",
            fillOpacity: 0.9,
            fontSize: size * 1.2,
            frameAnchor: "middle",
          })),
          Plot.text(locations, {
            filter: d => d.name != "Palmer Research Station" && d.name != "Zhongshan Station",
            x: "lon",
            y: "lat",
            dy: 12,
            dx: 5,
            text: "name",
            fill: "#222",
            stroke: "white",
            fillOpacity: 0.95,
            fontSize: size * 1.2,
            frameAnchor: "top",
          }),
          Plot.text(locations, {
            filter: d => d.name == "Zhongshan Station",
            x: "lon",
            y: "lat",
            dy: -12,
            // dx: 2,
            text: "name",
            fill: "#222",
            stroke: "white",
            fillOpacity: 0.95,
            fontSize: size * 1.2,
            frameAnchor: "bottom",
          }),
          // Plot.arrow(locations, Plot.selectFirst({
          //   x1: "lon",
          //   y1: "lat",
          //   y2: "lon",
          //   // y2: d => d.lat+20,
          //   bend: true,
          //   stroke: "red",
          //   strokeWidth: 2,
          // })),
        ]
      };

      // Nice scatter plot to recreate: https://observablehq.com/d/7e3742f5f8e13db9

      document.getElementById("scatter").appendChild(Plot.plot(scatter));
      document.getElementById("facets").appendChild(Plot.plot(facets));
      document.getElementById("waffle").appendChild(Plot.plot(waffle));
      document.getElementById("density").appendChild(Plot.plot(density));
      document.getElementById("regression").appendChild(Plot.plot(regression));
      document.getElementById("islands").appendChild(Plot.plot(islands));
      document.getElementById("weightBars").appendChild(Plot.plot(weightBars));
      document.getElementById("map").appendChild(Plot.plot(map));
    });
  </script>
</body>

</html>