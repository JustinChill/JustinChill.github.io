<!DOCTYPE html>
<html lang="en">
<head>
	<title>Charts</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="style.css" />
  <script src="script.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Charts and data">
  <meta name="author" content="Justin Chill">

  <style type="text/css">
  article > img {
    /*width: auto;*/
    margin: 0 auto; 
  }
  figure .plot{
    margin: 0 auto;
    overflow: visible;
  }
  .plot text {
    color: #656568;
    font-family: 'Ubuntu', sans-serif;
    /*font-size: calc(5px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));*/
    padding: 2rem;
  }
  figcaption, figcaption > a {
    margin-bottom: 0;
    font-size: calc(8px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
  }
  ul > li {
    position: relative;
    padding-left: 1em;
    list-style: none;
    text-align: left;
  }
  .alignLeft{
    text-align: left;
  }
  ol {
    padding-left: 1em;
  }
  ul > li:before{
    content: "";
    position: absolute;
    background-color: #cbd5e0;
    border-radius: 50%;
    width: .375em;
    height: .375em;
    top: .6875em;
    left: .25em;
  }
  article > h2{
    margin: 2.2rem 0 0.4em 0;
  }
  article > h3{
    /*border-top: 0.1024rem solid hsl(12, 86%, 47%);*/
    font-size: calc(12px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
/*    margin-left: 5px;
margin-right: 5px;*/
margin: .5rem 5px 1rem;
display: flex;
align-items: center;
}
article > h3:before {
/*  content: '';
  display: inline-block;
  width: 10px;
  height: 30px;
  margin-right: .6250rem;
  background: hsl(12, 86%, 47%);*/
}

article > p + h3{
  margin-top: 2rem;
}

article > figure{
  margin: 0 auto;
}
article > figcaption{
  margin-bottom: 1rem;
  margin: 0 5px;
  text-align: right;
}

@media screen and (max-width: 680px) {
  article > h3{
    margin-left: 0;
    margin-right: 0;
  }
  .plot text {
    /*font-size: calc(6px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));*/
    padding: 1rem;
  }
  article > figure {
    grid-column: 1/-1;
    margin: 0;
  }
  article > figcaption{
    grid-column: 2/7;
  }
}
</style>
</head>
<body>
  <nav class="nav">
    <div class="nav__list">
      <a href="index.html" class="nav__item">Home</a>
      <a href="blog.html" class="nav__item">Blog</a>
      <a href="fun.html" class="nav__item">Fun</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>

  <main role="main">
    <article>
     <div class="article-hero">
      <h2 class="article-category">Post</h2>
      <h1 class="article-title">Common charts and graphs</h1>
      <h2 class="article-subtitle"></h2>
    </div>     

    <p>Presenting data in the form of a chart or graph makes identifying patterns and understanding difficult concepts easier. Visualizations of data can bring out insights to someone looking at the data for the first time, as well as convey findings to others who won’t see, or take the time to parse, the raw data.</p>
    <p>Deciding on which chart is best for your data will depend on multiple factors, such as:</p>
    <ul>
      <li><p>What are the types of metrics, features, or other variables that you plan on plotting? </p></li>
      <li><p>Who is the audience that you plan on presenting to – is it just an initial exploration for yourself, or are you presenting to a broader audience?</p></li>
      <li><p>What is the kind of conclusion that you want the reader to draw?</p></li>
    </ul>
    <p>In this article, we’ll look at frequently used charts and graphs to help you make the best choice for presenting your data.</p>
    <h2>Alluvial diagram</h2>
    <img src="https://datavizproject.com/wp-content/uploads/2015/11/Skærmbillede-2016-01-21-kl.-16.37.57.png">
    <p>The alluvial diagram is useful for showing changes over time across categories. The geometry is similar to a stacked area chart but with spacing and order changes. Alluvial diagrams are named after <a href="https://en.wikipedia.org/wiki/Alluvial_fan">alluvial fans</a> that are naturally formed by the soil deposited from streaming water.</p>
    <h2>Area chart</h2>
    <h3>Apple Inc. (AAPL) Closing Stock Price</h3>
    <figure id="apple_area"></figure>
    <figcaption>Data: <a href="https://observablehq.com/@observablehq/plot-area">Apple stock price</a></figcaption>
    <p>An area graph is a specialized form of the line graph, where data points are connected with a continuous line and the region below that line is filled with a solid color.</p>
    <h3>World electricity production, by source</h3>
    <figure id="electricity"></figure>
    <figcaption class="alignLeft">Data: <a href="https://ourworldindata.org/electricity-mix">Our World in Data</a></figcaption>
    <p>A stacked area chart stacks values so that the cumulative area represents 100%. These charts can help to show a progression and composition over time, and the 100% stacked area chart is meant to show the percentage that each component contributes when the cumulative total is not important.</p>
    <h2>Bar chart</h2>
    <h3>English letter frequency</h3>
    <figure id="example_bar"></figure>
    <figcaption>Data: <a href="http://pi.math.cornell.edu/~mec/2003-2004/cryptography/subs/frequencies.html">Cornell</a></figcaption>
    <p>The classic bar chart. The height (or length) of each bar is proportional to the values that they represent. The baseline starts at zero.</p>
    <h3>Global Emissions by Country</h3>
    <figure id="horizontal"></figure>
    <figcaption>Data: <a href="https://www.iea.org/articles/global-energy-review-co2-emissions-in-2020">IEA</a></figcaption>
    <!-- <h2>Bar chart race</h2> -->
    <h2>Barcode chart</h2>
    <h3>Surface temperature anomalies</h3>
    <!-- <figcaption id="anomaly_barcode_legend"></figcaption> -->
    <figure id="anomaly_barcode"></figure>
    <figcaption>Data: <a href="https://ourworldindata.org/grapher/hadcrut-surface-temperature-anomaly?tab=table">Our World in Data</a></figcaption>
    <p>A compact way to show a distribution, in a barcode chart line segments represent individual data points along a single axis.</p>
    <h2>Baseline chart</h2>
    <h3>Stock Price Comparison</h3>
    <figure id="stocks_baseline"></figure>
    <figcaption>Market Data: <a href="https://www.wsj.com/market-data">Wall Street Journal</a></figcaption>
    <p>A baseline chart uses a reference point, which becomes the baseline, to compare all the other categories to. In business, the success of a project or product is often measured against a <strong>baseline</strong> number for costs, sales, or other variables. A project may exceed a baseline number or fail to meet it.</p>
    <h2>Beeswarm</h2>
    <img src="https://flowingdata.com/wp-content/uploads/2021/06/hospital-billing-1536x1127.png">
    <p>A beeswarm chart is a one-dimensional chart- a chart that shows all the information on a single-axis (usually the X axis). It is similar to a strip plot, except that would-be overlapping points are separated such that each is visible. </p>
    <h2>Box plot</h2>
    <h3>Michaelson-Morley Speed of Light Data</h3>
    <figure id="morley"></figure>
    <figcaption>Data: <a href="http://stats4stem.weebly.com/r-morley-data.html">Morley dataset</a></figcaption>
    <p>Box plots, also called box-and-whisker plots or box-whisker plots, give a good graphical image of the concentration of the data. A box plot is constructed from five values: the minimum value, the first quartile, the median, the third quartile, and the maximum value. We use these values to compare how close other data values are to them.</p>
    <h2>Bubble chart</h2>
    <h3>Health and Wealth of Nations, 2007</h3>
    <figure id="gapminder"></figure>
    <figcaption>Data: <a href="https://www.gapminder.org/data/">GapMinder Foundation</a></figcaption>
    <p>A bubble chart is a variation of a scatter chart in which the data points are replaced with bubbles, and an additional dimension of the data is represented in the size of the bubbles. Just like a scatter chart, a bubble chart does not use a category axis — both horizontal and vertical axes are value axes. In addition to the x values and y values that are plotted in a scatter chart, a bubble chart also z (size) values.</p>
    <h2>Bullet chart</h2>
    <h3>Proportion of COVID-19 cases vs. share of population, by race</h3>
    <figure id="bullet"></figure>
    <figcaption>Data: <a href="https://covidtracking.com/race">The COVID Racial Data Tracker</a></figcaption>
    <p>A Bullet Graph is a variation of a Bar Graph. The main data value is encoded by a length of the main bar in the middle of the chart, known as the <b>Feature Measure</b>. The line marker that runs perpendicular to the orientation of the graph is known as the <b>Comparative Measure</b> and is used as a target marker to compare against the Feature Measure value. So if the main bar has passed the position of Comparative Measure, you know you’ve hit your goal.</p>
    <h2>Bump chart</h2>
    <h3>Changes in state population, 1920 - 2020</h3>
    <img src="https://flowingdata.com/wp-content/uploads/2021/05/population-shift-1536x1084.png">
    <figcaption>Image: <a href="https://www.washingtonpost.com/nation/interactive/2021/census-population-changes/">Washington Post</a></figcaption>
    <p>A bump chart is a chart that helps you identify the change in the performance rankings over time rather than the magnitude of the values of the elements (categories).</p>
    <h2>Cartogram</h2>
    <h3>Who can vote by mail?</h3>
    <img src="https://flowingdata.com/wp-content/uploads/2020/08/Cartogram-to-show-vote-by-mail-1536x1235.png">
    <figcaption>Image: <a href="https://www.nytimes.com/interactive/2020/08/11/us/politics/vote-by-mail-us-states.html">New York Times</a></figcaption>
    <p>Cartograms distort the shape of geographic regions so that the area directly encodes a data variable. A common example is to redraw every country in the world sizing it proportionally to population or GDP. Can be done by circles, squares or distorted maps by manipulating the initial map.</p>
    <h2>Candlestick Chart</h2>
    <h3>Apple Inc. (AAPL) Stock Price</h3>
    <figure id="candlestick"></figure>
    <figcaption>Data: <a href="https://observablehq.com/@observablehq/plot-area">Apple stock price</a></figcaption>
    <p>A candlestick chart is a style of bar-chart used to describe price movements of a security, derivative, or currency for a designated span of time. Each bar represents the range of price movement over a given time interval. The dataset for a candlestick chart contains low, high, open and close values. The high and low values are visualized as the top and bottom of each stick, where the open and close values are reflected in the square inside.</p>
    <h2>Chord diagram</h2>
    <a href="https://lotr.visualcinnamon.com/"><img src="https://uploads-ssl.webflow.com/5fa9d88da1855554db37b1e1/5fb1377b21d82ea1d953ef91_lotr_final.png"></a>
    <figcaption>Created by <a href="https://lotr.visualcinnamon.com">Nadieh Bremer</a></figcaption>
    <p>This type of diagram visualizes the inter-relationships between entities. The connections between entities are used to display that they share something in common. This makes Chord Diagrams ideal for comparing the similarities within a dataset or between different groups of data.</p>
    <h2>Choropleth map</h2>
    <img class="mid-size" src="imgs/ZIP3_zones.svg">
    <figcaption>ZIP codes explained <a href="inf-hoe-graphic.html">here</a></figcaption>
    <p>A choropleth map is simply a shaded map. Specifically, it's a map that uses measured differences in shading or color or the placing of symbols inside defined areas on the map in order to indicate the average values of some property or quantity in those areas. Be careful with your color choices, as they can quickly change what the map shows.</p>
    <h2>Connected scatter plot</h2>
    <h3>Driving shifts into reverse</h3>
    <figure id="driving_line"></figure>
    <figcaption class="alignLeft">Data: <a href="http://www.nytimes.com/imagepages/2010/05/02/business/02metrics.html">New York Times</a></figcaption>
    <p>A cross between a scatterplot and a time series. Show two variables over time.</p>
    <h2>Density plot</h2>
    <h3>Unemployment by industry</h3>
    <figure id="bls_line"></figure>
    <figcaption>Data: <a href="https://www.bls.gov/cew/downloadable-data-files.htm">U.S. Bureau of Labor Statistics</a></figcaption>
    <p>A density plot visualizes the distribution of data over a continuous interval or time period. This chart is a variation of a histogram that uses kernel smoothing to plot values, allowing for smoother distributions by smoothing out the noise. The peaks of a density plot help display where values are concentrated over the interval.</p>
    <h2>Difference chart</h2>
    <p>A difference chart highlights the difference between two values, typically entries vs exits. The amount is encoded as height, and the sign (surplus vs. deficit) as a solid color.</p>
    <h2>Donut chart 🍩</h2>
    <h3>United States Population, 2015</h3>
    <img src="imgs/donut_chart.svg">
    <figcaption>Data: <a href="https://www.census.gov/data.html">U.S. Census</a></figcaption>
    <p>A donut chart is a pie chart with an area of the center cut out. It looks like a donut. That’s why it’s called a donut chart.</p>
    <p>Pie Charts are sometimes criticized for focusing readers on the proportional areas of the slices to one another and to the chart as a whole. This makes it tricky to see the differences between slices, especially when you try to compare multiple Pie Charts together. A Donut Chart somewhat remedies this problem by de-emphasizing the use of the area. Instead, readers focus more on reading the length of the arcs, rather than comparing the proportions between slices.</p>
    <h2>Dot density map</h2>
    <img src="https://flowingdata.com/wp-content/themes/fd-modern-5-9/images/chart-types/dot-density-map.png">
    <p>Dots are placed randomly within regions to show the density of populations. The dots and spacing allow for multiple groups to be shown at once.</p>
    <h2>Dot map</h2>
    <img src="https://flowingdata.com/wp-content/themes/fd-modern-5-9/images/chart-types/dot-map.png">
    <p>Dot Maps are a way of detecting spatial patterns or the distribution of data over a geographical region, by placing equally sized points over a geographical region.</p>
    <h2>Dot plot</h2>
    <h3>Surface temperature anomalies</h3>
    <figure id="anomaly_dot"></figure>
    <figcaption>Data: <a href="https://ourworldindata.org/grapher/hadcrut-surface-temperature-anomaly?tab=table">Our World in Data</a></figcaption>
    <p>A generalized form of the scatter plot, the dots can be placed in various coordinate systems on an x- and y-axis. A dot plot is similar to a histogram in that it displays the number of data points that fall into each category or value on the axis, thus showing the distribution of a set of data.</p>
    <h2>Frequency trails</h2>
    <h3>Google search trends, 2020</h3>
    <figure id="google_ridgeline"></figure>
    <figcaption>Data: <a href="https://trends.google.com/trends/?geo=US">Google</a></figcaption>
    <!-- <img src="https://flowingdata.com/wp-content/uploads/2019/12/Interactive-frequency-trails.png"> -->
    <p>Area or line chart value axes overlap to fit more in a space and add another visual aspect to the magnitude of peaks. Also known as a ridgeline chart or a joyplot.</p>
    <h2>Gantt chart</h2>
    <img src="https://datavizcatalogue.com/methods/images/top_images/SVG/gantt_chart.svg">
    <p>Commonly used as an organisational tool for project management, Gantt Charts display a list of activities (or tasks) with their duration over time, showing when each activity starts and ends. This makes Gantt Charts useful for planning and estimating how long an entire project might take. You can also see what activities are running in parallel to each other.</p>
    <h2>Glyph chart</h2>
    <h3>Animals</h3>
    <figure id="animals"></figure>
    <figcaption>Data: The zoo</figcaption>
    <!-- <img src="https://visme.co/blog/wp-content/uploads/2017/05/How-to-Create-Pictographs-and-Icon-Arrays-in-Visme-4.jpg"> -->
    <p>Symbols are used and various dimensions represent different variables in a dataset.</p>
    <h2>Grid map</h2>
    <h3>Percent change in population from 2010 to 2019</h3>
    <!--     <figure id="gridmap"></figure> -->
    <img src="imgs/gridmap.png">
    <figcaption></figcaption> <!-- Recreation: https://observablehq.com/@zanarmstrong/us-grid-map-and-observable-plot -->
    <p>Instead of using geographic boundaries, same-size cells are used to represent areas to provide equal visual attention to all.</p>
    <h2>Heatmap</h2>
    <!--     <figure id="popcorn"></figure> -->
    <img src="https://flowingdata.com/wp-content/uploads/2019/04/Stephen-Curry-popcorn-scores.png">
    <p>Heatmaps visualize data through variations in colouring. When used in a tabular format, heatmaps are useful for cross-examining multivariate data, through placing variables in the rows and columns and colouring the cells within the table. Heatmaps are good for showing variance across multiple variables, revealing any patterns, displaying whether any variables are similar to each other, and for detecting if any correlations exist in-between them.</p>
    <h2>Histogram</h2>
    <h3>Apple Inc. (AAPL) Trading Volume</h3>
    <figure id="example_histogram"></figure>
    <figcaption class="alignLeft">Data: <a href="https://observablehq.com/@observablehq/plot-area">Apple stock price</a></figcaption>
    <p>A histogram looks like a bar chart, but it reads differently. The baseline is continuous instead of discrete categories, which allows one to see distributions. Histograms help give an estimate as to where values are concentrated, what the extremes are and whether there are any gaps or unusual values. They are also useful for giving a rough view of the probability distribution.</p>
    <h2>Horizon graph</h2>
    <img src="https://flowingdata.com/wp-content/uploads/2015/06/cost-horizon-reversed.png">
    <p>A horizon chart is like a combination area chart and heatmap. Shrink the area chart by slicing it horizontally, and then shift the slices to a baseline of zero.</p>
    <h2>Line chart</h2>
    <h3>My excitement levels as my girlfriend says...</h3>
    <figure id="example_line"></figure>
    <p>Typically used to show trends over time, the slope of the line between two points shows patterns of change. Line Graphs are drawn by first plotting data points on a Cartesian coordinate grid, then connecting a line between all of these points. Typically, the y-axis has a quantitative value, while the x-axis is a timescale or a sequence of intervals. Negative values can be displayed below the x-axis.</p>

    <p>The direction of the lines on the graph works as a nice metaphor for the data: an upward slope indicates where values have increased and a downward slope indicates where values have decreased. The line's journey across the graph can create patterns that reveal trends in a dataset.

    When grouped with other lines (other data series), individual lines can be compared to one another. However, avoid using more than 3-4 lines per graph, as this makes the chart more cluttered and harder to read. A solution to this is to divide the chart into smaller multiples (have a small Line Graph for each data series).</p>
    <h2>Mosaic plot</h2>
    <img src="https://datavizcatalogue.com/methods/images/top_images/marimekko_chart.png">
    <p>Also known as a Marimekko diagram, this chart uses the width and height of rectangles to represent separate variables. It can be useful to represent multidimensional data. The main flaws of Marimekko charts are that they can be hard to read, especially when there are many segments. Also, it’s hard to accurately make comparisons between each segment, as they are not all arranged next to each other along a common baseline. Therefore, Marimekko charts are better suited for giving a more general overview of the data.
    </p>
<!--     <h2>Moving bubbles</h2>
    <img src="https://technology.amis.nl/wp-content/uploads/2021/05/pack-circles_thumb.gif">
    <p>Making use of a <a href="https://technology.amis.nl/frontend/introduction-to-d3-force-for-simulation-and-animation/">force-directed</a> graph, bubbles move between different clusters to show grouping over time.</p>
  -->    <h2>Network graph</h2>
  <h3>The complete ARPANET, December 1969</h3>
  <figure id="network"></figure>
  <figcaption>Data: <a href="http://mercury.lcs.mit.edu/~jnc/tech/arpageo.html">MIT</a></figcaption>
  <p>This type of visualization shows how things are interconnected through the use of nodes / vertices and link lines. Typically, nodes are drawn as dots or circles, but icons can also be used. Links are usually displayed as lines connecting nodes. However, in more elaborate network diagrams, not all of the nodes and links are created equally: additional variables can be shown by making the node size or link stroke weight proportional to an assigned value.
  </p>    
  <h2>Organogram</h2>
  <img src="https://datavizcatalogue.com/methods/images/top_images/tree_diagram.png">
  <p>An organogram is an organizational chart that shows the structure of an organization and the relationships and relative ranks of its parts and positions/jobs. A variation is a tree diagram, which shows the different elements of a field of knowledge or a group of languages.</p>
  <h2>Packed bubble chart</h2>
  <img src="https://flowingdata.com/wp-content/uploads/2020/12/Defining-essential-worker-1536x1476.png">
  <figcaption>Data: <a href="https://www.nytimes.com/2020/12/05/health/covid-vaccine-first.html">New York Times</a></figcaption>
  <p>Circle size represents data like with a bubble chart, but there is typically no x-y axis. Instead, bubble position often represents grouping or is used to maximize space.</p>
  <h2>Parallel coordinates</h2>
  <img src="https://datavizcatalogue.com/methods/images/top_images/SVG/parallel_coordinates.svg">
  <p>In a parallel coordinates plot, each variable is given its own axis and all the axes are placed in parallel to each other. Each axis can have a different scale, as each variable works off a different unit of measurement, or all the axes can be normalized to keep all the scales uniform. Values are plotted as a series of lines that connected across all the axes. This means that each line is a collection of points placed on each axis, that have all been connected together.</p>
  <p>Parallel Coordinates Plots are ideal for comparing many variables together and seeing the relationships between them. For example, if you had to compare an array of products with the same attributes (comparing computer or cars specs across different models).</p>
  <h2>Parallel sets</h2>
  <img src="https://datavizcatalogue.com/methods/images/top_images/parallel_sets.png">
  <p>Parallel Set charts are similar to Sankey Diagrams in the way they show flow and proportions. However, Parallel Sets don’t use arrows and they divide the flow-path at each displayed line-set. Each line-set corresponds to a dimension/dataset, which its values/categories are represented in each line divide in that line-set. The width of each line and the flow-path that stems from it is determined by the proportional fraction of the category total. Each flow-path can be colored to show and compare the distribution between different categories.</p>
  <h2>Pictogram</h2>
  <h3>Phish set list, NYE 2019</h3>
  <img src="imgs/phish.svg">
  <figcaption>Data: <a href="https://observablehq.com/@mayagans/day-2-pictograms">Maya Gans</a></figcaption>
  <p>Pictogram Charts use icons to give a more engaging overall view of small sets of discrete data. Typically, the icons represent the data’s subject or category, for example, data on population would use icons of people. Each icon can represent one unit or any number of units (e.g. each icon represents 10). Data sets are compared side-by-side in either columns or rows of icons, to compare each category to one another.</p>
  <h2>Pie chart</h2>
  <h3>United States population, 2015</h3>
  <img src="imgs/pie_chart.svg">
  <figcaption>Data: <a href="https://www.census.gov/data.html">U.S. Census</a></figcaption>
  <p>Pie Charts help show proportions and percentages between categories, by dividing a circle into proportional segments. Each arc length represents a proportion of each category, while the full circle represents the total sum of all the data, equal to 100%.</p>
  <h2>Pyramid chart</h2>
  <h3>Population of Qatar, 2019</h3>
  <figure id="qatar_pyramid"></figure>
  <figcaption>Data: <a href="https://population.un.org/wpp/Download/Standard/Population/">World Population Prospects, U.N., 2019</a></figcaption>
  <p>A Population Pyramid chart is a pair of back-to-back Histograms (for each sex) that displays the distribution of a population in all age groups and in both sexes. The X-axis is used to plot population numbers and the Y-axis lists all age groups.</p>
  <h2>Radar chart</h2>
  <img src="https://datavizcatalogue.com/methods/images/top_images/radar_chart.png">
  <p>Radar charts, also known as as spider chart, web chart, polar chart, or star plots, are a way of comparing multiple quantitative variables. This makes them useful for seeing which variables have similar values or if there are any outliers among each variable. Radar Charts are also useful for seeing which variables are scoring high or low within a dataset, making them ideal for displaying performance.</p>
  <h2>Sankey diagram</h2>
  <img src="https://flowingdata.com/wp-content/uploads/2018/03/Black-boys-dropping-income-levels-1090x582.png">
  <figcaption>Data: <a href="https://www.nytimes.com/interactive/2018/03/19/upshot/race-class-white-and-black-men.html">New York Times</a></figcaption>
  <p>Sankey Diagrams display flows and their quantities in proportion to one another. Typically used to show the transfer of energy, money or materials, but they can be used to show the flow of any isolated process in a system. The width of the arrows or lines are used to show their magnitudes, so the bigger the arrow, the larger the quantity of flow. Flow arrows or lines can combine together or split through their paths on each stage of a process. Colour can be used to divide the diagram into different categories or to show the transition from one state of the process to another.</p>
  <h2>Scatter plot</h2>    
  <h3>The relative harm of drugs</h3>
  <figure id="drug_scatter"></figure>
  <figcaption class="alignLeft">Data: David Nutt for <a href="https://www.drugscience.org.uk">Drug Science</a></figcaption>
  <p>Also known as a scatter graph, point graph, X-Y plot, scatter chart or scattergram. Scatterplots use a collection of points placed using <a href="https://en.wikipedia.org/wiki/Cartesian_coordinate_system">Cartesian Coordinates</a> to display values from two variables. By displaying a variable on each axis, you can detect if a relationship or correlation between the two variables exists.</p>
  <h2>Slope chart</h2>
  <h3>Population change, 2019 to 2020</h3>
  <figure id="slope"></figure>
  <figcaption>Data: <a href="https://ourworldindata.org">Our World in Data</a></figcaption>
  <p>A slope chart highlights the change in rank or metric over two time periods.</p>
  <h3>4 decades of inequality</h3>
  <figcaption id="inequality"></figcaption>
  <figcaption class="alignLeft">Data: <a href="https://www.nytimes.com/2019/12/02/upshot/wealth-poverty-divide-american-cities.html">NYT</a></figcaption>
  <p>This chart shows the change of economic inequality, from 1980 to 2015 wages, along with population change in 195 metro areas. Read the full post <a href="inequality.html">here</a>.</p>    
  <h2>Small multiples</h2>
  <h3>Comparing MPG by vehicle type</h3>
  <figure id="mpg"></figure>
  <figcaption class="alignLeft">Data: <a href="https://ggplot2.tidyverse.org/reference/mpg.html">ggplot2 Fuel Economy Data</a></figcaption>
  <!-- <img src="https://nuitrcs.github.io/intro_to_viz_workshop/files/2context.png"> -->
  <p>Small multiples use the same basic graphic or chart to display different slices of a data set. Small multiples can show rich, multi-dimensional data without trying to cram all that information into a single, overly-complex chart. Small multiples go by many names, including Trellis Chart, Lattice Chart, Grid Chart, and Panel Chart. I would even argue that sparklines are a simpler, smaller cousin of small multiples.</p>
  <h2>Spiral chart</h2>
  <img src="https://datavizcatalogue.com/methods/images/top_images/PNG/spiral_plot.png">
  <p>This type of visualisation plots time-based data along an <a href="https://en.wikipedia.org/wiki/Archimedean_spiral">Archimedean spiral</a>. The graph begins at the centre of a spiral and then progresses outwards. Spiral Plots are versatile and can use bars, lines or points to be displayed along the spiral path.</p>
  <h2>Square pie chart</h2>
  <figure id="waffle"></figure>
  <figcaption>Data: I made this up 🙃</figcaption>
  <p>Square charts, also called waffle charts, are a form of pie charts that use squares instead of circles to represent percentages. Similar to basic circular pie charts, square pie charts take each percentage out of a total 100%. They are often 10 by 10 grids, where each cell represents 1%. Despite the name, circles, pictograms (such as of people), and other shapes may be used instead of squares. One major benefit to square charts is that smaller percentages, difficult to see on traditional pie charts, can be easily depicted.</p>
  <h2>Stacked area chart</h2>
  <h3>Unemployment by industry</h3>
  <figure id="bls_stacked"></figure>
  <figcaption>Data: <a href="https://www.bls.gov/cew/downloadable-data-files.htm">U.S. Bureau of Labor Statistics</a></figcaption>
  <p>Stacked area graphs work in the same way as regular area graphs, except for the use of multiple data series that start each point from the point left by the previous data series. The entire graph represents the total of all the data plotted. Stacked Area Graphs also use the areas to convey whole numbers, so they do not work for negative values. Overall, they are useful for comparing multiple variables changing over an interval.</p>
  <h2>Stacked bar chart</h2>
  <h3>Unemployment by industry</h3>
  <figure id="bls_bar"></figure>
  <figcaption>Data: <a href="https://www.bls.gov/cew/downloadable-data-files.htm">U.S. Bureau of Labor Statistics</a></figcaption>
  <p>Stacked Bar Graphs are used to show how a larger category is divided into smaller categories and what the relationship of each part has on the total amount.</p>
  <h3>Electricity production by source</h3>
  <figure id="stacked_hrz"></figure>
  <figcaption>Data: <a href="https://ourworldindata.org/electricity-mix">Our World in Data</a></figcaption>
  <h2>Stem and Leaf plot</h2>
  <h3>Caltrain’s Palo Alto station schedule</h3>
  <figure id="stem_plot"></figure>
  <figcaption>Data: <a href="https://www.caltrain.com/stations/paloaltostation.html">Caltrain</a></figcaption>
  <h2>Step chart</h2>    
  <h3>WeWork Valuation</h3>
  <figure id="wework"></figure>
  <figcaption>Data: <a href="https://craft.co/wework/funding-rounds">Craft.co</a></figcaption>
  <p>A step chart works like a line chart, but the values change immediately at the x-coordinate instead of being interpolated<a href="#interpolation" aria-describedby="footnote-label" id="interpolation-ref"></a> with a slope.</p>
  <h2>Streamgraph</h2>
  <h3>Unemployment by industry</h3>
  <figure id="streamgraph"></figure>
  <figcaption>Data: <a href="https://www.bls.gov/cew/downloadable-data-files.htm">U.S. Bureau of Labor Statistics</a></figcaption>
  <!-- <img src="https://datavizcatalogue.com/methods/images/top_images/SVG/stream_graph.svg"> -->
  <p>Stream Graphs display the changes in data over time of different categories through the use of flowing, organic shapes that somewhat resemble a river-like stream. This makes Stream Graphs aesthetically pleasing and more engaging to look at. In a Stream Graph, the size of each individual stream shape is proportional to the values in each category.</p>
  <h2>Strip plot</h2>
  <h3>English letter frequency</h3>
  <figure id="example_dot"></figure>
  <figcaption>Data: <a href="http://pi.math.cornell.edu/~mec/2003-2004/cryptography/subs/frequencies.html">Cornell</a></figcaption>
  <p>Dots are placed along a single continuous scale to show distribution along the corresponding variable.</p>
  <h2>Table</h2>
  <img src="https://flowingdata.com/wp-content/uploads/2016/09/Diversity-at-schools-1090x678.png">
  <p>Visually plain and boring. Sometimes exactly what you want.</p>
  <h2>Timetable</h2>
  <img src="https://datavizcatalogue.com/methods/images/top_images/timetable.png">
  <p>Timetables are used as a referencing and management tool for scheduled events, tasks and actions to take place. Timetables are commonly used to display the arrival and departure time of trains and other forms of transportation.</p>
  <h2>Ternary plot</h2>
  <img src="imgs/ternary.svg">
  <p>A ternary plot, ternary graph, or triangle plot graphically depicts the ratios of the three variables as positions in an equilateral triangle.</p>
  <h2>Timeline</h2>
  <h3>World History Timeline</h3>
  <figure id="civilizations"></figure>
  <figcaption>Data: <a href="http://www.essential-humanities.net/history-overview/world-history-timeline/">Essential Humanities</a></figcaption>
  <p>A Timeline is a graphical way of displaying a list of events in chronological order.</p>
  <h2>Treemap</h2>
  <img src="imgs/treemap.svg">
  <p>Ben Shneiderman originally developed Treemaps as a way of visualising a vast file directory on a computer, without taking up too much space on the screen. This makes Treemaps a more compact and space-efficient option for displaying hierarchies, that gives a quick overview of the structure. Treemaps are also great at comparing the proportions between categories via their area size.</p>
  <h2>Variable width bar chart</h2>
  <h3>Commute time to work</h3>
  <figure id="irregular"></figure>
  <figcaption class="alignLeft">Data: <a href="https://www.census.gov/prod/2004pubs/c2kbr-33.pdf">US 2000 census</a></figcaption>
  <p>The vertical height is the same as a regular bar chart. The widths of bars show another dimension for each category. The two dimensions multiplied (area) should mean something.</p>
  <h2>Venn diagram</h2>
  <img src="https://datavizcatalogue.com/methods/images/top_images/SVG/venn_diagram.svg">
  <p>A Venn Diagram is a diagram that visually displays all the possible logical relationships between a collection of sets. Each set is typically represented with a circle. When sets overlap, it’s known as the intersection area. This is where entities that have all the qualities of the overlapping sets.</p>
<!--     <h2>Voronoi diagram</h2>
    <img src="https://pbs.twimg.com/media/DAJgrRvV0AAvhoa?format=png&name=medium">
    <p>In a Voronoi diagram, each polygon, called a Voronoi cell, contains a data point and all areas that are closer to that point than any other.</p> -->
  </article>
</main>
<footer>
  <h2 id="footnote-label">Footnotes</h2>
  <ol>
    <li id="interpolation"><b>Interpolation</b> is the process of calculating an approximate value based on values that are already known. Learn more <a href="https://www.merriam-webster.com/dictionary/interpolation">here</a>.<a href="#interpolation-ref" aria-label="Back to content">↩</a></li>
  </ol>
  <div>
    <p>Justin Chill © 2021. Thanks for reading!</p>
    <p><a href="https://github.com/JustinChill/JustinChill.github.io" target="_blank"><img src="imgs/github.svg" class="icon">Source code and feedback</a></p>    
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/@observablehq/plot"></script>

<script type="text/javascript">
  var element = d3.select('p').node();
  var width = element.getBoundingClientRect().width; // get width of article so graphic is responsive  
  var size = 12;

  var nodes = [
  { id: "SRI", x: 0, y: 10 },
  { id: "UCSB", x: 1, y: 1 },
  { id: "UCLA", x: 8, y: 0 },
  { id: "UTAH", x: 36, y: 17 }
  ];

  var links = [ ["SRI", "UTAH"], ["SRI", "UCSB"], ["SRI", "UCLA"], ["UCLA", "UCSB"] ];

  // Define small datasets locally to save an xHTTP request
  // var nukes = [{"country":"Russia","nukes":6257},
  // {"country":"USA","nukes":5550},
  // {"country":"France","nukes":290},
  // {"country":"China","nukes":350},
  // {"country":"United Kingdom","nukes":195},
  // {"country":"India","nukes":160},
  // {"country":"Pakistan","nukes":165},
  // {"country":"Israel","nukes":90},
  // {"country":"North Korea","nukes":40},
  // {"country":"Jeff","nukes":10}];

  var ex_lvls = [{ "Phrase":"Hey baby,", "level":15},
  { "Phrase":"do you want", "level":25},
  { "Phrase":"to have", "level":40},
  { "Phrase":"sex...", "level":75},
  { "Phrase":"...tuplets?", "level":5}];

  var wework = [
  // https://craft.co/wework/funding-rounds
  [0.097, '01/04/2009', 'A'],
  [0.440, '01/11/2010', 'B'],
  [1.5, '01/07/2011', 'C'],
  [4.8, '01/07/2011', 'D-1'],
  [5, '01/05/2012', 'D-2'],
  [10, '01/05/2015', 'E'],
  [15, '01/06/2015', 'F'],
  [21, '01/08/2017', 'G'],
  [47, '01/08/2019', '‘The epic SoftBank round’'], // https://www.businesswire.com/news/home/20190108005751/en/WeWork-Closes-6-Billion-Investment-SoftBank
  [7.3, '12/31/2019'],
  [2.9, '05/20/2020'],
  [2.9, new Date()]
  ].map(([val, d, label]) => ({ value: val, date: new Date(d), label }));

  var animals = [{"country":"Great Britain","animal":"cattle"},{"country":"Great Britain","animal":"cattle"},{"country":"Great Britain","animal":"cattle"},{"country":"Great Britain","animal":"pigs"},{"country":"Great Britain","animal":"pigs"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"Great Britain","animal":"sheep"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"cattle"},{"country":"United States","animal":"pigs"},{"country":"United States","animal":"pigs"},{"country":"United States","animal":"pigs"},{"country":"United States","animal":"pigs"},{"country":"United States","animal":"pigs"},{"country":"United States","animal":"pigs"},{"country":"United States","animal":"sheep"},{"country":"United States","animal":"sheep"},{"country":"United States","animal":"sheep"},{"country":"United States","animal":"sheep"},{"country":"United States","animal":"sheep"},{"country":"United States","animal":"sheep"},{"country":"United States","animal":"sheep"}];

  var top20 = [{"country":"China","value":10174.681},{"country":"United States of America","value":5284.697},{"country":"India","value":2616.449},{"country":"Russian Federation","value":1678.367},{"country":"Japan","value":1106.664},{"country":"Iran","value":779.527},{"country":"Germany","value":701.955},{"country":"Indonesia","value":617.513},{"country":"South Korea","value":611.263},{"country":"Saudi Arabia","value":582.15},{"country":"Canada","value":576.65},{"country":"South Africa","value":478.608},{"country":"Brazil","value":465.716},{"country":"Mexico","value":438.498},{"country":"Australia","value":411.016},{"country":"Turkey","value":405.126},{"country":"United Kingdom","value":369.878},{"country":"Italy","value":337.086},{"country":"France","value":323.747},{"country":"Poland","value":322.627}];

  var alphabet = [{"letter":"E","frequency":0.12702},{"letter":"T","frequency":0.09056},{"letter":"A","frequency":0.08167},{"letter":"O","frequency":0.07507},{"letter":"I","frequency":0.06966},{"letter":"N","frequency":0.06749},{"letter":"S","frequency":0.06327},{"letter":"H","frequency":0.06094},{"letter":"R","frequency":0.05987},{"letter":"D","frequency":0.04253},{"letter":"L","frequency":0.04025},{"letter":"C","frequency":0.02782},{"letter":"U","frequency":0.02758},{"letter":"M","frequency":0.02406},{"letter":"W","frequency":0.0236},{"letter":"F","frequency":0.02288},{"letter":"G","frequency":0.02015},{"letter":"Y","frequency":0.01974},{"letter":"P","frequency":0.01929},{"letter":"B","frequency":0.01492},{"letter":"V","frequency":0.00978},{"letter":"K","frequency":0.00772},{"letter":"J","frequency":0.00153},{"letter":"X","frequency":0.0015},{"letter":"Q","frequency":0.00095},{"letter":"Z","frequency":0.00074}];

  var mekko = [{"year":2013,"territory":"Southeast","total":860126.27},{"year":2015,"territory":"Southeast","total":590351.26},{"year":2014,"territory":"Southeast","total":554975.04},{"year":2013,"territory":"Southwest","total":514814.11},{"year":2013,"territory":"Mideast","total":509158.51},{"year":2013,"territory":"Plains","total":499981.42},{"year":2013,"territory":"Great Lakes","total":448777.43},{"year":2015,"territory":"Plains","total":426599.52},{"year":2015,"territory":"Great Lakes","total":426204.18},{"year":2015,"territory":"Mideast","total":422307.31},{"year":2016,"territory":"Southeast","total":398957.56},{"year":2013,"territory":"Far West","total":391021.82},{"year":2015,"territory":"Southwest","total":356559.44},{"year":2014,"territory":"Mideast","total":348336.13},{"year":2014,"territory":"Plains","total":335422.77},{"year":2014,"territory":"Southwest","total":330156.18},{"year":2015,"territory":"Far West","total":311311.14},{"year":2016,"territory":"Mideast","total":309321.7},{"year":2016,"territory":"Plains","total":249464.6},{"year":2014,"territory":"Far West","total":238638.61},{"year":2014,"territory":"Great Lakes","total":235570.98},{"year":2016,"territory":"Far West","total":233609.7},{"year":2016,"territory":"Southwest","total":227107.47},{"year":2016,"territory":"Great Lakes","total":209591.94},{"year":2015,"territory":"Rocky Mountain","total":196060.13},{"year":2013,"territory":"Rocky Mountain","total":195866.61},{"year":2014,"territory":"Rocky Mountain","total":106174.16},{"year":2016,"territory":"Rocky Mountain","total":83640.41}];

  var data5corr = [{"ISO_3166_1":4,"country":"Afghanistan","country_alt":"Afghanistan","territory":"Afghanistan","region":"Asia","subregion":"Southern Asia","population_2018":37171921,"population_2019":38041754,"population_change_2019":0.023399999999999997,"population_2020":38928346,"population_change_2020":0.0233,"population_change_2020_net":886592,"density":60,"area":652860,"migrants_net":-62920,"fert_rate":4.6,"age_median":18,"pop_urban_perc":0.25,"world_share":0.005,"flag":"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Flag_of_Afghanistan.svg/23px-Flag_of_Afghanistan.svg.png"},{"ISO_3166_1":8,"country":"Albania","country_alt":"Albania","territory":"Albania","region":"Europe","subregion":"Southern Europe","population_2018":2882740,"population_2019":2880917,"population_change_2019":-0.0006,"population_2020":2877797,"population_change_2020":-0.0011,"population_change_2020_net":-3120,"density":105,"area":27400,"migrants_net":-14000,"fert_rate":1.6,"age_median":36,"pop_urban_perc":0.63,"world_share":0.0004,"flag":"https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Flag_of_Albania.svg/21px-Flag_of_Albania.svg.png"},{"ISO_3166_1":12,"country":"Algeria","country_alt":"Algeria","territory":"Algeria","region":"Africa","subregion":"Northern Africa","population_2018":42228408,"population_2019":43053054,"population_change_2019":0.0195,"population_2020":43851044,"population_change_2020":0.018500000000000003,"population_change_2020_net":797990,"density":18,"area":2381740,"migrants_net":-10000,"fert_rate":3.1,"age_median":29,"pop_urban_perc":0.73,"world_share":0.005600000000000001,"flag":"https://upload.wikimedia.org/wikipedia/commons/thumb/7/77/Flag_of_Algeria.svg/23px-Flag_of_Algeria.svg.png"},{"ISO_3166_1":16,"country":"American Samoa","country_alt":"American Samoa","territory":"United States","region":"Oceania","subregion":"Polynesia","population_2018":55465,"population_2019":55312,"population_change_2019":-0.0028000000000000004,"population_2020":55191,"population_change_2020":-0.0022,"population_change_2020_net":-121,"density":276,"area":200,"migrants_net":0,"fert_rate":0,"age_median":0,"pop_urban_perc":0.88,"world_share":0,"flag":"https://upload.wikimedia.org/wikipedia/commons/thumb/8/87/Flag_of_American_Samoa.svg/23px-Flag_of_American_Samoa.svg.png"},{"ISO_3166_1":20,"country":"Andorra","country_alt":"Andorra","territory":"Andorra","region":"Europe","subregion":"Southern Europe","population_2018":77006,"population_2019":77142,"population_change_2019":0.0018,"population_2020":77265,"population_change_2020":0.0016,"population_change_2020_net":123,"density":164,"area":470,"migrants_net":0,"fert_rate":0,"age_median":0,"pop_urban_perc":0.88,"world_share":0,"flag":"https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Flag_of_Andorra.svg/22px-Flag_of_Andorra.svg.png"}];

  var population = [{"2010":37254523,"2019":39512223,"State":"California"},{"2010":25145561,"2019":28995881,"State":"Texas"},{"2010":18801310,"2019":21477737,"State":"Florida"},{"2010":19378102,"2019":19453561,"State":"New York"},{"2010":12702379,"2019":12801989,"State":"Pennsylvania"},{"2010":12830632,"2019":12671821,"State":"Illinois"},{"2010":11536504,"2019":11689100,"State":"Ohio"},{"2010":9687653,"2019":10617423,"State":"Georgia"},{"2010":9535483,"2019":10488084,"State":"North Carolina"},{"2010":9883640,"2019":9986857,"State":"Michigan"},{"2010":8791894,"2019":8882190,"State":"New Jersey"},{"2010":8001024,"2019":8535519,"State":"Virginia"},{"2010":6724540,"2019":7614893,"State":"Washington"},{"2010":6392017,"2019":7278717,"State":"Arizona"},{"2010":6547629,"2019":6949503,"State":"Massachusetts"},{"2010":6346105,"2019":6833174,"State":"Tennessee"},{"2010":6483802,"2019":6732219,"State":"Indiana"},{"2010":5988927,"2019":6137428,"State":"Missouri"},{"2010":5773552,"2019":6045680,"State":"Maryland"},{"2010":5686986,"2019":5822434,"State":"Wisconsin"},{"2010":5029196,"2019":5758736,"State":"Colorado"},{"2010":5303925,"2019":5639632,"State":"Minnesota"},{"2010":4625364,"2019":5148714,"State":"South Carolina"},{"2010":4779736,"2019":4903185,"State":"Alabama"},{"2010":4533372,"2019":4648794,"State":"Louisiana"},{"2010":4339367,"2019":4467673,"State":"Kentucky"},{"2010":3831074,"2019":4217737,"State":"Oregon"},{"2010":3751351,"2019":3956971,"State":"Oklahoma"},{"2010":3574097,"2019":3565287,"State":"Connecticut"},{"2010":2763885,"2019":3205958,"State":"Utah"},{"2010":3046355,"2019":3155070,"State":"Iowa"},{"2010":2700551,"2019":3080156,"State":"Nevada"},{"2010":2915918,"2019":3017825,"State":"Arkansas"},{"2010":2967297,"2019":2976149,"State":"Mississippi"},{"2010":2853118,"2019":2913314,"State":"Kansas"},{"2010":2059179,"2019":2096829,"State":"New Mexico"},{"2010":1826341,"2019":1934408,"State":"Nebraska"},{"2010":1852994,"2019":1792065,"State":"West Virginia"},{"2010":1567582,"2019":1787147,"State":"Idaho"},{"2010":1360301,"2019":1415872,"State":"Hawaii"},{"2010":1316470,"2019":1359711,"State":"New Hampshire"},{"2010":1328361,"2019":1344212,"State":"Maine"},{"2010":989415,"2019":1068778,"State":"Montana"},{"2010":1052567,"2019":1059361,"State":"Rhode Island"},{"2010":897934,"2019":973764,"State":"Delaware"},{"2010":814180,"2019":884659,"State":"South Dakota"},{"2010":672591,"2019":762062,"State":"North Dakota"},{"2010":710231,"2019":731545,"State":"Alaska"},{"2010":601723,"2019":705749,"State":"District of Columbia"},{"2010":625741,"2019":623989,"State":"Vermont"},{"2010":563626,"2019":578759,"State":"Wyoming"}];

  var civilizations = [{"civilization":"Aegean civilization","start":-2000,"end":-1200,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Age of pre-colonial civilization (Christian, Islamic, and traditional kingdoms)","start":650,"end":1880,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"MEDIEVAL WORLD"},{"civilization":"Age of Turkic empires","start":500,"end":1200,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"MEDIEVAL WORLD"},{"civilization":"Age of united Caliphate","start":650,"end":900,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"MEDIEVAL WORLD"},{"civilization":"Ancient Andean region","start":-1000,"end":500,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"ANCIENT WORLD"},{"civilization":"Ancient China","start":-2000,"end":500,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"ANCIENT WORLD"},{"civilization":"Ancient Steppe empires","start":-1000,"end":500,"startLabel":null,"endLabel":null,"region":"the Steppe","timeline":"ANCIENT WORLD"},{"civilization":"British India","start":1800,"end":1945,"startLabel":null,"endLabel":"WWII","region":"South Asia","timeline":"MODERN WORLD"},{"civilization":"Classic age of Mesoamerica","start":100,"end":900,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"ANCIENT WORLD"},{"civilization":"Colonial Africa","start":1880,"end":1980,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"MODERN WORLD"},{"civilization":"Colonial United States","start":1500,"end":1776,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Early Islamic period","start":1200,"end":1500,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Early modern China","start":1500,"end":1918,"startLabel":null,"endLabel":"WWI","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Early modern Europe","start":1500,"end":1800,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Early Nubian civilization","start":-2000,"end":-1000,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"ANCIENT WORLD"},{"civilization":"Egyptian civilization","start":-3000,"end":-550,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"First Persian Empire","start":-550,"end":-330,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Formative age of Mesoamerica","start":-1500,"end":100,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"ANCIENT WORLD"},{"civilization":"Formative Japan (age of Yamato rule)","start":500,"end":800,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Formative US","start":1776,"end":1865,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Fractured Islamic world","start":900,"end":2018,"startLabel":null,"endLabel":"present","region":"Middle East","timeline":"MODERN WORLD"},{"civilization":"Great power US","start":1865,"end":1945,"startLabel":null,"endLabel":"WWII","region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Greek age","start":-1200,"end":0,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Heian age","start":800,"end":1200,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Imperial Japan","start":1870,"end":1945,"startLabel":null,"endLabel":"WWII","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Indian kingdom age","start":-500,"end":1200,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"ANCIENT WORLD"},{"civilization":"Indus civilization","start":-2500,"end":-1500,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"ANCIENT WORLD"},{"civilization":"Inter-Persian period","start":-330,"end":200,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Kush","start":-1000,"end":300,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"ANCIENT WORLD"},{"civilization":"Medieval Andean region","start":500,"end":1530,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"MEDIEVAL WORLD"},{"civilization":"Medieval China","start":500,"end":1500,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Medieval Europe","start":500,"end":1500,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MEDIEVAL WORLD"},{"civilization":"Mesopotamian civilization","start":-3500,"end":-550,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Modern Africa","start":1980,"end":2018,"startLabel":"WWII","endLabel":"present","region":"Sub-Saharan Africa","timeline":"MODERN WORLD"},{"civilization":"Modern Europe","start":1800,"end":2018,"startLabel":null,"endLabel":"present","region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Modern India","start":1945,"end":2018,"startLabel":null,"endLabel":"present","region":"South Asia","timeline":"MODERN WORLD"},{"civilization":"Modern Japan","start":1945,"end":2018,"startLabel":null,"endLabel":"present","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Mongol Empire","start":1200,"end":1300,"startLabel":null,"endLabel":null,"region":"the Steppe","timeline":"MEDIEVAL WORLD"},{"civilization":"Mughal Empire","start":1500,"end":1800,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"MODERN WORLD"},{"civilization":"Peak of Aksum","start":300,"end":650,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"MEDIEVAL WORLD"},{"civilization":"People's Republic of China","start":1945,"end":2018,"startLabel":"WWII","endLabel":"present","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Postclassic age of Mesoamerica","start":900,"end":1520,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"MEDIEVAL WORLD"},{"civilization":"Ptolemaic Egypt","start":-330,"end":0,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Republic of China","start":1918,"end":1945,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Roman > Byzantine Egypt","start":0,"end":650,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Roman Empire","start":0,"end":500,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Roman Republic","start":-500,"end":0,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Second Persian Empire","start":-200,"end":650,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Shogunate","start":1200,"end":1870,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Superpower US","start":1945,"end":2021,"startLabel":null,"endLabel":"present","region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Vedic age","start":-1500,"end":-500,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"ANCIENT WORLD"}];

  var popcorn = [{"Team":"Dallas Mavericks","Arena":"American Airlines Center","Freshness":5,"Saltiness":5,"Crunchiness":4,"Butter":5,"Presentation":5,"Total_Score":24},{"Team":"Brooklyn Nets","Arena":"Barclays Center","Freshness":4,"Saltiness":5,"Crunchiness":5,"Butter":4,"Presentation":5,"Total_Score":23},{"Team":"Miami Heat","Arena":"American Airlines Arena","Freshness":5,"Saltiness":4,"Crunchiness":4,"Butter":4,"Presentation":5,"Total_Score":22},{"Team":"Portland Trailblazers","Arena":"Moda Center","Freshness":4,"Saltiness":4,"Crunchiness":5,"Butter":4,"Presentation":3,"Total_Score":20},{"Team":"Sacramento Kings","Arena":"Golden 1 Center","Freshness":2,"Saltiness":4,"Crunchiness":4,"Butter":4,"Presentation":5,"Total_Score":19},{"Team":"Toronto Raptors","Arena":"Scotiabank Arena","Freshness":3,"Saltiness":4,"Crunchiness":3,"Butter":4,"Presentation":4,"Total_Score":18},{"Team":"Houston Rockets","Arena":"Toyota Center","Freshness":3,"Saltiness":4,"Crunchiness":3,"Butter":4,"Presentation":4,"Total_Score":18},{"Team":"Oklahoma City Thunder","Arena":"Chesapeake Energy Arena","Freshness":4,"Saltiness":3,"Crunchiness":4,"Butter":4,"Presentation":3,"Total_Score":18},{"Team":"Golden State Warriors","Arena":"Oracle Arena","Freshness":2,"Saltiness":4,"Crunchiness":5,"Butter":3,"Presentation":4,"Total_Score":18},{"Team":"New York City Knicks","Arena":"Madison Square Garden","Freshness":3,"Saltiness":2,"Crunchiness":4,"Butter":4,"Presentation":4,"Total_Score":17},{"Team":"Indiana Pacers","Arena":"Bankers Life Fieldhouse","Freshness":3,"Saltiness":3,"Crunchiness":5,"Butter":4,"Presentation":2,"Total_Score":17},{"Team":"New Orleans Pelicans","Arena":"Smoothie King Center","Freshness":3,"Saltiness":3,"Crunchiness":3,"Butter":3,"Presentation":5,"Total_Score":17},{"Team":"Minnesota Timberwolves","Arena":"Target Center","Freshness":2,"Saltiness":5,"Crunchiness":4,"Butter":3,"Presentation":3,"Total_Score":17},{"Team":"Washington Wizards","Arena":"Capital One Arena","Freshness":4,"Saltiness":3,"Crunchiness":3,"Butter":4,"Presentation":3,"Total_Score":17},{"Team":"Chicago Bulls","Arena":"United Center","Freshness":3,"Saltiness":4,"Crunchiness":3,"Butter":3,"Presentation":3,"Total_Score":16},{"Team":"Utah Jazz","Arena":"Vivint Smart Home Arena","Freshness":2,"Saltiness":5,"Crunchiness":4,"Butter":3,"Presentation":2,"Total_Score":16},{"Team":"Atlanta Hawks","Arena":"State Farm Arena","Freshness":3,"Saltiness":5,"Crunchiness":4,"Butter":3,"Presentation":1,"Total_Score":16},{"Team":"San Antonio Spurs","Arena":"AT&T Center","Freshness":3,"Saltiness":3,"Crunchiness":3,"Butter":3,"Presentation":3,"Total_Score":15},{"Team":"Philadelphia Sixers","Arena":"Wells Fargo Center","Freshness":4,"Saltiness":2,"Crunchiness":4,"Butter":2,"Presentation":2,"Total_Score":14},{"Team":"Phoenix Suns","Arena":"Talking Stick Resort Arena","Freshness":3,"Saltiness":3,"Crunchiness":3,"Butter":3,"Presentation":2,"Total_Score":14},{"Team":"Milwaukee Bucks","Arena":"Fiserv Forum","Freshness":2,"Saltiness":2,"Crunchiness":3,"Butter":4,"Presentation":2,"Total_Score":13},{"Team":"Boston Celtics","Arena":"TD Garden","Freshness":3,"Saltiness":3,"Crunchiness":2,"Butter":3,"Presentation":2,"Total_Score":13},{"Team":"Memphis Grizzlies","Arena":"FedExForum","Freshness":1,"Saltiness":4,"Crunchiness":4,"Butter":3,"Presentation":1,"Total_Score":13},{"Team":"Orlando Magic","Arena":"Amway Center","Freshness":3,"Saltiness":5,"Crunchiness":3,"Butter":1,"Presentation":1,"Total_Score":13},{"Team":"Denver Nuggets","Arena":"Pepsi Center","Freshness":3,"Saltiness":2,"Crunchiness":3,"Butter":2,"Presentation":3,"Total_Score":13},{"Team":"Cleveland Cavaliers","Arena":"Rocket Mortgage Fieldhouse","Freshness":2,"Saltiness":4,"Crunchiness":2,"Butter":2,"Presentation":2,"Total_Score":12},{"Team":"Detroit Pistons","Arena":"Little Caesars Arena","Freshness":1,"Saltiness":4,"Crunchiness":2,"Butter":3,"Presentation":2,"Total_Score":12},{"Team":"Charlotte Hornets","Arena":"Spectrum Center","Freshness":1,"Saltiness":2,"Crunchiness":2,"Butter":2,"Presentation":4,"Total_Score":11},{"Team":"Los Angeles Clippers/Lakers","Arena":"Staples Center","Freshness":2,"Saltiness":1,"Crunchiness":3,"Butter":1,"Presentation":3,"Total_Score":10}];


  // Color Legend
  // https://observablehq.com/@d3/color-legend
  function legend(d,{
    color,
    title,
    tickSize = 6,
    width = 320,
    height = 44 + tickSize,
    marginTop = 18,
    marginRight = 0,
    marginBottom = 16 + tickSize,
    marginLeft = 0,
    ticks = width / 64,
    tickFormat,
    tickValues
  } = {}) {
    const svg = d3.select(d).append("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("viewBox", [0, 0, width, height])
      .style("overflow", "visible")
      .style("display", "block");

    let tickAdjust = g => g.selectAll(".tick line").attr("y1", marginTop + marginBottom - height);
    let x;

    // Continuous
    if (color.interpolate) {
      const n = Math.min(color.domain().length, color.range().length);

      x = color.copy().rangeRound(d3.quantize(d3.interpolate(marginLeft, width - marginRight), n));

      svg.append("image")
        .attr("x", marginLeft)
        .attr("y", marginTop)
        .attr("width", width - marginLeft - marginRight)
        .attr("height", height - marginTop - marginBottom)
        .attr("preserveAspectRatio", "none")
        .attr("xlink:href", ramp(color.copy().domain(d3.quantize(d3.interpolate(0, 1), n))).toDataURL());
    }

    // Sequential
    else if (color.interpolator) {
      x = Object.assign(color.copy()
        .interpolator(d3.interpolateRound(marginLeft, width - marginRight)), {
          range() {
            return [marginLeft, width - marginRight];
          }
        });

      svg.append("image")
        .attr("x", marginLeft)
        .attr("y", marginTop)
        .attr("width", width - marginLeft - marginRight)
        .attr("height", height - marginTop - marginBottom)
        .attr("preserveAspectRatio", "none")
        .attr("xlink:href", ramp(color.interpolator()).toDataURL());

      // scaleSequentialQuantile doesn’t implement ticks or tickFormat.
      if (!x.ticks) {
        if (tickValues === undefined) {
          const n = Math.round(ticks + 1);
          tickValues = d3.range(n).map(i => d3.quantile(color.domain(), i / (n - 1)));
        }
        if (typeof tickFormat !== "function") {
          tickFormat = d3.format(tickFormat === undefined ? ",f" : tickFormat);
        }
      }
    }

    // Threshold
    else if (color.invertExtent) {
      const thresholds = color.thresholds ? color.thresholds() // scaleQuantize
        :
        color.quantiles ? color.quantiles() // scaleQuantile
        :
        color.domain(); // scaleThreshold

      const thresholdFormat = tickFormat === undefined ? d => d :
        typeof tickFormat === "string" ? d3.format(tickFormat) :
        tickFormat;

      x = d3.scaleLinear()
        .domain([-1, color.range().length - 1])
        .rangeRound([marginLeft, width - marginRight]);

      svg.append("g")
        .selectAll("rect")
        .data(color.range())
        .join("rect")
        .attr("x", (d, i) => x(i - 1))
        .attr("y", marginTop)
        .attr("width", (d, i) => x(i) - x(i - 1))
        .attr("height", height - marginTop - marginBottom)
        .attr("fill", d => d);

      tickValues = d3.range(thresholds.length);
      tickFormat = i => thresholdFormat(thresholds[i], i);
    }

    // Ordinal
    else {
      x = d3.scaleBand()
        .domain(color.domain())
        .rangeRound([marginLeft, width - marginRight]);

      svg.append("g")
        .selectAll("rect")
        .data(color.domain())
        .join("rect")
        .attr("x", x)
        .attr("y", marginTop)
        .attr("width", Math.max(0, x.bandwidth() - 1))
        .attr("height", height - marginTop - marginBottom)
        .attr("fill", color);

      tickAdjust = () => {};
    }

    svg.append("g")
      .attr("transform", `translate(0,${height - marginBottom})`)
      .call(d3.axisBottom(x)
        .ticks(ticks, typeof tickFormat === "string" ? tickFormat : undefined)
        .tickFormat(typeof tickFormat === "function" ? tickFormat : undefined)
        .tickSize(tickSize)
        .tickValues(tickValues))
      .call(tickAdjust)
      .call(g => g.select(".domain").remove())
      .call(g => g.append("text")
        .attr("x", marginLeft)
        .attr("y", marginTop + marginBottom - height - 6)
        .attr("fill", "currentColor")
        .attr("text-anchor", "start")
        .attr("font-weight", "bold")
        .text(title));

    return svg.node();
  }

  function ramp(color, n = 256) {
    var canvas = document.createElement('canvas');
    canvas.width = n;
    canvas.height = 1;
    const context = canvas.getContext("2d");
    for (let i = 0; i < n; ++i) {
      context.fillStyle = color(i / (n - 1));
      context.fillRect(i, 0, 1, 1);
    }
    return canvas;
  };

  // Civilization chart
  formatYear = year => year < 0 ? `${-year} BC` : `${year} AD` // formatYear uses a ternary operator to dynamically format the year in the data. Such a cool d3 thing! 😎

  var civ_options = {
    height: civilizations.length * 16,
    width: width,
    marginLeft: 120,
    style:{fontSize: size},
    x: {
      axis: "top",
      grid: true,
      tickFormat: formatYear
    },
    y: {
      axis: null,
      domain: d3.sort(civilizations, d => d.start).map(d => d.civilization)
    },
    color: {
      reverse: true,
      scheme: "BuRd"
    },
    marks: [
    Plot.barX(civilizations, {
      x1: "start",
      x2: "end",
      insetTop: 2,
      insetBottom: 2, // Makes the bars slightly thinner
      fill: "region",
      title: (d) =>
        `${d.civilization} \nStart: ${d.start}\nEnd: ${d.end}\nRegion: ${d.region}`, // \n makes a new line
        y: "civilization"
      }),
    Plot.text(civilizations, {
      x: "start", // Show label on right when start date is > -3000 years
      y: "civilization",
      text: "civilization",
      textAnchor: "end",
      dx: -6
    })
    ]
  };

  var horizontal = {
    height: 500,
    width: width,
    marginLeft: 170,
    marginRight: 40,
    style:{fontSize: size},
    color: {
      range: ["#969696", "#4e79a7"]
    },
    x: {
      axis: "top",
      ticks: 0,
      label: "MtCO₂ per year",
      labelOffset: 15
    },
    y: {
      domain: d3.sort(top20, d => -d.value).map(d => d.country),
      tickSize: 0,
      label: null
    },
    marks: [
    Plot.barX(top20, {
      x: "value",
      y: "country",
      inset:2,
      fill: d => d.value < 2000 ? "" : "country",
    }),
    Plot.text(top20, {
      x: "value", 
      y: "country", 
      text: d => d3.format(",.0f")(d.value), 
      textAnchor: "start", 
      dx: 2, 
      dy: 3
    })
    ]
  };

// From John Guerra: https://observablehq.com/@john-guerra/plot-isotype-dot-plot
textScale = 
d3
.scaleOrdinal()
.domain(["cattle", "pigs", "sheep"])
.range(["🐄", "🐖", "🐑"]);

var animals = {
  y: { axis: null},
  height: 350,
  width: width,
  facet: { data: animals, y: "country", label: null},
  marks: [
  Plot.text(
    animals,
    Plot.stackX({
      y: "animal",
      text: d => textScale(d.animal),
      fontSize: width > 450 ? 45 : 30,
      textAnchor: "start"
    })
    ),
      // Plot.frame(),
      ]
    };

    var popcorn = {
    };

    var gridmap = {
    };

//   var slope = {
//     grid: true,
//     inset: 10,
//     marginLeft: 100,
//     marginRight: 50,
//     width: 520,
//     height: 700,
//     x: {
//       axis: "top",
//       domain: [2010, 2019],
//       tickFormat: "Y",
//       ticks: 1
//     },
//     y: {
//     // label: "% change in year",
//     axis: null
//   },
//   color: {
//     type: "ordinal",
//     reverse: true,
//     scheme: "BuRd"
//   },
//   marks: [
//   Plot.ruleX([2019]),
//   Plot.link(population.filter(d => (d["2019"] > 9512223)), {
//     x1: 2010,
//     y1: "2010",
//     x2: 2019,
//     y2: "2019",
//       // stroke: "#000",
//       stroke: d => d["State"]
//     }),
//   Plot.text(population.filter(d => (d["2019"] > 9512223)),  {
//     x: 2010,
//     y: "2010",
//     text: (d) =>
//     `${d.State} ${d3.format("Y")(d["2010"])}`,
//     textAnchor: "end",
//     dx: -5,
//     fill: d => d["State"],
//     fontSize: 14
//   }),
//   Plot.text(population.filter(d => (d["2019"] > 9512223)), {
//     x: 2019,
//     y: "2019",
//     text: (d) =>
//     `${d.State} ${d3.format("Y")(d["2019"])}`,
//     textAnchor: "start",
//     dx: 5,
//     fill: d => d["State"],
//     fontSize: 14
//   }),
//   ]
// };
var slope = {
  width: 400,
  height: 300,
  marginLeft: 100,
  marginRight: 50,
  style:{fontSize: size},
  x: {
    axis: "top",
    domain: [2019, 2020],
    tickFormat: "",
    ticks: 1
  },
  y: {
    label: "% change in year",
    percent: true,
    domain: [-1, 3],
    axis: null
  },
  marks: [
  Plot.link(data5corr, {
    x1: 2019,
    y1: "population_change_2019",
    x2: 2020,
    y2: "population_change_2020",
    stroke: "country"
  }),
  // Plot.ruleY([0]),
  Plot.text(data5corr, {
    x: 2019,
    y: "population_change_2019",
    text: (d) =>
    `${d.country}: ${d3.format(".1%")(d["population_change_2019"])}`,
    textAnchor: "end",
    dx: -5,
    fill: "country",
    fontSize: 14
  }),
  Plot.text(data5corr, {
    x: 2020,
    y: "population_change_2020",
    text: (d) =>
    `${d.country}: ${d3.format(".1%")(d["population_change_2020"])}`,
    // text: (d) => d3.format(".1%")(d["population_change_2020"]),
    textAnchor: "start",
    dx: 5,
    fill: "country",
    fontSize: 14
  })
  ]
};

lookup = new function(){
  const index = new Map(nodes.map(d => [d.id, d]));
  return id => index.get(id);
};
function project([id1, id2]) {
  const {x: x1, y: y1} = lookup(id1);
  const {x: x2, y: y2} = lookup(id2);
  return {x1, y1, x2, y2};
};

var network = {
  inset: 50,
  x: {axis: null},
  y: {axis: null},
  marks: [
  Plot.link(links.map(project), {
    x1: "x1", y1: "y1", x2: "x2", y2: "y2"
  }),
  Plot.dot(nodes, {x: "x", y: "y", fill: "black"}),
  Plot.text(nodes, {x: "x", y: "y", text: "id", dy: 16, dx: -12})
  ],
  width: 300,
  height: 220
};

var wework = {
  width: width,
  style:{fontSize: size},
  y: {
    grid: true,
    tickFormat: d=> `$${d}B`,
    label: "Value ↑",
    tickSize: 0,
  },
  marks: [
  Plot.lineY(wework, {x: "date", y: "value", curve: "step-after", strokeWidth: 2, stroke: "steelblue"}),
  Plot.ruleY([0]),
  Plot.text(wework.filter(d => (d.label !== "E" && d.label !== "C")), {x: "date", y: "value", text: "label", dx: 0, dy: -8}),
  Plot.text(wework.filter(d => (d.label === "E" || d.label === "C")), {x: "date", y: "value", text: "label", dx: -11, dy: -1}),
  Plot.dot(wework, {x: "date", y: "value", r: width < 500 ? 3 : 4, fill: "white", stroke: "black", title: d => d3.format("$")(d.value)+`B`, })
  ]
};

var example_dot = {
  width: width,
  style:{fontSize: size},
  x: {
    label: null,
  },
  marks: [
  Plot.dot(alphabet, {x: "letter", r: "frequency", fill: "letter"})
  ]
};

var example_line = {
  width: width,
  style:{fontSize: size},
  y: {
    grid: true,
    nice: true,
    domain: [0, 100],
    labelOffset: 35,
    label: "↑ Excitement level"
  },
  x:{
    domain: d3.sort(ex_lvls, d => -d.Phrase).map(d => d.Phrase),
    axis: null,
  },
  marks: [
  Plot.line(ex_lvls, {x: "Phrase", y: "level", stroke: "hsl(22, 82%, 39%)", strokeWidth: 2.5}),
  Plot.dot(ex_lvls, {x: "Phrase", y: "level", fill: "hsl(22, 82%, 39%)"}),
  Plot.text(ex_lvls.filter(d => (d.level <= 70)), {x: "Phrase", y: "level", text: "Phrase", dy: 18, dx: 14, fontSize: size*1.2}),
  Plot.text(ex_lvls.filter(d => (d.level >= 70)), {x: "Phrase", y: "level", text: "Phrase", dy: -6, dx: 2,fontSize: size*1.2}),
      // Plot.ruleY([0,100]),  
      ]
    };

  // Draw the plot (data local on page)
  document.getElementById("civilizations").appendChild(Plot.plot(civ_options));
  // document.getElementById("gridmap").appendChild(Plot.plot(gridmap));
  document.getElementById("wework").appendChild(Plot.plot(wework));
  document.getElementById("slope").appendChild(Plot.plot(slope));
  document.getElementById("animals").appendChild(Plot.plot(animals));
  // document.getElementById("popcorn").appendChild(Plot.plot(popcorn));
  document.getElementById("example_dot").appendChild(Plot.plot(example_dot));
  document.getElementById("network").appendChild(Plot.plot(network));
  document.getElementById("horizontal").appendChild(Plot.plot(horizontal));
  document.getElementById("example_line").appendChild(Plot.plot(example_line));

  var boxY = function boxY(data, {
    x = null,
    y = {transform: x => x},
    fill = "#ccc",
    stroke = "currentColor",
  } = {}) {
    const group = x == null ? Plot.groupZ : Plot.groupX;
    return Plot.marks(
      Plot.ruleX(data, group({y1: iqr1, y2: iqr2}, {x, y, stroke})),
      Plot.barY(data, group({y1: quartile1, y2: quartile3}, {x, y, fill})),
      Plot.tickY(data, group({y: "median"}, {x, y, stroke, strokeWidth: 2})),
      Plot.dot(data, Plot.map({y: outliers}, {x, y, z: x, stroke}))
      );
  };
  var outliers = function outliers(values) {
    const r1 = iqr1(values);
    const r2 = iqr2(values);
    return values.map(v => v < r1 || v > r2 ? v : NaN);
  };

  var iqr1 = V => {
    const hi = quartile1(V);
    const lo = hi - 1.5 * (quartile3(V) - hi);
    return d3.min(V, v => lo <= v && v <= hi ? v : NaN);
  };

  var iqr2 = V => {
    const lo = quartile3(V);
    const hi = lo + 1.5 * (lo - quartile1(V));
    return d3.max(V, v => lo <= v && v <= hi ? v : NaN);
  };

  var quartile1 = V => d3.quantile(V, 0.25);
  var quartile3 = V => d3.quantile(V, 0.75);

  formatChange = new function() {
    const format = d3.format("+d");
    return x => format((x - 1) * 100);
  };

  formatCurrency = new function() {
    const format = d3.format("$.2f");
    return x => format(x);
  };

  formatWhole = new function() {
    const format = d3.format(",");
    return x => format(x);
  };

  formatLog = new function() {
    const format = d3.format(".2s");
    return x => format(x);
  };


  parseTime = new function() {
    const format = d3.timeParse("%Y");
    return x => format(x);    
  }; 

  const formatTime = d3.timeFormat("%Y");

  // Use Promises to async request data
  var promises = [d3.json("data/drugs.json"), d3.csv("data/aapl.csv",d3.autoType),d3.csv("data/hadcrut.csv",d3.autoType), d3.csv("https://gist.githubusercontent.com/JesseCHowe/099f4b8e1a029c0b4af35b1edc1989f7/raw/8c18ed9a0940c734d423c3f2699ee063279533ec/morley.csv",d3.autoType), d3.csv("data/stocks.csv",d3.autoType),d3.csv("data/units.csv",d3.autoType),d3.json("data/qatar.json"),d3.csv("https://raw.githubusercontent.com/plotly/datasets/master/gapminderDataFiveYear.csv",d3.autoType),d3.csv("data/driving.csv",d3.autoType),d3.csv("data/bls.csv",d3.autoType),d3.csv("data/caltrain.csv"),d3.csv("data/mpg.csv",d3.autoType), d3.csv("data/electricity.csv",d3.autoType),d3.json("data/dogdata.json"), d3.csv("data/google-trends-2020.csv",d3.autoType),d3.csv("data/metros.csv", d3.autoType),d3.csv("data/covid.csv", d3.autoType),d3.csv("data/commute.csv", d3.autoType)];

  // You can request multiple srcs in a promise
  myDataPromises = Promise.all(promises);

  // After data is successfully fetched, generate viz
  myDataPromises.then(function(data) {
    // Define the data
    var drugs = data[0];
    var aapl = data[1];
    var hadcrut = data[2];
    var morley = data[3];
    var stocks = data[4];
    var units = data[5];
    var qatar = data[6];
    var gapminder = data[7];
    var driving = data[8];
    var bls = data[9];
    var caltrain = data[10];
    var mpg = data[11];
    var electric = data[12];
    var dogdata = data[13];
    var google = data[14];
    var metros = data[15];
    var covid = data[16];
    var commute = data[17];

    var electricity = {
      height: 400,
      width: width,
      marginLeft: 30,
      marginRight: 100,
      style:{fontSize: size},
      x: {
        // ticks: 8,
        tickSize: 2,
        tickPadding: 8,
        label: null
      },
      y: {
        tickFormat: "%",
        ticks: 5,
        tickSize: 0,
        tickPadding: 4,
        grid: true,
        label: null
      },
      marks: [
      Plot.areaY(electric, Plot.stackY({
        x: "year", 
        y: "percentage", 
        fill: "source", 
        order: ['Coal', 'Gas', 'Oil', 'Nuclear', 'Hydroelectric', 'Wind', 'Solar', 'Other renewables'],
        offset: "expand"})),
      Plot.text(electric, Plot.selectLast(Plot.stackY({
        x: "year",
        y: "percentage",
        z: "source",
        order: ['Coal', 'Gas', 'Oil', 'Nuclear', 'Hydroelectric', 'Wind', 'Solar', 'Other renewables'], 
        offset: "expand",
        fill: "source",
        text: "source",
        fontWeight: 700,
        textAnchor: "start", dx: 4, dy: 3
      }))),
      Plot.ruleY([0])
      ],
      color: {
        scheme: "BuRd"
      },
    };

    var apple_area = {
      width: width,
      style:{fontSize: size},
      marginLeft: width > 450 ? 40 : 20,
      marginRight: width > 450 ? 0 : 10,
      x: {
        // margin: 0,
      },
      y: {
        grid: true,
        tickFormat: "$f",
      },
      marks: [
      Plot.areaY(aapl, {x: "Date", y: "Close", fill: "rgba(204,204,204,.8)"}),
      Plot.lineY(aapl, {x: "Date", y: "Close", title: "Close", stroke: "rgba(0, 0, 0, .75)"}),
      Plot.dot(aapl, Plot.selectLast({x: "Date", y: "Close", fill: "white", stroke: "rgba(0, 0, 0, .75)"})),
      Plot.text(aapl, Plot.selectLast({x: "Date", y: "Close", text: d => formatCurrency(d.Close), dy: -10, dx: -15, fontWeight: 700, fontSize: 14})),
      ]
    };

    const tinyapple = aapl.slice(-90);

    var candlestick = {
      inset: 6,
      width: width,
      grid: true,
      style:{fontSize: size},
      y: {
        label: "↑ Apple stock price ($)",
        tickFormat: "$f",
      },
      x:{

      },
      color: {
        range: ["#e41a1c", "#000000", "#4daf4a"]
      },
      marks: [
      Plot.ruleX(tinyapple, {
        x: "Date",
        y1: "Low",
        y2: "High"
      }),
      Plot.ruleX(tinyapple, {
        x: "Date",
        y1: "Open",
        y2: "Close",
        stroke: d => Math.sign(d.Close - d.Open),
        strokeWidth: 4,
        strokeLinecap: "round"
      })
      ]
    };

    var example_bar = {
      width: width,
      style:{fontSize: size},
      x:{
        label: null,
        tickSize: 0,},    
        y: {
          label: "↑ Frequency (%)",
          grid: true,
          tickSize: 0,
        },
        color: {
          domain: ["frequent", "not"],
          range: ["hsl(168, 78%, 41%)", "rgba(204,204,204,.8)"],
        },
        marks: [
      // Transform data example, ternary operator example for style
      Plot.barY(alphabet, {x: "letter", y: d => d.frequency * 100, fill: d => d.frequency >.08 ? "frequent" : "not"}),
      Plot.ruleY([0], {stroke: "hsl(0, 0%, 88%)"})
      ]
    };

    var drug_bar = {
      width: width,
      style:{fontSize: size},
      x: {
        label: null,
        tickSize: 0,
        tickRotate: -35,
      },
      color: {
        domain: ["small", "big"],
        range: ["hsl(168, 78%, 41%)", "hsl(0, 0%, 88%)"]
      },
      y: {
        grid: true,
        tickFormat: "",
        ticks: 8,
      },
      marks: [
      Plot.barY(drugs, { x: "Drug", y: "Pleasure", title: "Drug", fill: d => d.Pleasure > 2.4 ? "small" : "big"}),
      Plot.text(drugs, {x: "Drug", y: "Pleasure", text: d => (d.Pleasure).toFixed(1), dy: -5}),]
    };

    var anomaly_barcode = { 
      width: width,
      style:{fontSize: size},
      x: {
        round: true
      },
      color: {
        type: "diverging",
        scheme: "BuRd"
      },
      marks: [
      Plot.barX(hadcrut, {
          x1: d => d.year, // start of current year
          x2: d => d3.utcYear.offset(d.year), // start of next year
          fill: "anomaly",
          title: (d) =>
          `${d3.timeFormat("%B %d, %Y")(d["year"])} \nAnomaly: ${d3.format("+.3f")(d["anomaly"])}`,
        }),
      ],
    };

    var stocks_baseline = {
      width: width,
      style:{fontSize: size},
      color: {
        scheme: "BuRd"
      },
      y: {
        type: "log",
        grid: true,
        label: "↑ Change in price (%)",
        tickFormat: formatChange
      },
      marks: [
      Plot.ruleY([1]),
      Plot.line(stocks, Plot.normalizeY({
        x: "Date", 
        y: "Close",
        stroke: "Symbol"
      })),
      Plot.text(stocks, Plot.selectLast(Plot.normalizeY({
        x: "Date",
        y: "Close",
        z: "Symbol",
        fill: "Symbol",
        text: "Symbol",
        textAnchor: "start",
        fontSize: 14,
        fontWeight: 700,
        dx: 3
      })))
      ]
    };

    var anomaly_dot = {
      width: width,
      style:{fontSize: size},
      y: {
        grid: true,
        tickFormat: "+f",
        label: "↑ Surface temperature anomaly (°F)",
        tickSize: 0,
      },
      x:{
      },
      color: {
        type: "diverging",
        scheme: "BuRd"
      },
      marks: [
      Plot.ruleY([0], {stroke:"rgba(0,0,0,.6)"}),
      Plot.dot(hadcrut, {x: "year", y: "anomaly", stroke: "anomaly",fill: "anomaly", title: (d) =>
        `${d3.timeFormat("%B %d, %Y")(d["year"])} \nAnomaly: ${d3.format("+.3f")(d["anomaly"])}`,})
      ]
    };

    var google_ridgeline = {
      width: width,
      marginRight: 0,
      style:{fontSize: 10},
      x: {
        axis: "top",
        label: null,
      },
      y: {
        range: [12, -24],
        axis: null,
      },
      fy: {
        round: true,
        label: null
      },
      facet: {
        data: google,
        y: "search",
        marginLeft: width > 450 ? 160 : 100,
      },
      color: {
        // type: "diverging",
        scheme: "tableau10",
        reverse: true,
      },
      marks: [
      Plot.areaY(google, {x: "week", y: "interest", fill: "search", fillOpacity: 0.42, sort: {fy: "y", reduce: "max-index"}}),
      Plot.line(google, {x: "week", y: "interest", stroke: "white", strokeWidth: 1}),
      Plot.ruleY([0],{stroke:"rgba(204,204,204,.8)"}),
      ]
    };

    // From Bostock, of course: https://observablehq.com/@observablehq/plot-box
    var morley = {
      width: width,
      style:{fontSize: size},
      y: {
        grid: true,
        inset: 6
      },
      x:{ label:"Experiment", labelOffset: 50},
      marks: [
      boxY(morley, {x: "Expt", y: "Speed", fill:"hsl(43, 89%, 70%)"})
      ]
    };

    var gapminder = { 
      width: width,     
      inset: 2,
      style:{fontSize: size},
      y: {
        // grid: true,
        label: "↑ Life Expectency",        
        ticks: 4,
      },
      x: { 
        type: "log",
        tickFormat: formatLog,
        label: "GDP Per Capita (log)",
        tickFormat: "~s",
        className: "axis-x",
        labelOffset: -10,
      },
      marks: [
      Plot.dot(gapminder.filter(d => (d.year === 2007)), {x: "gdpPercap", y: "lifeExp", r: "pop", fill: "continent",title: "country"}),
      Plot.ruleY([40],{stroke:"rgba(204,204,204,.8)"}),
      Plot.ruleX([250],{stroke:"rgba(204,204,204,.8)"}),
      ]
    };

    var bullet = {
      width: width,
      height: 85,
      style:{fontSize: size},
      x: {
        axis: "bottom",
        grid: true,
        // ticks: d3.range(0, 51, 10),
        tickFormat: (d) => (d === 50 ? `${d}%` : `${d}`),
        tickSize: 0
      },
      y: { label: null, reverse: true, domain: ["all"], axis: null },
      color: { scheme: "dark2" },
      facet: {
        data: covid,
        x: "race",
        label: null,
      },
      marks: [
      Plot.barX(covid, {
        x: "population_percent",
        y: "age",
        fill: "#ddd",
        title: d => `${d.race} are ${d.population_percent}% of the population\nand make up ${d.cases_percent}% of COVID-19 cases`,
        insetTop: 2,
        insetBottom: 2
      }),
      Plot.frame({stroke: "#ccc"}),
      Plot.barX(covid, {
        x: "cases_percent",
        y: "age",
        fill: "race",
        title: d => `${d.race} are ${d.population_percent}% of the population\nand make up ${d.cases_percent}% of COVID-19 cases`,
        sort: { fx: "x", reverse: true },
        insetTop: 6,
        insetBottom: 6
      })
      ],
    };

    var driving_line = {
      width: width,
      inset: 10,
      style:{fontSize: size},
      grid: true,
      x: {
        label: "Miles driven (per person-year) →",
        labelOffset: 50
      },
      y: {
        label: "↑ Cost of gasoline ($ per gallon)",
        tickFormat: formatCurrency,
        ticks: 6
      },
      marks: [
      Plot.line(driving, {x: "miles", y: "gas", curve: "catmull-rom", strokeWidth: 2}),
      Plot.dot(driving, {x: "miles", y: "gas", fill: "white", stroke: "black"}),
      Plot.text(driving, {filter: d => d.year % 5 === 0, x: "miles", y: "gas", text: "year", dy: -10, dx:-2})
      ]
    };

    var bls_line = {
      width: width,
      marginLeft: 30,
      marginRight: width > 450 ? 100 : 80,
      style:{fontSize: size},
      y: {
        grid: false,
        label: "↑ Unemployed (thousands)",
      },
      marks: [
      Plot.areaY(bls, {x: "date", y2: "unemployed", z: "industry", fillOpacity: 0.1}),
      Plot.lineY(bls, {x: "date", y: "unemployed", z: "industry", strokeWidth: 1}),
      Plot.text(bls, Plot.selectLast({filter: d => d.industry !== "Agriculture",x: "date", y: "unemployed", z: "industry", text: "industry", textAnchor: "start", dx: 3}))
      ]
    };

    var bls_stacked = {
      width: width,
      style:{fontSize: size},
      y: {
        grid: true,
        label: "↑ Unemployed (thousands)"
      },
      color: {
        // type: "diverging",
        scheme: "Set2",
        reverse: true,
      },
      marks: [
      Plot.areaY(bls, Plot.stackY({x: "date", y: "unemployed", fill: "industry", title: "industry"})),
      Plot.text(bls, Plot.selectLast(Plot.stackY({filter: d => d.industry !== "Mining and Extraction",
        x: "date", y: "unemployed", z: "industry", 
        text: "industry", textAnchor: "start", 
        fontSize: 12, fontWeight: 700, 
        dx: 3,fill: "industry"}))),
      Plot.ruleY([0])
      ]
    };

    var bls_bar = {
      style:{fontSize: size},
      x: {
        tickFormat: "%Y",
        tickSize: 0,
        label: null
      },
      y: {
        grid: true,
        label: "↑ Unemployed (thousands)"
      },
      color: {
        type: "ordinal",
        scheme: "Set2",
        reverse: true,
      },
      width: width,
      marks: [
      Plot.barY(bls, Plot.binX({y: "sum"}, {x: "date", y: "unemployed", fill: "industry"})) // title doesn't work with binX? 🤔
      ]
    };

    var stacked_hrz = {
      width: width,
      style:{fontSize: size},
      color: {
        type: "ordinal",
        scheme: "Set2",
        // reverse: true,
      },
      x:{
        label: "Sources of electricity",
        axis: "top",
        labelAnchor: "center",
        tickPadding: 2,
        tickFormat: "%",
        tickSize: 0,
        ticks:0,
        nice: true,
      },
      marks: [
      Plot.barX(electric, Plot.stackX(Plot.groupZ({x: "proportion"}, {fill: "source"}))),
        Plot.text(electric, Plot.stackX(Plot.groupZ({x: "proportion", text: "first"}, {z: "source", text: d => d.source === "Other renewables" ? "Other" : d.source}))), // I'm a sucker for a nice ternary operator
        // Plot.ruleX([0, 1])
        ]
      };

    // Drug scatter plot 
    var drug_scatter = {      
      style:{fontSize: size},
      inset: 10, // Inset the chart so outliers don't appear on the edges
      width: width,
      grid: true,
      y: {        
        nice: true, // Nice is a convenience function that automatically rounds to the nearest whole number
        ticks: 4,
        tickFormat: formatWhole,
      },
      x:{ labelOffset: 50},
      marks: [
      // Draw a dot for each drug in drugs
      Plot.dot(drugs, {x: "Mean Social harm", y: "Mean_Physical_harm",r: "Pleasure", title: "Drug", fill: "Drug"}),
      // Add a text label above the dot
      Plot.text(drugs, {x: "Mean Social harm", y: "Mean_Physical_harm", text: d => d.Drug === "Solvents" ? "" : d.Drug, dy: -8, dx: -2}),
      Plot.ruleY([0]),
      ]
    };

    var example_histogram = {
      width: width,
      style:{fontSize: size},
      color: {
        type: "diverging",
        scheme: "Sinebow"
      },
      x: {
        round: true,
        label: "Trade volume (log₁₀) →",
        labelOffset: 50
      },
      y: {
        grid: true
      },
      marks: [
      Plot.rectY(aapl, Plot.binX({y: "count", fill:"median"}, {x: d => Math.log10(d.Volume), normalize: true, fill: "Volume"})),
      Plot.ruleY([0])
      ]
    };

    var stem_plot = {
      width: 240,
      height: 480,
      style:{fontSize: size},
      axis: null,
      color: {
        domain: "NLB",
        range: ["currentColor", "peru", "brown"]
      },
      marks: [
      Plot.text([[1, 3]], {
        text: ["Northbound"], 
        textAnchor: "start"
      }),
      Plot.text([[-1, 3]], {
        text: ["Southbound"], 
        textAnchor: "end"
      }),
      Plot.text(new Set(caltrain.map(d => d.hours)), {
        x: 0,
        y: d => d,
        text: d => `${(d - 1) % 12 + 1}${(d % 24) >= 12 ? "p": "a"}`
      }),
      Plot.text(caltrain, Plot.stackX2({
        filter: d => d.orientation === "N",
        x: 1,
        y: "hours",
        text: d => d.minutes.padStart(2, "0"),
        title: d => `${d.time} ${d.line}`,
        fill: "type",
        textAnchor: "start"
      })),
      Plot.text(caltrain, Plot.stackX2({
        filter: d => d.orientation === "S",
        x: -1,
        y: "hours",
        text: d => d.minutes.padStart(2, "0"),
        title: d => `${d.time} ${d.line}`,
        fill: "type",
        textAnchor: "end"
      })),
      Plot.ruleX([-0.5, 0.5])
      ]
    };

    var streamgraph = {
      style:{fontSize: size},
      marks: [
      Plot.areaY(bls, Plot.stackY({
        x: "date",
        y: "unemployed",
        fill: "industry",
        title: "industry",
        offset: "wiggle"
      })),
      Plot.text(bls, Plot.selectLast(Plot.stackY({
        x: "date", 
        y: "unemployed", 
        z: "industry", 
        text: "industry",
        offset: "wiggle", 
        textAnchor: "start",
        dx: 5,
        fill: "industry"}))),
      ]
    };

    var qatar_pyramid = {
      width: width,
      height: 500,
      style:{fontSize: size},
      color: {
        domain: ["male","female"],
        range: ["steelblue", "#EE7989"]
      },
      x: {
        tickFormat: d => d3.format("~s")(Math.abs(d)),
        label: "← male          female →        (thousands)",
        nice: true,
        round: true,
        axis: "bottom",
      },
      y: {
        domain: d3.groupSort(qatar, v => parseInt(v[0].age), d => d.age),
        reverse: true,
        label: "Age"
      },
      marginLeft: 60,
      marks: [
      Plot.barX(qatar, {
        x: d => d["population"] * (1 - 2 * (d["sex"] === "male")),
        y: "age",
        fill: d => d.sex === "male" ? "male" : "female",
      }),
      Plot.barX(qatar, {
        x: d => d["population"] * (1 - 2 * (d["sex"] === "male")),
        y: "age",
        fill: "sex",
        stroke: "white",
        strokeWidth: 3.5
      }),
      Plot.barX(qatar, {
        x: d => d["population"] * (1 - 2 * (d["sex"] === "male")),
        y: "age",
        stroke: "black"
      })
      ],
    };

    var mpg = {
      width: width - 20,
      style:{fontSize: size},
      x: {label: "City mpg →", ticks: 2, labelOffset: 50},
      y: {label: "↑ Highway mpg", ticks: 6, labelOffset: 90},
      // marginLeft: 20,
      // marginTop: 0,
      // marginBottom: 50,
      inset: 4,
      facet: {
        data : mpg,
        x: "class",
        label: null,
      },
      marks: [
      Plot.dot(mpg, {x: "cty", y: "hwy", stroke: "manufacturer", strokeWidth: 1, title: d => `${d.manufacturer} ${d.model} \nHighway: ${d.hwy} mpg\nCity: ${d.cty} mpg`,}),
      Plot.dot(mpg, {x: "cty", y: "hwy", fill: "manufacturer"}),
      [Plot.frame()]
      ]
    };

    var inequality = {
      grid: true,
      inset: 10,
      width: width,
      style:{fontSize: size},
      marginTop: 30,
      marginBottom: 50,
      x: {
        type: "log",
        label: "Population →",
        labelOffset: 40,
        tickSize: 0,
      },
      y: {
        label: "↑ Inequality",
        tickSize: 0,
        nice: true,
      },
      color: {
        type: "diverging",
        reverse: true,
        symmetric: false
      },
      marks: [
      Plot.link(metros, {
        x1: "POP_1980",
        y1: "R90_10_1980",
        x2: "POP_2015",
        y2: "R90_10_2015",
        stroke: d => d.R90_10_2015 - d.R90_10_1980
      }),
      Plot.dot(metros, {
        x: "POP_2015",
        y: "R90_10_2015",
        r: 3,
        stroke: "black",
        strokeWidth: 1,
        fill: d => d.R90_10_2015 - d.R90_10_1980,
        title:  (d) =>
        `${d.nyt_display} \nPopulation in 1980: ${d3.format(",")(d.POP_1980)}\nPopulation in 2015: ${d3.format(",")(d.POP_2015)}\nCurrent level of inequality: ${d3.format(",")(d.R90_10_2015)}\nChange in inequality: ${d3.format("+.2")(d.R90_10_2015 - d.R90_10_1980)}`, // \n makes a new line
      }),
      Plot.text(metros.filter(d => d.nyt_display !== "San Francisco" && d.nyt_display !== "Johnstown"), {
        x: "POP_2015",
        y: "R90_10_2015",
        fontSize: size*1.1,
        text: d => d.highlight && d.nyt_display,
        dy: -6
      }),
      Plot.text(metros.filter(d => d.nyt_display === "San Francisco"), {
        x: "POP_2015",
        y: "R90_10_2015",
        fontSize: size*1.1,
        text: d => d.highlight && d.nyt_display,
        dy: -2,
        dx: -42
      }),
      Plot.text(metros.filter(d => d.nyt_display === "Johnstown"), {
        x: "POP_2015",
        y: "R90_10_2015",
        fontSize: size*1.1,
        text: d => d.highlight && d.nyt_display,
        dy: 15,
        dx: 18
      }),
      ]
    };

    // From Fil: https://observablehq.com/@fil/waffle-chart
    var waffle = {
      width: width,
      style:{fontSize: size},
      marks: [
      Plot.cell(
        units,
        Plot.stackX({
          y: (_, i) => i % 5,
          fill: "label",
          title: "group"
        })
        ),
      Plot.text(
        units,
        Plot.stackX({
          y: (_, i) => i % 5,
          text: "label"
        })
        )
      ],
      x: { axis: null },
      y: { axis: null },
      color: { scheme: "Pastel2" }
    };

    var irregular = {
      // height: 240,
      width: width,
      style:{fontSize: size},
      x: {
        label: "Commute time (minutes) →",
        ticks: 20,
        labelOffset: 50,
      },
      y: {
        label: "↑ People (per 5 minute interval)",
        transform: (n) =>
        n * 5 /* 5-minute intervals */ * 1000 /* data is in thousands */,
        tickFormat: "~s",
        nice: true,
        grid: true,
      },
      marks: [
      Plot.rectY(commute, {
        x1: "lo",
        x2: "hi",
        y: (d) => d.people / (d.hi - d.lo),
        fill: "rgba(204,204,204,.8)",
        insetRight: 1,
        title: (d) =>
        `${new Intl.NumberFormat("en-US").format(
          d.people / 1000
          )} million people\nspend ${d.lo} to ${
          d.hi
        } minutes\ncommuting to work.`
      }),
      Plot.text(commute, {
        filter: "annotation",
        text: "annotation",
        fontSize: size,
        x: "hi",
        y: (d) => d.people / (d.hi - d.lo),
        dx: 2,
        dy: 5,
        textAnchor: "start"
      }),
      Plot.ruleY([0])
      ]
    };

    // Draw the plots (data fetched)
    document.getElementById("electricity").appendChild(Plot.plot (electricity));
    document.getElementById("example_bar").appendChild(Plot.plot (example_bar));
    document.getElementById("apple_area").appendChild(Plot.plot (apple_area));
    document.getElementById("candlestick").appendChild(Plot.plot (candlestick));
    document.getElementById("anomaly_barcode").appendChild(Plot.plot (anomaly_barcode));
    document.getElementById("stocks_baseline").appendChild(Plot.plot (stocks_baseline));
    document.getElementById("anomaly_dot").appendChild(Plot.plot (anomaly_dot));
    document.getElementById("morley").appendChild(Plot.plot (morley));
    document.getElementById("driving_line").appendChild(Plot.plot (driving_line));
    document.getElementById("bls_line").appendChild(Plot.plot (bls_line));
    document.getElementById("bls_stacked").appendChild(Plot.plot (bls_stacked));
    document.getElementById("bls_bar").appendChild(Plot.plot (bls_bar));
    document.getElementById("stacked_hrz").appendChild(Plot.plot (stacked_hrz));
    document.getElementById("example_histogram").appendChild(Plot.plot (example_histogram));
    document.getElementById("stem_plot").appendChild(Plot.plot (stem_plot));
    document.getElementById("streamgraph").appendChild(Plot.plot (streamgraph));
    document.getElementById("qatar_pyramid").appendChild(Plot.plot (qatar_pyramid));
    document.getElementById("gapminder").appendChild(Plot.plot (gapminder));
    document.getElementById("bullet").appendChild(Plot.plot (bullet));
    document.getElementById("mpg").appendChild(Plot.plot (mpg));
    document.getElementById("inequality").appendChild(Plot.plot (inequality));
    document.getElementById("drug_scatter").appendChild(Plot.plot (drug_scatter));
    document.getElementById("google_ridgeline").appendChild (Plot.plot(google_ridgeline));
    document.getElementById("waffle").appendChild(Plot.plot (waffle));
    document.getElementById("irregular").appendChild (Plot.plot(irregular));
  });

myDataPromises.catch(function() {
  console.log('🚨 Oops - Something has gone wrong fetching data.')
});

// Experimenting with d3 color swatches & legend:
</script>
</body>
</html>