<!DOCTYPE html>
<html lang="en">
<head>
	<title>Charts</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="style.css" />
  <script src="script.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Charts and data">
  <meta name="author" content="Justin Chill">

  <style type="text/css">
  figure .plot{
    margin: 0 auto;
    overflow: visible;
    width: 720px;
  }

  figcaption{
    margin-bottom: 0;
  }
</style>

</head>
<body>
  <nav class="nav">
    <div class="nav__list">
      <a href="index.html" class="nav__item">Home</a>
      <a href="blog.html" class="nav__item">Blog</a>
      <a href="projects.html" class="nav__item">Lab</a>
      <a href="fun.html" class="nav__item">Fun</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>

  <main role="main">
    <article>
     <header>
      <h1>Common charts and graphs</h1>
      <h2 class="subtitle"></h2>
      <time date="2021-10-04">Justin Hill</time>
    </header>
    <p>Data visualization is the graphical representation of data. It presents data in the form of a chart or graph to make it easier to identify patterns and understand difficult concepts. Technology allows users to interact with the data by changing the parameters to see more detail and create new insights.</p>
    <h2>Alluvial diagram</h2>
    <h2>Area chart</h2>
    <h3>Apple Inc. (AAPL) Closing Stock Price</h3>
    <figure id="apple_area"></figure>
    <figcaption>Data: <a href="https://observablehq.com/@observablehq/plot-area">Apple stock price</a></figcaption>
    <p>An area graph is a specialized form of the line graph, where data points are connected with a continuous line and the region below that line is filled with a solid color.</p>
    <h2>Bar chart</h2>
    <figure id="drug_bar"></figure>
    <p>The classic bar chart. The height (or length) of each bar represents data. The baseline starts at zero.</p>
    <!-- <h2>Bar chart race</h2> -->
    <h2>Barcode chart</h2>
    <h3>Surface temperature anomalies</h3>
    <figure id="anomaly_barcode"></figure>
    <figcaption>Data: <a href="https://ourworldindata.org/grapher/hadcrut-surface-temperature-anomaly?tab=table">Our World in Data</a></figcaption>
    <p>A compact way to show a distribution, line segments represent individual data points along a single axis.</p>
    <h2>Baseline chart</h2>
    <h2>Beeswarm</h2>
    <p>Experimental Plot Beeswarm on <a href="https://observablehq.com/@fil/experimental-plot-beeswarm">Observable</a></p>
    <h2>Box plot</h2>
    <h3>Michaelson-Morley Speed of Light Data</h3>
    <figure id="morley"></figure>
    <figcaption>Data: <a href="http://stats4stem.weebly.com/r-morley-data.html">Morley dataset</a></figcaption>
    <p>Box plots, also called box-and-whisker plots or box-whisker plots, give a good graphical image of the concentration of the data. A box plot is constructed from five values: the minimum value, the first quartile, the median, the third quartile, and the maximum value. We use these values to compare how close other data values are to them.</p>
    <h2>Bubble chart</h2>
    <h3>The relative harms of drugs</h3>
    <figure id="drug_bubble"></figure>
    <figcaption>Data: David Nutt for <a href="https://www.drugscience.org.uk">Drug Science</a></figcaption>
    <p>A bubble chart is a variation of a scatter chart in which the data points are replaced with bubbles, and an additional dimension of the data is represented in the size of the bubbles. Just like a scatter chart, a bubble chart does not use a category axis — both horizontal and vertical axes are value axes. In addition to the x values and y values that are plotted in a scatter chart, a bubble chart also z (size) values.</p>
    <h2>Bump chart</h2>
    <h2>Cartogram</h2>
    <h2>Chord diagram</h2>
    <h2>Choropleth map</h2>
    <img src="imgs/ZIP3_zones.svg">
    <figcaption>ZIP codes explained <a href="inf-hoe-graphic.html">here</a></figcaption>
    <h2>Connected scatter plot</h2>
    <h2>Density plot</h2>
    <h2>Difference chart</h2>
    <p>A difference chart highlights the difference between two values, typically entries vs exits. The amount is encoded as height, and the sign (surplus vs. deficit) as a solid color.</p>
    <p>Plot: Difference Chart on <a href="https://observablehq.com/@fil/plot-difference-chart?collection=@fil/plot-experiments">Observabl</a>e</p>
    <h2>Donut chart</h2>
    <h2>Dot density map</h2>
    <h2>Dot dap</h2>
    <h2>Dot plot</h2>
    <h3>Surface temperature anomalies</h3>
    <figure id="anomaly_dot"></figure>
    <figcaption>Data: <a href="https://ourworldindata.org/grapher/hadcrut-surface-temperature-anomaly?tab=table">Our World in Data</a></figcaption>
    <p>Data points plotted as dots on a graph with an x- and y-axis. A dot plot is similar to a histogram in that it displays the number of data points that fall into each category or value on the axis, thus showing the distribution of a set of data.</p>
    <h2>Frequency trails</h2>
    <h2>Gantt chart</h2>
    <h2>Glyph chart</h2>
    <h2>Grid map</h2>
    <h2>Heatmap</h2>
    <h2>Histogram</h2>
    <h2>Horizon graph</h2>
    <h2>Line chart</h2>
    <h2>Line map</h2>
    <h2>Mosaic plot</h2>
    <h2>Moving bubbles</h2>
    <h2>Network graph</h2>
    <img src="https://static.observableusercontent.com/files/fdd59026430de7526a5f0d20b4528d13d48b20319b478e0f4eb13269ca169052b71aaf5fe98db0e7fc6aff1ae26a863605daaa5dc2f5a3d6760e33bcce335d5a">
    <h2>Organogram</h2>
    <h2>Packed bubble chart</h2>
    <h2>Parallel coordinates</h2>
    <h2>Parallel sets</h2>
    <h2>Pictogram</h2>
    <h2>Pie chart</h2>
    <h2>Pyramid chart</h2>
    <p>Qatar Population Pyramid on <a href="https://observablehq.com/@fil/qatar-population-pyramid">Observable</a></p>
    <h2>Radar chart</h2>
    <h2>Sankey diagram</h2>
    <h2>Scatter plot</h2>
    <figure id="drug_scatter"></figure>
    <h2>Slope chart</h2>
    <p>Guide to make a slope graph: <a href="https://observablehq.com/@ee2dev/plot-exploration-how-to-make-a-slope-graph?collection=@ee2dev/plot">Observable</a></p>
    <h2>Small multiples</h2>
    <h2>Spiral chart</h2>
    <h2>Square pie chart</h2>
    <h2>Stacked area chart</h2>
    <h2>Stacked bar chart</h2>
    <h2>Step chart</h2>
    <h3>WeWork Valuation</h3>
    <figure id="wework"></figure>
    <figcaption>Data: <a href="https://craft.co/wework/funding-rounds">Craft.co</a></figcaption>
    <p>A step chart works like a line chart, but the values change immediately at the x-coordinate instead of being interpolated<a href="#interpolation" aria-describedby="footnote-label" id="interpolation-ref"></a> with a slope.</p>
    <h2>Streamgraph</h2>
    <h2>Strip plot</h2>
    <h2>Surface plot</h2>
    <h2>Table</h2>
    <h2>Ternary plot</h2>
    <h2>Timeline</h2>
    <h3>Timeline of civilizations</h3>
    <figure id="civilizations"></figure>
    <figcaption>Data: </figcaption>
    <h2>Treemap</h2>
    <h2>Unit chart</h2>
    <h2>Variable width bar chart</h2>
    <h2>Venn diagram</h2>
    <h2>Voronoi diagram</h2>
  </article>
</main>
<footer>
  <h2 id="footnote-label">Footnotes</h2>
  <ol>
    <li id="interpolation"><b>Interpolation</b> is the process of calculating an approximate value based on values that are already known. Learn more <a href="https://www.merriam-webster.com/dictionary/interpolation">here</a>.<a href="#interpolation-ref" aria-label="Back to content">↩</a></li>
    </ol>
    <h1 class="visually-hidden">Justin Chill © 2020</h1>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.2"></script>

  <script type="text/javascript">
  // Define small datasets locally to save an xHTTP request
  var nukes = [{"country":"Russia","nukes":6257},
  {"country":"USA","nukes":5550},
  {"country":"France","nukes":290},
  {"country":"China","nukes":350},
  {"country":"United Kingdom","nukes":195},
  {"country":"India","nukes":160},
  {"country":"Pakistan","nukes":165},
  {"country":"Israel","nukes":90},
  {"country":"North Korea","nukes":40},
  {"country":"Jeff","nukes":10}];

  var civilizations = [{"civilization":"Aegean civilization","start":-2000,"end":-1200,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Age of pre-colonial civilization (Christian, Islamic, and traditional kingdoms)","start":650,"end":1880,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"MEDIEVAL WORLD"},{"civilization":"Age of Turkic empires","start":500,"end":1200,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"MEDIEVAL WORLD"},{"civilization":"Age of united Caliphate","start":650,"end":900,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"MEDIEVAL WORLD"},{"civilization":"Ancient Andean region","start":-1000,"end":500,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"ANCIENT WORLD"},{"civilization":"Ancient China","start":-2000,"end":500,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"ANCIENT WORLD"},{"civilization":"Ancient Steppe empires","start":-1000,"end":500,"startLabel":null,"endLabel":null,"region":"the Steppe","timeline":"ANCIENT WORLD"},{"civilization":"British India","start":1800,"end":1945,"startLabel":null,"endLabel":"WWII","region":"South Asia","timeline":"MODERN WORLD"},{"civilization":"Classic age of Mesoamerica","start":100,"end":900,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"ANCIENT WORLD"},{"civilization":"Colonial Africa","start":1880,"end":1980,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"MODERN WORLD"},{"civilization":"Colonial United States","start":1500,"end":1776,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Early Islamic period","start":1200,"end":1500,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Early modern China","start":1500,"end":1918,"startLabel":null,"endLabel":"WWI","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Early modern Europe","start":1500,"end":1800,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Early Nubian civilization","start":-2000,"end":-1000,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"ANCIENT WORLD"},{"civilization":"Egyptian civilization","start":-3000,"end":-550,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"First Persian Empire","start":-550,"end":-330,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Formative age of Mesoamerica","start":-1500,"end":100,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"ANCIENT WORLD"},{"civilization":"Formative Japan (age of Yamato rule)","start":500,"end":800,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Formative US","start":1776,"end":1865,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Fractured Islamic world","start":900,"end":2018,"startLabel":null,"endLabel":"present","region":"Middle East","timeline":"MODERN WORLD"},{"civilization":"Great power US","start":1865,"end":1945,"startLabel":null,"endLabel":"WWII","region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Greek age","start":-1200,"end":0,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Heian age","start":800,"end":1200,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Imperial Japan","start":1870,"end":1945,"startLabel":null,"endLabel":"WWII","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Indian kingdom age","start":-500,"end":1200,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"ANCIENT WORLD"},{"civilization":"Indus civilization","start":-2500,"end":-1500,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"ANCIENT WORLD"},{"civilization":"Inter-Persian period","start":-330,"end":200,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Kush","start":-1000,"end":300,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"ANCIENT WORLD"},{"civilization":"Medieval Andean region","start":500,"end":1530,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"MEDIEVAL WORLD"},{"civilization":"Medieval China","start":500,"end":1500,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Medieval Europe","start":500,"end":1500,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"MEDIEVAL WORLD"},{"civilization":"Mesopotamian civilization","start":-3500,"end":-550,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Modern Africa","start":1980,"end":2018,"startLabel":"WWII","endLabel":"present","region":"Sub-Saharan Africa","timeline":"MODERN WORLD"},{"civilization":"Modern Europe","start":1800,"end":2018,"startLabel":null,"endLabel":"present","region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Modern India","start":1945,"end":2018,"startLabel":null,"endLabel":"present","region":"South Asia","timeline":"MODERN WORLD"},{"civilization":"Modern Japan","start":1945,"end":2018,"startLabel":null,"endLabel":"present","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Mongol Empire","start":1200,"end":1300,"startLabel":null,"endLabel":null,"region":"the Steppe","timeline":"MEDIEVAL WORLD"},{"civilization":"Mughal Empire","start":1500,"end":1800,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"MODERN WORLD"},{"civilization":"Peak of Aksum","start":300,"end":650,"startLabel":null,"endLabel":null,"region":"Sub-Saharan Africa","timeline":"MEDIEVAL WORLD"},{"civilization":"People's Republic of China","start":1945,"end":2018,"startLabel":"WWII","endLabel":"present","region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Postclassic age of Mesoamerica","start":900,"end":1520,"startLabel":null,"endLabel":null,"region":"pre-colonial Americas","timeline":"MEDIEVAL WORLD"},{"civilization":"Ptolemaic Egypt","start":-330,"end":0,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Republic of China","start":1918,"end":1945,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MODERN WORLD"},{"civilization":"Roman > Byzantine Egypt","start":0,"end":650,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Roman Empire","start":0,"end":500,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Roman Republic","start":-500,"end":0,"startLabel":null,"endLabel":null,"region":"Europe (and colonial offshoots)","timeline":"ANCIENT WORLD"},{"civilization":"Second Persian Empire","start":-200,"end":650,"startLabel":null,"endLabel":null,"region":"Middle East","timeline":"ANCIENT WORLD"},{"civilization":"Shogunate","start":1200,"end":1870,"startLabel":null,"endLabel":null,"region":"East Asia","timeline":"MEDIEVAL WORLD"},{"civilization":"Superpower US","start":1945,"end":2021,"startLabel":null,"endLabel":"present","region":"Europe (and colonial offshoots)","timeline":"MODERN WORLD"},{"civilization":"Vedic age","start":-1500,"end":-500,"startLabel":null,"endLabel":null,"region":"South Asia","timeline":"ANCIENT WORLD"}];

  var popcorn = [{"Team":"Dallas Mavericks","Arena":"American Airlines Center","Freshness":5,"Saltiness":5,"Crunchiness":4,"Butter":5,"Presentation":5,"Total_Score":24},{"Team":"Brooklyn Nets","Arena":"Barclays Center","Freshness":4,"Saltiness":5,"Crunchiness":5,"Butter":4,"Presentation":5,"Total_Score":23},{"Team":"Miami Heat","Arena":"American Airlines Arena","Freshness":5,"Saltiness":4,"Crunchiness":4,"Butter":4,"Presentation":5,"Total_Score":22},{"Team":"Portland Trailblazers","Arena":"Moda Center","Freshness":4,"Saltiness":4,"Crunchiness":5,"Butter":4,"Presentation":3,"Total_Score":20},{"Team":"Sacramento Kings","Arena":"Golden 1 Center","Freshness":2,"Saltiness":4,"Crunchiness":4,"Butter":4,"Presentation":5,"Total_Score":19},{"Team":"Toronto Raptors","Arena":"Scotiabank Arena","Freshness":3,"Saltiness":4,"Crunchiness":3,"Butter":4,"Presentation":4,"Total_Score":18},{"Team":"Houston Rockets","Arena":"Toyota Center","Freshness":3,"Saltiness":4,"Crunchiness":3,"Butter":4,"Presentation":4,"Total_Score":18},{"Team":"Oklahoma City Thunder","Arena":"Chesapeake Energy Arena","Freshness":4,"Saltiness":3,"Crunchiness":4,"Butter":4,"Presentation":3,"Total_Score":18},{"Team":"Golden State Warriors","Arena":"Oracle Arena","Freshness":2,"Saltiness":4,"Crunchiness":5,"Butter":3,"Presentation":4,"Total_Score":18},{"Team":"New York City Knicks","Arena":"Madison Square Garden","Freshness":3,"Saltiness":2,"Crunchiness":4,"Butter":4,"Presentation":4,"Total_Score":17},{"Team":"Indiana Pacers","Arena":"Bankers Life Fieldhouse","Freshness":3,"Saltiness":3,"Crunchiness":5,"Butter":4,"Presentation":2,"Total_Score":17},{"Team":"New Orleans Pelicans","Arena":"Smoothie King Center","Freshness":3,"Saltiness":3,"Crunchiness":3,"Butter":3,"Presentation":5,"Total_Score":17},{"Team":"Minnesota Timberwolves","Arena":"Target Center","Freshness":2,"Saltiness":5,"Crunchiness":4,"Butter":3,"Presentation":3,"Total_Score":17},{"Team":"Washington Wizards","Arena":"Capital One Arena","Freshness":4,"Saltiness":3,"Crunchiness":3,"Butter":4,"Presentation":3,"Total_Score":17},{"Team":"Chicago Bulls","Arena":"United Center","Freshness":3,"Saltiness":4,"Crunchiness":3,"Butter":3,"Presentation":3,"Total_Score":16},{"Team":"Utah Jazz","Arena":"Vivint Smart Home Arena","Freshness":2,"Saltiness":5,"Crunchiness":4,"Butter":3,"Presentation":2,"Total_Score":16},{"Team":"Atlanta Hawks","Arena":"State Farm Arena","Freshness":3,"Saltiness":5,"Crunchiness":4,"Butter":3,"Presentation":1,"Total_Score":16},{"Team":"San Antonio Spurs","Arena":"AT&T Center","Freshness":3,"Saltiness":3,"Crunchiness":3,"Butter":3,"Presentation":3,"Total_Score":15},{"Team":"Philadelphia Sixers","Arena":"Wells Fargo Center","Freshness":4,"Saltiness":2,"Crunchiness":4,"Butter":2,"Presentation":2,"Total_Score":14},{"Team":"Phoenix Suns","Arena":"Talking Stick Resort Arena","Freshness":3,"Saltiness":3,"Crunchiness":3,"Butter":3,"Presentation":2,"Total_Score":14},{"Team":"Milwaukee Bucks","Arena":"Fiserv Forum","Freshness":2,"Saltiness":2,"Crunchiness":3,"Butter":4,"Presentation":2,"Total_Score":13},{"Team":"Boston Celtics","Arena":"TD Garden","Freshness":3,"Saltiness":3,"Crunchiness":2,"Butter":3,"Presentation":2,"Total_Score":13},{"Team":"Memphis Grizzlies","Arena":"FedExForum","Freshness":1,"Saltiness":4,"Crunchiness":4,"Butter":3,"Presentation":1,"Total_Score":13},{"Team":"Orlando Magic","Arena":"Amway Center","Freshness":3,"Saltiness":5,"Crunchiness":3,"Butter":1,"Presentation":1,"Total_Score":13},{"Team":"Denver Nuggets","Arena":"Pepsi Center","Freshness":3,"Saltiness":2,"Crunchiness":3,"Butter":2,"Presentation":3,"Total_Score":13},{"Team":"Cleveland Cavaliers","Arena":"Rocket Mortgage Fieldhouse","Freshness":2,"Saltiness":4,"Crunchiness":2,"Butter":2,"Presentation":2,"Total_Score":12},{"Team":"Detroit Pistons","Arena":"Little Caesars Arena","Freshness":1,"Saltiness":4,"Crunchiness":2,"Butter":3,"Presentation":2,"Total_Score":12},{"Team":"Charlotte Hornets","Arena":"Spectrum Center","Freshness":1,"Saltiness":2,"Crunchiness":2,"Butter":2,"Presentation":4,"Total_Score":11},{"Team":"Los Angeles Clippers/Lakers","Arena":"Staples Center","Freshness":2,"Saltiness":1,"Crunchiness":3,"Butter":1,"Presentation":3,"Total_Score":10}];

  var wework = [
  // https://craft.co/wework/funding-rounds
  [0.097, '01/04/2009', 'A'],
  [0.440, '01/11/2010', 'B'],
  [1.5, '01/07/2011', 'C'],
  [4.8, '01/07/2011', 'D-1'],
  [5, '01/05/2012', 'D-2'],
  [10, '01/05/2015', 'E'],
  [15, '01/06/2015', 'F'],
  [21, '01/08/2017', 'G'],
  [47, '01/08/2019', '‘The epic SoftBank round’'], // https://www.businesswire.com/news/home/20190108005751/en/WeWork-Closes-6-Billion-Investment-SoftBank
  [7.3, '12/31/2019'],
  [2.9, '05/20/2020'],
  [2.9, new Date()]
].map(([val, d, label]) => ({ value: val, date: new Date(d), label }))

  // Civilization chart
  formatYear = year => year < 0 ? `${-year} BC` : `${year} AD` // formatYear uses a ternary operator to dynamically format the year in the data. Such a cool d3 thing! 😎

  var civ_options = {
    height: civilizations.length * 16,
    marginLeft: 120,
    x: {
      axis: "top",
      grid: true,
      tickFormat: formatYear
    },
    y: {
      axis: null,
      domain: d3.sort(civilizations, d => d.start).map(d => d.civilization)
    },
    marks: [
    Plot.barX(civilizations, {
      x1: "start",
      x2: "end",
      fill: "region",
      title: (d) =>
        `${d.civilization} \nStart: ${d.start}\nEnd: ${d.end}\nRegion: ${d.region}`, // \n makes a new line
        y: "civilization"
      }),
    Plot.text(civilizations, {
      x: "start",
      y: "civilization",
      text: "civilization",
      textAnchor: "end",
      dx: -6
    })
    ]
  };

  var wework = {
    marks: [
      Plot.lineY(wework, {x: "date", y: "value", curve: "step-after", strokeWidth: 1, stroke: "steelblue"}),
      Plot.text(wework, {x: "date", y: "value", text: "label", dx: -5, dy: -5}),
      Plot.dot(wework, {x: "date", y: "value", fill: "white", stroke: "black"})
    ]
  };

  // Draw the plot (data local on page)
  document.getElementById("civilizations").appendChild(Plot.plot(civ_options));
  document.getElementById("wework").appendChild(Plot.plot(wework));

  var boxY = function boxY(data, {
    x = null,
    y = {transform: x => x},
    fill = "#ccc",
    stroke = "currentColor",
  } = {}) {
    const group = x == null ? Plot.groupZ : Plot.groupX;
    return Plot.marks(
      Plot.ruleX(data, group({y1: iqr1, y2: iqr2}, {x, y, stroke})),
      Plot.barY(data, group({y1: quartile1, y2: quartile3}, {x, y, fill})),
      Plot.tickY(data, group({y: "median"}, {x, y, stroke, strokeWidth: 2})),
      Plot.dot(data, Plot.map({y: outliers}, {x, y, z: x, stroke}))
      );
  };
  var outliers = function outliers(values) {
    const r1 = iqr1(values);
    const r2 = iqr2(values);
    return values.map(v => v < r1 || v > r2 ? v : NaN);
  };

  var iqr1 = V => {
    const hi = quartile1(V);
    const lo = hi - 1.5 * (quartile3(V) - hi);
    return d3.min(V, v => lo <= v && v <= hi ? v : NaN);
  };

  var iqr2 = V => {
    const lo = quartile3(V);
    const hi = lo + 1.5 * (lo - quartile1(V));
    return d3.max(V, v => lo <= v && v <= hi ? v : NaN);
  };

  var quartile1 = V => d3.quantile(V, 0.25);
  var quartile3 = V => d3.quantile(V, 0.75);


  // Use Promises to async request data
  var promises = [d3.json("data/drugs.json"), d3.csv("data/aapl.csv",d3.autoType),d3.csv("data/hadcrut.csv",d3.autoType), d3.csv("https://gist.githubusercontent.com/JesseCHowe/099f4b8e1a029c0b4af35b1edc1989f7/raw/8c18ed9a0940c734d423c3f2699ee063279533ec/morley.csv",d3.autoType)];

  // You can request multiple srcs in a promise
  myDataPromises = Promise.all(promises);

  // After data is successfully fetched, generate viz
  myDataPromises.then(function(data) {
    // Define the data
    var drugs = data[0];
    var aapl = data[1];
    var hadcrut = data[2];
    var morley = data[3];

    var apple_area = {
      y: {
        grid: true
      },
      marks: [
      Plot.areaY(aapl, {x: "Date", y: "Close", fill: "#ccc"}),
      Plot.lineY(aapl, {x: "Date", y: "Close", title: "Close"})
      ]
    };

    var drug_bar = {
      x: {
        // domain: d3.sort(drugs, d => -d.Pleasure).map(d => d.Pleasure),
        label: null,
        tickSize: 0,
        tickRotate: -35,
      },
      color: {
        domain: ["small", "big"],
        range: ["hsl(168, 78%, 41%)", "hsl(0, 0%, 88%)"]
      },
      y: {
        grid: true,
        ticks: 8,
      },
      marks: [
      // Draw a bar for drug in drugs
      Plot.barY(drugs, { x: "Drug", y: "Pleasure", title: "Drug", fill: d => d.Pleasure > 2.4 ? "small" : "big"}),
      // Add a text label above each bar
      Plot.text(drugs, {x: "Drug", y: "Pleasure", text: d => (d.Pleasure).toFixed(1), dy: -5}),]
    };

    var anomaly_barcode = { 
      x: {
        round: true
      },
      color: {
        type: "diverging",
        scheme: "BuRd"
      },
      marks: [
      Plot.barX(hadcrut, {
          x1: d => d.year, // start of current year
          x2: d => d3.utcYear.offset(d.year), // start of next year
          fill: "anomaly",
          title: "year",
        })
      ],
    };

    var anomaly_dot = {
      y: {
        grid: true,
        tickFormat: "+f",
        label: "↑ Surface temperature anomaly (°F)"
      },
      color: {
        type: "diverging",
        scheme: "BuRd"
      },
      marks: [
        Plot.ruleY([0]),
        Plot.dot(hadcrut, {x: "year", y: "anomaly", stroke: "anomaly"})
      ]
    };

    // From Bostock, of course: https://observablehq.com/@observablehq/plot-box
    var morley = {
      y: {
        grid: true,
        inset: 6
      },
      x:{ label:"Experiment"},
      marks: [
      boxY(morley, {x: "Expt", y: "Speed"})
      ]
    };

    // From Fil: https://observablehq.com/@fil/plot-bubble-matrix?collection=@fil/plot-examples
    // var drug_bubble = {
    //   r: {
    //     type: "linear",
    //     range: [5, 28]
    //   },
    //   color: {
    //     scheme: "RdYlGn",
    //     domain: [1, 5]
    //   },
    //   x: {
    //     domain: ["Mean_Physical_harm", "", "Mean Social harm", " ", "Pleasure", "Psychological", "Physical"],
    //     axis: "top",
    //     label: null,
    //     tickSize: 0,
    //     tickRotate: -35
    //   },
    //   y: {
    //     domain: d3
    //       .groupSort(
    //         drugs,
    //         // Sort by Z-Score, break ties by Key Skill * epsilon
    //         (v) =>
    //           v.find((d) => d.field === "Z-Score").value +
    //           1e-6 * v.find((d) => d.field === "Key Skill").value,
    //         (d) => d.name
    //       )
    //       .reverse(),
    //     label: null,
    //     tickSize: 0
    //   },
    //   marks: [
    //     Plot.dot(drugs, {
    //       filter: (d) => d.field !== "Z-Score",
    //       x: "field",
    //       y: "name",
    //       r: "value",
    //       fill: "value"
    //     }),
    //     Plot.dot(drugs, {
    //       filter: (d) => d.field === "Z-Score",
    //       x: "field",
    //       y: "name",
    //       r: (d) => d["value"] * 0.5,
    //       fill: "steelblue",
    //       fillOpacity: (d) => (d["value"] - 7) * 0.6
    //     }),

    //     Plot.text(drugs, {
    //       x: "field",
    //       y: "name",
    //       text: "value",
    //       fill: "white"
    //     })
    //   ],
    // };

    // Drug scatter plot 
    var drug_scatter = {
      // Inset the chart so outliers don't appear on the edges
      inset: 10,
      grid: true,
      y: {        
        nice: true, // Nice is a convenience function that automatically rounds to the nearest whole number
      },
      marks: [
      // Draw a dot for each drug in drugs
      Plot.dot(drugs, {x: "Mean Social harm", y: "Mean_Physical_harm",r: "Pleasure", title:  "Drug", fill: "Drug"}),
      // Add a text label above the dot
      Plot.text(drugs, {x: "Mean Social harm", y: "Mean_Physical_harm", text: d => d.Drug === "Solvents" ? "" : d.Drug, dy: -8, dx: -1}),
      Plot.ruleY([0]),
      ]
    };

    // Draw the plots (data fetched)
    document.getElementById("drug_bar").appendChild(Plot.plot (drug_bar));
    document.getElementById("apple_area").appendChild(Plot.plot (apple_area));
    document.getElementById("anomaly_barcode").appendChild(Plot.plot (anomaly_barcode));
    document.getElementById("anomaly_dot").appendChild(Plot.plot (anomaly_dot));
    document.getElementById("morley").appendChild(Plot.plot (morley));
    document.getElementById("drug_bubble").appendChild(Plot.plot (drug_bubble));
    document.getElementById("drug_scatter").appendChild(Plot.plot (drug_scatter));
  });
</script>
</body>
</html>