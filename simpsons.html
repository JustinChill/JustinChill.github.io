<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
  <title>Simpsons tribute</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A tribute to the Simpsons, by the data">
  <meta name="author" content="Justin Chill">
  <!-- OpenGraph tags -->
  <meta name="keywords" content="The Simpsons, stats, chart, data viz, homage, doh, Homer, Marge, Maggie, Bart, Lisa, Grandpa, Moe's, Kwik-e-Mart">
  <meta name="robots" content="all">
  <meta content="en_US" property="og:locale">
  <meta content="JustinChill" property="og:site_name">
  <meta content="website" property="og:type">
  <meta content="https://justinchill.com/simpsons.html" property="og:url"> 
  <meta content="Simpsons tribute" property="og:title">
  <meta content="A tribute to the Simpsons, by the data" property="og:description">
  <meta content="https://www.justinchill.com/blog.html" property="og:see_also">
  <link rel="canonical" href="https://www.justinchill.com/simpsons.html">
  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Simpsons tribute">
  <meta name="twitter:description" content="A tribute to the Simpsons, by the data">
  
  <link type="text/plain" href="humans.txt" rel="author">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="/favicon.ico">
  <meta name="theme-color" content="#fac5cb">
  
  <script type="module">
    document.documentElement.classList.remove('no-js');
    document.documentElement.classList.add('js');
  </script>

  <style type="text/css">
    .hero {
      position: relative;
      background: #fac5cb center/cover no-repeat;
      height: 90vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .hero::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* background-color: rgba(0, 0, 0, 0.1); Black color with 10% opacity */
      z-index: 1; /* Ensure the overlay is behind the content */
    }

    .hero-content {
      text-align: center;
      color: #fff;
      background-blend-mode: multiply;
      z-index: 2; /* Ensure the content is on top of the overlay */
    }

    .hero-title {
      color: #fff;
      font-size: 3em;
      margin-bottom: 20px;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .hero-subtitle {
      color: #fff;
      font-size: 1.5em;
      margin-bottom: 30px;
    }
    .hero-title,.hero-subtitle{
      animation: fadeInUp 1s ease-in-out;
    }
    
    .simpsons-logo{
      margin: 2rem 0;
    }
    .simpsons-logo > img{
      padding: 1rem;      
    }

    #painting {
      -moz-transform: rotate(-2deg);
      -ms-transform: rotate(-2deg);
      -webkit-transform: rotate(-2deg);
      transform: rotate(-2deg);
      -moz-transform-origin: 50% -40px 0 0 50%;
      -ms-transform-origin: 50% -40px 0 0 50%;
      -webkit-transform-origin: 50% -40px 0 0 50%;
      transform-origin: left 45px -3px;
      position: relative;
      display: inline-block;
      background: #211309;
      width: 300px;
      height: 234px;
      border: solid 3px #211309;
      margin: var(--spacer-4) auto;
    }
    #painting:before, #painting:after {
      content: " ";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-style: solid;
      border-color: transparent;
      border-width: 25px;
    }
    #painting:before {
      top: 2px;
      bottom: 2px;
      border-color: transparent #bb6c39;
    }
    #painting:after {
      left: 2px;
      right: 2px;
      border-color: #bb6c39 transparent;
    }
    #painting .nail {
      -moz-border-radius: 50%;
      -webkit-border-radius: 50%;
      border-radius: 50%;
      position: absolute;
      background: #211309;
      top: -40px;
      left: 0;
      right: 0;
      height: 6px;
      width: 6px;
      margin: auto;
    }
    #painting .nail:before, #painting .nail:after {
      -moz-transform-origin: 0 0 0;
      -webkit-transform-origin: 0 0 0;
      transform-origin: 0 0 0;
      content: " ";
      position: absolute;
      background: #211309;
      height: 50px;
      width: 2px;
      left: 2px;
      top: 2px;
    }
    #painting .nail:before {
      -moz-transform: rotate(-35deg);
      -ms-transform: rotate(-35deg);
      -webkit-transform: rotate(-35deg);
      transform: rotate(-35deg);
    }
    #painting .nail:after {
      -moz-transform: rotate(35deg);
      -ms-transform: rotate(35deg);
      -webkit-transform: rotate(35deg);
      transform: rotate(35deg);
    }
    #painting .plaque {
      -moz-border-radius: 4px;
      -webkit-border-radius: 4px;
      border-radius: 4px;
      position: absolute;
      background: #ffbf22;
      font-size: 11px;
      left: 0;
      right: 0;
      bottom: 5px;
      width: 125px;
      margin: auto;
      border: solid 2px #211309;
      z-index: 10;
    }
    #painting .plaque:before, #painting .plaque:after {
      -moz-border-radius: 50%;
      -webkit-border-radius: 50%;
      border-radius: 50%;
      content: " ";
      position: absolute;
      background: #211309;
      top: 0;
      bottom: 0;
      width: 2px;
      height: 2px;
      margin: auto;
    }
    #painting .plaque:before {
      left: 2px;
    }
    #painting .plaque:after {
      right: 2px;
    }
    #painting .background {
      position: absolute;
      top: 28px;
      left: 28px;
      right: 28px;
      bottom: 28px;
      background: #211309;
      border-top: solid 144px #a3cacd;
      border-bottom: solid 25px #8ca1bd;
    }
    #painting .boat {
      -moz-border-radius-bottomleft: 12px 22px;
      -webkit-border-bottom-left-radius: 12px 22px;
      border-bottom-left-radius: 12px 22px;
      -moz-border-radius-bottomright: 12px 22px;
      -webkit-border-bottom-right-radius: 12px 22px;
      border-bottom-right-radius: 12px 22px;
      position: absolute;
      background: #c95539;
      width: 136px;
      height: 21px;
      top: 153px;
      left: 0;
      right: 0;
      border: solid 2px #211309;
      margin: auto;
    }
    #painting .boat:before {
      -moz-border-radius: 0 0 7px 7px;
      -webkit-border-radius: 0;
      border-radius: 0 0 7px 7px;
      content: " ";
      position: absolute;
      background: #c95539;
      width: 152px;
      height: 6px;
      top: -10px;
      left: -12px;
      border: solid 2px #211309;
    }
    #painting .boat:after {
      -moz-border-radius: 4px 4px 0 0;
      -webkit-border-radius: 4px;
      border-radius: 4px 4px 0 0;
      content: " ";
      position: absolute;
      background: #c95539;
      width: 4px;
      height: 100px;
      top: -112px;
      left: 50%;
      margin-left: -4px;
      border: solid 2px #211309;
    }
    #painting .boat .sail-left {
      -moz-transform: rotate(22deg);
      -ms-transform: rotate(22deg);
      -webkit-transform: rotate(22deg);
      transform: rotate(22deg);
      top: -100px;
      left: 14px;
    }
    #painting .boat .sail-left, #painting .boat .sail-left:before {
      -moz-border-radius: 4px;
      -webkit-border-radius: 4px;
      border-radius: 4px;
      content: " ";
      position: absolute;
      border-style: solid;
      border-color: transparent transparent #211309 transparent;
      border-width: 0 22px 77px 31px;
    }
    #painting .boat .sail-left:before {
      -moz-border-radius: 3px;
      -webkit-border-radius: 3px;
      border-radius: 3px;
      content: " ";
      top: 4px;
      left: -28px;
      border-bottom-color: #ffffff;
      border-width: 0 19px 71px 28px;
    }
    #painting .boat .sail-right {
      -moz-transform: rotate(-23deg);
      -ms-transform: rotate(-23deg);
      -webkit-transform: rotate(-23deg);
      transform: rotate(-23deg);
      top: -106px;
      left: 64px;
    }
    #painting .boat .sail-right, #painting .boat .sail-right:before {
      -moz-border-radius: 4px;
      -webkit-border-radius: 4px;
      border-radius: 4px;
      content: " ";
      position: absolute;
      border-style: solid;
      border-color: transparent transparent #211309 transparent;
      border-width: 0 26px 85px 24px;
    }
    #painting .boat .sail-right:before {
      -moz-border-radius: 3px;
      -webkit-border-radius: 3px;
      border-radius: 3px;
      content: " ";
      top: 5px;
      left: -22px;
      border-bottom-color: #ffffff;
      border-width: 0 24px 78px 22px;
    }
    #painting .clouds {
      -moz-border-radius: 50%;
      -webkit-border-radius: 50%;
      border-radius: 50%;
      -moz-box-shadow: 0 0 0 0 #ffffff, 16px 3px 0 -4px #ffffff, 29px 5px 0 -9px #ffffff, 0 0 0 2px #211309, 16px 3px 0 -2px #211309, 29px 5px 0 -7px #211309, 185px 10px 0 -4px #ffffff, 170px 10px 0 2px #ffffff, 150px 10px 0 -2px #ffffff, 185px 10px 0 -2px #211309, 170px 10px 0 4px #211309, 150px 10px 0 0 #211309;
      -webkit-box-shadow: 0 0 0 0 #ffffff, 16px 3px 0 -4px #ffffff, 29px 5px 0 -9px #ffffff, 0 0 0 2px #211309, 16px 3px 0 -2px #211309, 29px 5px 0 -7px #211309, 185px 10px 0 -4px #ffffff, 170px 10px 0 2px #ffffff, 150px 10px 0 -2px #ffffff, 185px 10px 0 -2px #211309, 170px 10px 0 4px #211309, 150px 10px 0 0 #211309;
      box-shadow: 0 0 0 0 #ffffff, 16px 3px 0 -4px #ffffff, 29px 5px 0 -9px #ffffff, 0 0 0 2px #211309, 16px 3px 0 -2px #211309, 29px 5px 0 -7px #211309, 185px 10px 0 -4px #ffffff, 170px 10px 0 2px #ffffff, 150px 10px 0 -2px #ffffff, 185px 10px 0 -2px #211309, 170px 10px 0 4px #211309, 150px 10px 0 0 #211309;
      position: absolute;
      background: #ffffff;
      width: 30px;
      height: 30px;
      top: 50px;
      left: 45px;
    }

    /*Plot*/
    p.title{
      font-family: 'Ubuntu', sans-serif;
      text-align: left;
      font-size: calc(16px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
      padding-bottom: 0;
      margin-top: 2rem; 
      pointer-events: none;
    }
    .plot text {
      color: #656568;
      font-family: 'Ubuntu', sans-serif;
      font-size: calc(4px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
      padding: 2rem;
    }
    figcaption {
      color: #656568;
      text-align: right;
    }

    #simpsonsEpisodes svg[class*="plot"]{
      margin: 20px 0px;
    }

    #simpsonsEpisodes svg[class*="plot"], #simpsonsSeasons svg[class*="plot"] {
      font-size: 10px;
      background: none;
    }


    /* Random quote */
    .container {
      grid-column: 1 / -1;
    }

    div.quote-left {
      position: relative;
      display: flex;
      flex-direction: row;
      min-height: 244px;
      /*      max-height: 220px;*/
      border-radius: 16px;
      background-color: hsl(22, 82%, 39%);
      box-shadow: 0px 0px 15px gray;
      /*margin-bottom: 60px;*/
    }
    div.quote-left div.quote-image {
      width: 40%;
      height: inherit;
      /*background-image: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/812449/user-blue1.jpg);*/
      background-position: top;
      background-size: cover;
      background-repeat: no-repeat;
      border-radius: 16px 0px 0px 16px;
      background-color: hsl(44, 92%, 63%);
      clip-path: polygon(0 0, 100% 0, 80% 100%, 0 100%);
    }
    div.quote-left div.quote-circle {
      position: absolute;
      left: 33%;
      top: 80px;
      z-index: 10;
      height: 50px;
      width: 50px;
      border-radius: 50%;
      background-color: white;
      color: #2b457d;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }

    div.quote-circle-inner {
      height: 35px;
      width: 35px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      box-shadow: 0px 0px 10px #2b457d;
    }

    div.quote-text {
      flex: 1;
      padding: 10px 30px 10px 30px;
      border-radius: 0px 16px 16px 0px;
      font-style: italic;
      font-size: 18px;
      font-weight: 100;
      line-height: 22px;
    }

    div.quote-text p{
      color: white;
      /*font-family: proxima-nova, sans-serif;*/
      font-size: calc(18px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
    }
    div.quote-text div.quote-author p{
      text-align: right;
      font-size: 20px;
      font-weight: 500;
      font-style: normal;
      color: white;
      font-size: calc(14px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
    }

    div.quote-right {
      position: relative;
      display: flex;
      flex-direction: row;
      /*max-height: 220px;*/
      min-height: 220px;
      border-radius: 16px;
      background-color: hsl(22, 82%, 39%);
      box-shadow: 0px 0px 15px gray;
      /*margin-bottom: 60px;*/
    }
    div.quote-right div.quote-image {
      width: 40%;
      height: inherit;
      /*background-image: url(https://s3-us-west-2.amazonaws.com/s.cdpn.io/812449/user-gray1.jpg);*/
      background-position: top;
      background-repeat: no-repeat;
      background-size: cover;
      border-radius: 0px 16px 16px 0px;
      clip-path: polygon(20% 0, 100% 0, 100% 100%, 0 100%);
      background-color: hsl(44, 92%, 63%);
    }
    div.quote-right div.quote-circle {
      position: absolute;
      right: 33%;
      top: 80px;
      z-index: 10;
      height: 50px;
      width: 50px;
      border-radius: 50%;
      background-color: white;
      color: #147b63;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    div.quote-right div.quote-circle div.quote-circle-inner {
      height: 35px;
      width: 35px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      box-shadow: 0px 0px 10px #147b63;
    }
    div.quote-right div.quote-text {
      flex: 1;
      padding: 10px 20px 10px 40px;
      border-radius: 0px 16px 16px 0px;
      color: white;
      /*font-family: proxima-nova, sans-serif;*/
      font-style: italic;
      /*font-size: 18px;*/
      /*font-weight: 100;*/
      /*line-height: 22px;*/
    }
    div.quote-right div.quote-text div.quote-author {
      text-align: right;
      /*font-size: 20px;*/
      /*font-weight: 500;*/
      font-style: normal;
      color: hsl(209, 61%, 16%);
    }

    i.fa-quote-left{
      background-image: url(imgs/Quote_left_font_awesome.svg);
      background-repeat: no-repeat;
      width: 100%;
      height: 100%;
      max-width: 20px;
      max-height: 20px;
      opacity: .9; 
    }
    i.fa-quote-right{
      background-image: url(imgs/Quote_right_font_awesome.svg);
      background-repeat: no-repeat;
      width: 100%;
      height: 100%;
      max-width: 20px;
      max-height: 20px;
      opacity: .9;
    }
    @media screen and (max-width: 680px) {
      .nav{
        background: #fac5cb center/cover no-repeat;
        margin: 0;
        padding: var(--gutter);
        color: white;
      }
      
      a.nav__item {color: white}
      
      div.quote-right div.quote-circle {right: 26%}
      div.quote-left div.quote-circle {left: 30%}
    }
  </style>

</head>
<body>
  <nav class="nav" role="navigation">
    <div class="nav__list">
      <a href="index.html" class="nav__item" aria-label="Homepage">Home</a>
      <a href="blog.html" class="nav__item" aria-label="Blog section">Blog</a>
      <a href="now.html" class="nav__item" aria-label="Now page">Now</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>

  <main role="main">
    <header class="hero">
      <div class="hero-content">
        <figure aria-label="Illustration of a framed picture hanging on a pink wall. The picture depicts a simple sailboat on water with two clouds. Below, a plaque reads Scene From Moby Dick.">
          <div id="painting">
            <div class="nail"></div>
            <div class="plaque">Scene From Moby Dick</div>
            <div class="background"></div>
            <div class="boat">
              <div class="sail-left"></div>
              <div class="sail-right"></div>
            </div>
            <div class="clouds"></div>
          </div>
        </figure>

        <div>
          <h2 class="article-category">Doh!</h2>
          <h1 class="article-title hero-title">The Simpsons by the data</h1>
          <h2 class="article-subtitle hero-subtitle">Insert couch gag here</h2>
        </div>
      </div>
    </header>
    <article> 
        <p>The Simpsons needs no introduction. At 34 seasons and counting it is the longest-running scripted series in the history of American primetime television<a href="#longrunning" aria-describedby="footnote-label" id="longrunning-ref"></a>. If Bart Simpson aged in real time with the show, <a href="https://screenrant.com/simpsons-characters-real-life-age-how-old/#:~:text=Bart%20Simpson's%20Age,years%2Dold%20as%20of%202020.">he would now be in his 40s</a>. </p> 
        <p>As a fan of the show, I present here a few short analyses about Springfield, from the show’s dialogue to its TV ratings. All code used for this post is available on <a href="https://github.com/JustinChill/JustinChill.github.io/blob/main/simpsons.html">GitHub</a>.</p>

        <p class="title">Ratings for The Simpsons have declined over time</p>
        <figure class="mid-size" id="simpsonsRatings"></figure>
        <figcaption>Data: <a href="https://www.imdb.com/title/tt0096697/">IMDB</a></figcaption>
        <p><em>You Only Move Twice</em> aired <time datetime="1996-11-03">Nov 3, 1996</time> and remains the highest scoring episode with an IMDB score of <strong>9.3</strong>. Ratings decline steadily after season 10 but the decline has largely tapered off. The lowest scoring episode to date came in season 23 with <em>Lisa Goes Gaga</em> (<strong>3.9</strong>).</p>

        <p class="title">600+ episodes </p>
        <figure id="simpsonsEpisodes"></figure> 
        <figcaption>Data: <a href="https://www.imdb.com/title/tt0096697/">IMDB</a></figcaption>
        <p>This matrix graph visualizes each episode as an individual cell, shaded according to IMDB score. This creates a heatmap, allowing you to see trends more quickly.</p>  

        <p class="title">Average rating by season</p>
        <figure id="simpsonsSeasons"></figure> 
        <figcaption>Data: <a href="https://www.imdb.com/title/tt0096697/">IMDB</a></figcaption>
        <p>Here we look at the difference between episodes within each season. Early seasons have a tighter grouping of episodes, meaning they all score roughly the same. Starting in season 6 we start to see a greater spread of episodes. Season 23 has the greatest range of scores within a season (&plusmn; 4.4).</p>
        <figure id="seasonavg"></figure>
        <!-- <p class="title">Average rating by season</p> -->
        <figure id="simpsonsFacet"></figure> 

        <!-- Random Simpson's quote -->
        <h2>Random quote</h2>
        <div class="container">
          <div></div>
          <figure id="lineup"></figure>
        </div>

        <div class="quote-text bubble" >
          <p class="display-quote"></p>
          <p class="display-character"></p>
        </div>

        <div class = '' id="quote-direction">
          <div class = 'quote-image' id="quote-image-left"></div>
          <div class = 'quote-circle'>
            <div class = 'quote-circle-inner'>
              <i class="" id="fa-quote-direction"></i>
            </div>
          </div>
          <div class = 'quote-text'>
            <p id="quote">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and... </p>
            <div class = 'quote-author'>
              <p id="character">- Matt Groening</p>
            </div>
          </div>
          <div class = 'quote-image' id="quote-image-right"></div>
        </div>

        <p class="visually-hidden">Quotes powered by <a href="https://github.com/JLuboff/TheSimpsonsQuoteAPI">The Simpsons Quote API</a>. A great project!</p>

        <p>Quotes provided from the wonderful <a href="https://github.com/JLuboff/TheSimpsonsQuoteAPI">Simpsons Quote API</a>. It's available at <code>https://thesimpsonsquoteapi.glitch.me/quotes</code> and it returns a random Simpsons quote, character, link to their picture, and the direction the character is facing. I've used that last tidbit to make sure the character is always facing their quote.</p>


        <!-- Work in progress -->
        <!-- <h2>Episodes by IMDB rating</h2> -->
        <!-- <figure id="best-eps"></figure>  -->

        <!-- <h2>Every season</h2> -->
        <!-- <figure id="seasons"></figure>  -->

        <!-- <h2>Top ten episodes</h2> -->
        <!-- <figure id="top_ten"></figure>       -->

        <h2>Simpsons no-nos</h2>
        <figure class="mid-size">
          <img src="https://i.imgur.com/d7FqN8Z.jpg" alt="Simpsons no-nos" loading="lazy">
        </figure>
        <p>In the book <a href="https://www.slideshare.net/DGIREDeportes/matt-groening-cartooning-with-the-simpsons?related=1">Cartooning with the Simpsons</a> the authors include this full page graphic on what specifically to avoid when drawing the head of a Simpson. It is a great example of the effect that every detail can have on an observer!</p>
        <p>Although The Simpsons is loved by many, it is evident that the show has seen its better days. As Matt Groening, the creator of The Simpsons once said<a href="#finalquote" aria-describedby="footnote-label" id="finalquote-ref"></a>: "The problem with doing a sitcom which has lasted more than 300 episodes is you're trying not to repeat yourself, you're trying to surprise the audience, and you're trying to keep everybody who works on the show surprised. As a result, the show has gone off in some very peculiar directions."</p>

      </article>
    </main>
    <footer>
      <h2 id="footnote-label">Footnotes</h2>
      <ol>
        <li id="finalquote">Matt Groening quoted by <a href="https://www.npr.org/2014/08/20/341884238/prepare-for-the-simpsons-marathon-with-interviews-from-the-fresh-air-archives">NPR</a>.<a href="#finalquote-ref" aria-label="Back to content">↩</a></li>
      </ol>
      <div>
        <p>Justin Chill &copy; 2025.</p>
        <span><a href="https://github.com/JustinChill/JustinChill.github.io" target="_blank"><img src="imgs/github.svg" alt="GitHub logo" class="icon">Source code</a></span>    
      </div>
    </footer>
    <script type="text/javascript" src="js/growup.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3"></script>
    <script src="https://cdn.jsdelivr.net/npm/@observablehq/plot"></script>
    <script>
    // Wait for the page to load
    window.onload = () => {
      randomQuote()
    }
    
    // Fetch quotes from the Simpsons API 
    const randomQuote = () => {

      // Change the number of quotes at the end of the URL:
      fetch('https://thesimpsonsquoteapi.glitch.me/quotes?count=40')
      .then((res) => {
        return res.json()
      }).then((data) => {
        // After data fetched
        // console.log(data)

        showRandomQuote(data)
        showLineup(data)
        var randomQuote = [data];
      })
    }

    showRandomQuote = (randomQuote) => {
      document.getElementById('character').innerText = `${randomQuote[0].character}`

      document.getElementById('quote').innerText = `${randomQuote[0].quote}`

      // Set the character direction
      document.getElementById('quote-direction').className += `quote-${randomQuote[0].characterDirection.toLowerCase()}`

      // Set the quote image direction
      document.getElementById('fa-quote-direction').className += `fa-quote-${randomQuote[0].characterDirection.toLowerCase()}`

      // Place the image depending on character direction
      if (randomQuote[0].characterDirection == "Left"){
        document.getElementById('quote-image-right').style.display ="none";
        document.getElementById('quote-image-left').style.backgroundImage = "url("+`${randomQuote[0].image}`;+")";
      }else{
        document.getElementById('quote-image-left').style.display ="none";
        document.getElementById('quote-image-right').style.backgroundImage = "url("+`${randomQuote[0].image}`;+")";
      }
    }
    showLineup = (data) => {
    }

    // Thicken the plot

    var bucket = {}

    // Use Promises to async request data
    var promises = [d3.json("data/simpsons_imdb.json", function(d) {
      return { // Accessor function to convert strings to numbers, dates
          episode_no_abs: +d.episode_no_abs,  // convert column to number
          season_no: +d.season_no, 
          episode_no: +d.episode_no, 
          // episode_name: d.episode_name,
          episode_airdate: new Date(d.episode_airdate), // convert column to Date
          episode_score: +d.episode_score,
          episode_votes: +d.episode_votes, 
          // episode_description: d.episode_description,
        }}
        )];
    var element = d3.select('figure.mid-size').node();
    var width = element.getBoundingClientRect().width; // get width of article so graphic is responsive
    var size = 12;

    var averages = [{"season":1,"average_imdb_rating":7.807692307692307},{"season":2,"average_imdb_rating":8.04090909090909},{"season":3,"average_imdb_rating":8.154166666666665},{"season":4,"average_imdb_rating":8.268181818181818},{"season":5,"average_imdb_rating":8.336363636363636},{"season":6,"average_imdb_rating":8.312},{"season":7,"average_imdb_rating":8.324},{"season":8,"average_imdb_rating":8.219999999999999},{"season":9,"average_imdb_rating":7.8439999999999985},{"season":10,"average_imdb_rating":7.569565217391306},{"season":11,"average_imdb_rating":7.290909090909093},{"season":12,"average_imdb_rating":7.361904761904761},{"season":13,"average_imdb_rating":7.140909090909091},{"season":14,"average_imdb_rating":7.077272727272727},{"season":15,"average_imdb_rating":7.045454545454546},{"season":16,"average_imdb_rating":7.042857142857143},{"season":17,"average_imdb_rating":6.863636363636362},{"season":18,"average_imdb_rating":7},{"season":19,"average_imdb_rating":6.935},{"season":20,"average_imdb_rating":6.895238095238096},{"season":21,"average_imdb_rating":6.821739130434783},{"season":22,"average_imdb_rating":6.804545454545456},{"season":23,"average_imdb_rating":6.813636363636365},{"season":24,"average_imdb_rating":6.777272727272727},{"season":25,"average_imdb_rating":6.831818181818181},{"season":26,"average_imdb_rating":6.704545454545454},{"season":27,"average_imdb_rating":6.786363636363635},{"season":28,"average_imdb_rating":6.6}];

    // You can request mutliple srcs in a promise
    myDataPromises = Promise.all(promises);

    // After data is successfully fetched, generate viz
    myDataPromises.then(function(data) {

      // Define the data
      var simpsons_imdb = data[0];

      // Line chart ratings over time
      var simpsonsRatings = {
        width: width,
        style: {fontSize: size, background: "none", },
        inset: 1,
        marginRight:0,
        x: {
          labelAnchor: "center",
          zero: true,
          label: "Episode number",
          labelOffset: 40,
        },
        y: {
          label: "IMDB Rating",
          labelAnchor: width > 450 ? "center" : "top",
          labelOffset: 35,
          grid: true,
          nice: true,
          clamp: true,
          tickSize: 0,
          tickPadding: 10,
          domain: [1,10]
        },
        color: {
          scheme: "PiYG",
        },
        marks: [
        Plot.line(simpsons_imdb, {
          x: "episode_no_abs", 
          y: "episode_score", 
          stroke: "hsl(42, 87%, 55%)",
          curve: "catmull-rom",
        }),
        Plot.areaY(simpsons_imdb, {
          x: "episode_no_abs", 
          y: "episode_score", 
          fill: "RGBA(252, 229, 136, .5)",
        }),
        Plot.dot(simpsons_imdb, Plot.selectMinY({
          x: "episode_no_abs",
          y: "episode_score",
          fill: "hsl(42, 87%, 55%)",
          r: 2,
          title: (d) => `${d.episode_name}\nS${d.season_no} E${d.episode_no}\n${d.episode_score} IMDB rating`, 
        })),
        Plot.dot(simpsons_imdb, Plot.selectMaxY({
          x: "episode_no_abs",
          y: "episode_score",
          fill: "hsl(42, 87%, 55%)",
          r: 2,
          title: (d) => `${d.episode_name}\nS${d.season_no} E${d.episode_no}\n${d.episode_score} IMDB rating`,           
        })),
        Plot.text(simpsons_imdb, Plot.selectMinY({
          x: "episode_no_abs",
          y: "episode_score",
          text: d => d.episode_name + ' (' +  d.episode_score + ')',
          textAnchor: "center",
          fontSize: size,
          dy: 12,
        })),
        Plot.text(simpsons_imdb, Plot.selectMaxY({
          x: "episode_no_abs",
          y: "episode_score",
          text: d => d.episode_name + ' (' +  d.episode_score + ')',
          textAnchor: "center",
          fontSize: size,
          dy: -12,
          dx: 4
        })),
        Plot.text(simpsons_imdb.filter(d => d.episode_no == "1" && d.episode_no_abs > 1 && d.season_no % 5 == 0), {
          x: "episode_no_abs", 
          text: d => `Season ` + d.season_no,
          fontWeight: 500,
          // textAnchor: "end",
          frameAnchor: "bottom",
          dy: -40, 
          dx: 10, 
          rotate: 270,
        }),
        ]
      };

      // Plot Initializer
      // https://observablehq.com/@observablehq/plot-colorcontrast-custom-transform?collection=@observablehq/plot-examples
      colorContrast = ({ luminance = 60, ...options }) =>
      Plot.initializer(options, (data, facets, channels, scales) => {
        const contrast = (color) =>
        d3.hcl(color).l > luminance ? "black" : "white";
        return {
          channels: {
            fill: {
              ...channels.fill,
              scale: undefined,
              value:
                  channels.fill == null // when options.fill is a constant color such as "red"
                  || scales.color == null // when the scale isn't yet available (e.g. hexbin below)
                  ? Array.from(data).fill(contrast(options.fill))
                  : Array.from(channels.fill.value, (value) => contrast(scales.color(value)))
                }
              }
            };
          });

      // Matrix cell chart episodes by season, episode no.
      var simpsonsEpisodes = {      
        width: width,
        style: { cursor: "default",fontSize: size,},
        grid: true,
        aspectRatio: 1,
        inset: width > 450 ? 1 : 0.5,
        x: {
          axis: "top",
          label: "Episode",
          labelOffset: 40,
          tickSize: 0,
        },
        y: {
          label: "Season",
          labelOffset: 40,
          tickSize: 0,
        },
        color: {
          type: "linear",
          scheme: "RdYlBu",
          unknown: "#ddd", 
          legend: true,
          label: "IMDB Rating",
          clamp: true,
          nice: true,
          tickSize: 0,
          style: {fontSize: size},
          domain: [1,10], // show nicer scale
          range: [.25,1], // clamping the color scheme gives tighter control over the color range
        },
        marks: [
        Plot.frame({stroke: "hsl(209, 23%, 60%)"}),
        Plot.cell(simpsons_imdb, {
          x: "episode_no",
          y: "season_no",
          title: (d) => `${d.episode_name}\nS${d.season_no} E${d.episode_no}\n${d.episode_score} IMDB rating`, 
          fill: "episode_score",
          tip: true,
        }),
        Plot.text(simpsons_imdb, colorContrast({
          x: "episode_no",
          y: "season_no",
          text: d => d.episode_score?.toFixed(1), 
          fill: "episode_score",
        })),
        ]
      };

      // Average rating by season
      var simpsonsSeasons = {      
        width: width,
        // inset: 1,
        style: {fontSize: size, background: "none",},
        marginRight: 0,
        grid: true,
        x: {
          label: "Season",
          labelAnchor: "center",
          labelOffset: 35,
          clamp: true,
          tickSize: 0,
        },
        y: {
          label: "IMDB Rating",
          labelAnchor: "center",
          labelOffset: 35,
          grid: true,
          nice: true,
          clamp: true,
          tickSize: 0,
          domain: [1,10]
        },
        color: {
          scheme: "RdYlBu",
          type: "linear",
          unknown: "#ddd", 
          legend: true,
          label: "IMDB Rating",
          clamp: true,
          nice: true,
          tickSize: 0,
          style: {fontSize: size},
          domain: [1,10], // show nicer scale
          range: [.25,1], // clamping the color scheme gives tighter control over the color range
        },        
        marks: [
          Plot.ruleX(simpsons_imdb, 
            Plot.groupX({y1: "min", y2: "max"}, {
              x: "season_no", 
              y: "episode_score",
              stroke: "hsl(211, 12%, 43%)"
            })
            ),
          Plot.line(simpsons_imdb, 
            Plot.groupX({y: "median"}, {
              x: "season_no", 
              y: "episode_score", 
              stroke: "#e41a1c"
            })
            ),
          Plot.dot(simpsons_imdb, {
            x: "season_no", 
            y: "episode_score",
            fill: "episode_score",
            title: (d) => `${d.episode_name}\nS${d.season_no} E${d.episode_no}\n${d.episode_score} IMDB rating`, 
            tip: true,
          }),
          Plot.text(simpsons_imdb, Plot.selectMinY({
            x: "season_no",
            y: "episode_score",
            text: d => d.episode_name + ' (' +  d.episode_score + ')',
            textAnchor: "center",
            fontSize: size,
            dy: 12,
          })),
          Plot.text(simpsons_imdb, Plot.selectMaxY({
            x: "season_no",
            y: "episode_score",
            text: d => d.episode_name + ' (' +  d.episode_score + ')',
            textAnchor: "center",
            fontSize: size,
            dy: -12,
            dx: 4
          })),
          ]
        };

        var simpsonsFacet = {
          width: width,
          style:{fontSize: size},
          height: 600,
          inset: 5,
          marginLeft: 110,
          color: { type: "categorical" },
          facet: { data: simpsons_imdb, y: "season_no", marginRight: 90 }, // ← gives facet labels more space
          marks: [
            Plot.frame(),
            Plot.dot(simpsons_imdb, { x: "episode_no", y: "episode_score", stroke: "episode_score" })
          ]
        };

        var seasonavg = {
          width: width,
          style:{fontSize: size, textTransform: "capitalize"},
          color: { 
            type: "linear", 
            legend: true, 
            domain: [0, 10], 
            scheme: "RdYlBu",
            label: "Season average", 
            domain: [1,10], // show nicer scale
            range: [.25,1], // clamping the color scheme gives tighter control over the color range
          },
          y: { grid: true,label: "Season average"},
          x: { labelAnchor: "right", },
          marks: [
              Plot.barY(averages, {
                x: "season",
                y: "average_imdb_rating",
                fill: "average_imdb_rating"
              }),
              Plot.text(
                averages,
                colorContrast({
                  x: "season",
                  y: "average_imdb_rating",
                  fill: "average_imdb_rating",
                  dy: 8,
                  text: (d) => d.average_imdb_rating?.toFixed(1),
                  title: "title"
                })
              ),
              Plot.ruleY([0])
            ]
        };

        document.getElementById("simpsonsRatings").appendChild(Plot.plot(simpsonsRatings));
        document.getElementById("simpsonsEpisodes").appendChild(Plot.plot(simpsonsEpisodes));
        document.getElementById("simpsonsSeasons").appendChild(Plot.plot(simpsonsSeasons));
        document.getElementById("seasonavg").appendChild(Plot.plot(seasonavg));
        // document.getElementById("simpsonsFacet").appendChild(Plot.plot(simpsonsFacet));
      })

myDataPromises.catch(function() {
  console.log('🚨 Something has gone wrong fetching data.')
})

</script>
</body>
</html>