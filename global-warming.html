<!DOCTYPE html>
<html lang="en">
<head>
  <title>How 2016 became Earth's Hottest Year on Record</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Global temperature trends based on NASA's Goddard Institute for Space Studies.">
  <meta name="author" content="Justin Chill">

  <style type="text/css">
    figure, figcaption{
      grid-column: 2 / -2;
    }
    figcaption#temps_legend{
      margin-bottom: 0;
      grid-column: 4;
      display: flex;
      flex-direction: row-reverse;
    }
    figcaption, figcaption a{
      text-align: right;
      font-size:  calc(10px + (22 - 16) * ((100vw - 320px) / (1300 - 320)))
    }

</style>
</head>
<body>
  <nav class="nav">
    <div class="nav__list">
      <a href="index.html" class="nav__item">Home</a>
      <a href="blog.html" class="nav__item">Blog</a>
      <a href="fun.html" class="nav__item">Fun</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>
  
  <main role="main">
    <article>
       <div class="article-hero">
        <h2 class="article-category">Post</h2>
        <h1 class="article-title">Global Temperature Trends</h1>
        <h2 class="article-subtitle">How 2016 became Earth's hottest year on record</h2>
      </div>

    <figcaption id="temps_legend"></figcaption>
    <figure id="temps"></figure>
    <figcaption>Data: <a href="https://data.giss.nasa.gov/gistemp/">NASA's Goddard Institute for Space Studies</a></figcaption>

    <p>Of the 17 hottest years ever recorded, 16 have now occurred since 2000. The chart above is my recreation of a wonderful graphic from <a href="https://nyti.ms/3x89ywY">the New York Times</a>, featured in the article, "How 2016 Became Earth’s Hottest Year on Record". Thanks to publically available data from NASA we can plot recorded temperatures by data going back to 1880. Once visualized we can clearly see temperatures climbing and increasingly rapidly in the past 2 decades.</p>
    

    <h3>Original graphic</h3>
    <a href="https://www.nytimes.com/interactive/2017/01/18/science/earth/2016-hottest-year-on-record.html"><img src="imgs/nyt-global-temps.png" alt="The New York Times original graphic, visualizing global temperatures since 1880." title="The New York Times original graphic, visualizing global temperatures since 1880."></a>
    

</article>
</main>
<footer>
  <h2 id="footnote-label">Footnotes</h2>
  <ol>

  </ol>
  <div>
    <p>Justin Chill © 2021. Thanks for reading!</p>
    <p><a href="https://github.com/JustinChill/JustinChill.github.io" target="_blank"><img src="imgs/github.svg" class="gh">Source code and feedback</a></p>    
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/@observablehq/plot@0.2"></script>

<script type="text/javascript">

  // Copyright 2021, Observable Inc.
  // Released under the ISC license.
  // https://observablehq.com/@d3/color-legend
  function legend(d,{
    color,
    title,
    tickSize = 6,
    width = 320,
    height = 44 + tickSize,
    marginTop = 18,
    marginRight = 0,
    marginBottom = 16 + tickSize,
    marginLeft = 0,
    ticks = width / 64,
    tickFormat,
    tickValues
  } = {}) {
    const svg = d3.select(d).append("svg")
      .attr("width", width)
      .attr("height", height)
      .attr("viewBox", [0, 0, width, height])
      .style("overflow", "visible")
      .style("display", "block");

    let tickAdjust = g => g.selectAll(".tick line").attr("y1", marginTop + marginBottom - height);
    let x;

    // Continuous
    if (color.interpolate) {
      const n = Math.min(color.domain().length, color.range().length);

      x = color.copy().rangeRound(d3.quantize(d3.interpolate(marginLeft, width - marginRight), n));

      svg.append("image")
        .attr("x", marginLeft)
        .attr("y", marginTop)
        .attr("width", width - marginLeft - marginRight)
        .attr("height", height - marginTop - marginBottom)
        .attr("preserveAspectRatio", "none")
        .attr("xlink:href", ramp(color.copy().domain(d3.quantize(d3.interpolate(0, 1), n))).toDataURL());
    }

    // Sequential
    else if (color.interpolator) {
      x = Object.assign(color.copy()
        .interpolator(d3.interpolateRound(marginLeft, width - marginRight)), {
          range() {
            return [marginLeft, width - marginRight];
          }
        });

      svg.append("image")
        .attr("x", marginLeft)
        .attr("y", marginTop)
        .attr("width", width - marginLeft - marginRight)
        .attr("height", height - marginTop - marginBottom)
        .attr("preserveAspectRatio", "none")
        .attr("xlink:href", ramp(color.interpolator()).toDataURL());

      // scaleSequentialQuantile doesn’t implement ticks or tickFormat.
      if (!x.ticks) {
        if (tickValues === undefined) {
          const n = Math.round(ticks + 1);
          tickValues = d3.range(n).map(i => d3.quantile(color.domain(), i / (n - 1)));
        }
        if (typeof tickFormat !== "function") {
          tickFormat = d3.format(tickFormat === undefined ? ",f" : tickFormat);
        }
      }
    }

    // Threshold
    else if (color.invertExtent) {
      const thresholds = color.thresholds ? color.thresholds() // scaleQuantize
        :
        color.quantiles ? color.quantiles() // scaleQuantile
        :
        color.domain(); // scaleThreshold

      const thresholdFormat = tickFormat === undefined ? d => d :
        typeof tickFormat === "string" ? d3.format(tickFormat) :
        tickFormat;

      x = d3.scaleLinear()
        .domain([-1, color.range().length - 1])
        .rangeRound([marginLeft, width - marginRight]);

      svg.append("g")
        .selectAll("rect")
        .data(color.range())
        .join("rect")
        .attr("x", (d, i) => x(i - 1))
        .attr("y", marginTop)
        .attr("width", (d, i) => x(i) - x(i - 1))
        .attr("height", height - marginTop - marginBottom)
        .attr("fill", d => d);

      tickValues = d3.range(thresholds.length);
      tickFormat = i => thresholdFormat(thresholds[i], i);
    }

    // Ordinal
    else {
      x = d3.scaleBand()
        .domain(color.domain())
        .rangeRound([marginLeft, width - marginRight]);

      svg.append("g")
        .selectAll("rect")
        .data(color.domain())
        .join("rect")
        .attr("x", x)
        .attr("y", marginTop)
        .attr("width", Math.max(0, x.bandwidth() - 1))
        .attr("height", height - marginTop - marginBottom)
        .attr("fill", color);

      tickAdjust = () => {};
    }

    svg.append("g")
      .attr("transform", `translate(0,${height - marginBottom})`)
      .call(d3.axisBottom(x)
        .ticks(ticks, typeof tickFormat === "string" ? tickFormat : undefined)
        .tickFormat(typeof tickFormat === "function" ? tickFormat : undefined)
        .tickSize(tickSize)
        .tickValues(tickValues))
      .call(tickAdjust)
      .call(g => g.select(".domain").remove())
      .call(g => g.append("text")
        .attr("x", marginLeft)
        .attr("y", marginTop + marginBottom - height - 6)
        .attr("fill", "currentColor")
        .attr("text-anchor", "start")
        .attr("font-weight", "bold")
        .text(title));

    return svg.node();
  }

  function ramp(color, n = 256) {
    var canvas = document.createElement('canvas');
    canvas.width = n;
    canvas.height = 1;
    const context = canvas.getContext("2d");
    for (let i = 0; i < n; ++i) {
      context.fillStyle = color(i / (n - 1));
      context.fillRect(i, 0, 1, 1);
    }
    return canvas;
  };


  var element = d3.select('figure').node();
  var width = element.getBoundingClientRect().width; // get width of article so graphic is responsive
  var size = 12;

  // Use Promises to async request data
  var promises = [d3.csv("data/global-temps.csv",d3.autoType)];
  myDataPromises = Promise.all(promises);

  // After data is successfully fetched, generate viz
  myDataPromises.then(function(data) {
    
    // Define the data
    var hadcrut = data[0];

    var temps = {
      width: width,
      // height: width / 1.5,
      style:{fontSize: size},
      x: {
        grid: true,
        nice: true,
        ticks: 5,
        tickSize: 0,
      },
      y: {
        grid: true,
        nice: true,
        tickFormat: "+f",
        label: "↑ Surface temperature change (°C)",
        tickSize: 0,
        ticks: 4,
      },
      style: {
        background: "hsl(0, 0%, 99%)",
        color: "rgba(0, 0, 0, 0.84)",
      },
      color: {
        type: "quantile",
        quantiles: 69,
        scheme: "BuRd",
        reverse: false,
      },
      marks: [
      Plot.ruleY([0], {stroke:"rgba(0,0,0,.3)"}),
      Plot.dot(hadcrut, {x: "date", y: "value", r: width < 500 ? 1 : 3, stroke: "value",fill: "value", title: (d) =>
        `${d3.timeFormat("%B %d, %Y")(d["date"])} \nTemp: ${d3.format("+.2f")(d["value"])}`,}),
      Plot.text(hadcrut, {filter: d=> d.date == "Sun Jan 31 2016 19:00:00 GMT-0500 (EST)", x: "date", y: "value", dx: -40, dy: -2, text: d => d3.timeFormat("%B %Y")(d.date)}),
      Plot.text(hadcrut, {filter: d=> d.date == "Mon Feb 29 2016 19:00:00 GMT-0500 (EST)", x: "date", y: "value", dx: -42, dy: 4, text: d => d3.timeFormat("%B %Y")(d.date)}),
      Plot.text(hadcrut, {filter: d=> d.date == "Wed Feb 28 1990 19:00:00 GMT-0500 (EST)", x: "date", y: "value", dx: -14 , dy: -10, text: d => d3.timeFormat("%B %Y")(d.date)}),
      Plot.text(hadcrut, {filter: d=> d.date == "Tue Dec 31 1957 19:00:00 GMT-0500 (EST)", x: "date", y: "value", dx: -8, dy: -10, text: d => d3.timeFormat("%B %Y")(d.date)}),
      Plot.text(hadcrut, {filter: d=> d.date == "Thu Dec 31 1925 19:00:00 GMT-0500 (EST)", x: "date", y: "value", dx: -8, dy: -10, text: d => d3.timeFormat("%B %Y")(d.date)}),
      Plot.text(hadcrut, {filter: d=> d.date == "Thu Jan 31 1889 19:00:00 GMT-0500 (EST)", x: "date", y: "value", dx: -5, dy: -10, text: d => d3.timeFormat("%B %Y")(d.date)}),      
      ]
    };

    var mycolor = Plot.plot(temps).scale("color");
    console.log(mycolor);

    var temps_legend = {
      title: "Temperature Change (°C)",
      color: d3.scaleLinear(mycolor.domain, mycolor.range),
      tickFormat: "+.1f",
      tickSize: 0,
      width: 210,
    };

    document.getElementById("temps").appendChild(Plot.plot(temps));
    document.getElementById("temps_legend").appendChild(legend("#temps_legend", temps_legend));
  });
  </script>
</body>
</html>