<!DOCTYPE html>
<html lang="en">
<head>
	<title>APIs 101</title>
	<link rel="stylesheet" href="style.css" />
	<script src="script.js"></script>
	
  <!-- 	<link href="https://cdn.jsdelivr.net/npm/simple-datatables@latest/dist/style.css" rel="stylesheet" type="text/css"> -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Introduction to APIs">
  <meta name="author" content="Justin Chill">

  <style type="text/css">
    .small-img {
      max-height: 300px;
      margin: 0 auto;
      width: auto;
    }

    .row {
      display: flex;
      flex-wrap: wrap;
      padding: 0 4px;
      grid-column: 2/7;
    }

    /* Create four equal columns that sits next to each other */
    .column {
      flex: 25%;
      max-width: 25%;
      padding: 0 4px;
    }

    .column img {
      margin-top: 8px;
      vertical-align: middle;
      width: 100%;
    }

    /* Responsive layout - makes a two column-layout instead of four columns */
    @media screen and (max-width: 800px) {
      .column {
        flex: 50%;
        max-width: 50%;
      }
    }

    /* Responsive layout - makes the two columns stack on top of each other instead of next to each other */
    @media screen and (max-width: 600px) {
      .column {
        flex: 100%;
        max-width: 100%;
      }
    }

  </style>

</head>
<body>
  <nav class="nav">
    <div class="nav__list">
      <a href="index.html" class="nav__item">Home</a>
      <a href="blog.html" class="nav__item">Blog</a>
      <a href="fun.html" class="nav__item">Fun</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>

  <main role="main">
    <article>
     <div class="article-hero">
      <h2 class="article-category">Post</h2>
      <h1 class="article-title">What is an API?</h1>
      <h2 class="article-subtitle">An introduction</h2>
    </div> 
    <p>Exchanging data is a key function for any software service, and that exchange is usually facilitated using an API. An API is a layer that sits between two systems and handles the communication, so neither side needs to know about how the other works directly.
     An <b>API</b>, or Application Programming Interface, are instructions that computers use to query (request) information from each other, like requesting a database. This usually happens over the internet.</p>
    <p>One way to think about the role an API plays is to imagine sitting at a restaurant. You review the menu in front of you and, when you're ready, place an order with the waiter. The waiter brings your order to the kitchen and returns with your food. In this example, your order is a <b>request</b>, the waiter is the <b>API</b>, the kitchen is our <b>server</b>, and the <b>response</b> is our food from the kitchen.</p>
    <img class="small-img" src="https://i0.wp.com/blogs.perficient.com/files/API-example-scaled.jpg">

    <h2>Words you may have heard</h2>
    <h3>Endpoint</h3>
    <p>Endpoints mean the different kinds of urls in your api ends with. They are associated with the GET, POST, PUT, DELETE methods of your APIs.</p>
    <img src="https://public-apis.io/static/948da6cf2aed90ec9e7ad54d7174b924/01267/endpoint.png" alt="endpoint">
    <h3>Routes</h3>
    <p>These mean the paths of your API endpoint.</p>
    <img src="https://public-apis.io/static/2b81ca9902929dc794adefc18a9afb04/02cd5/routes.png" alt="endpoint">

    <h3>Query Params</h3>
    <p>The parameters that are appended to your endpoint with a ? in the url. Its a way to send simple data to your api. In this example, <b>sort</b> is the query parameter and it&#39;s <b>value</b> is name:</p>
    <img src="https://public-apis.io/static/5f0f1bf30a256e6a9a53490e072edaf2/ad12c/queryparam.png" alt="endpoint">

    <h3>REST</h3>
    <p>Stands for Representational State Transfer. The modern standard for making APIs. Most people confuse this as a technology, but actually this is more of a concept, a standard set of best practices to make APIs.</p>

    <h3>URL Encoded</h3>
    <p>Sometimes you need to pass some things in your API query params which could create some issues like spaces, forward slashes etc. You need to encode these special characters so that they can be sent over the internet. You can find a reference of these characters on w3schools.</p>

    <h2>CRUD</h2>
    <p>CRUD stands for Create, Read, Update, and Delete. These are the four most common use cases of an API, and the way you request them is called a <b>method</b>.</p>
    <h3>Get method</h3>
    <p>The most frequently used method used to get data from a server. Say you have an API and you want to get data from it, you call the API with GET. This is a read only method, and you can see it in action right in your browser. This link returns a list of <code>JSON</code> objects: <a href="https://jsonplaceholder.typicode.com/todos/">https://jsonplaceholder.typicode.com/todos</a>. This is the R in CRUD.</p> 
    <h3>Post method</h3>
    <p>The POST method is usually used send a request to create a new entry in a your database. This is the C in CRUD. Usually we send the data in a body parameter to a POST method, this way your data won't be exposed inline GET methods query parameters.</p>
    <h3>Put method</h3>
    <p>This works similar to a POST request, but is contextual, PUT method is usually used when you want to update a existing item in your server. This is the U in CRUD.</p>
    <h3>Delete method</h3>
    <p>Used for deleting someting in your database. Pretty self explanatory, this one. NOTE: It is not strictly necessary to use PUT to update and DELETE to delete something from your sever. However, using PUT and DELETE is more readable and semantic way of using methods. This is the D in CRUD.</p>

    <div class="container">
      <div class="row text-center">
        <div class="col-md-10 offset-md-1">
          <p id="dogInfo"></p>
          <div class="alert alert-danger" role="alert"></div>
          <div id="randomImageContainer"></div>
          <p class="dogInfo h5">Random image of a...</p>
          <button class="btn btn-primary random">Random Doggo!</button>
        </div>    
      </div>
    </div>
    

    <div class="container-fluid">
      <div class="container">
        <div class="row text-center">
          <div class="col-md-10 offset-md-1">
            <div class="form-group">
              <select name="doggosDropdown" id="doggoDropDown" class="form-control"></select>
            </div>
            <div id="listImageContainer"></div>
            <button class="btn btn-primary list">More from this breed please!</button>
          </div>
        </div>
      </div>
    </div>


    <div class="row"> 
     <div class="column">
       <div class="card-deck mb-3 text-center"> </div>
       <button class="btn btn-primary grid">Refresh Grid</button>
     </div>
   </div>
 </div>

</article>
</main>

<footer>
  <h2 id="footnote-label">Footnotes</h2>
  <ol>
    <li id="footnotes">Courtesy the wonderful <a href="https://public-apis.io/learn/">Public API</a> lessons.<a href="#footnotes-ref" aria-label="Back to content">↩</a></li>

  </ol>
  <div>
    <p>Justin Chill © 2022. Thanks for reading!</p>
    <p><a href="https://github.com/JustinChill/JustinChill.github.io" target="_blank"><img src="imgs/github.svg" class="icon">Source code and feedback</a></p>    
  </div>
</footer>

<!-- CDN -->
<!-- <script src="https://cdn.jsdelivr.net/npm/simple-datatables@latest"></script> -->

<!-- Custom Code -->
<!-- <script>
  fetch('https://api.publicapis.org/entries?category=animals&cors=yes')
  .then(response => response.json())
  .then(data => {
    if (!data.length) {
      return
    }

    let table = new simpleDatatables.DataTable(".table", {
      data: {
        headings: Object.keys(data[0]),
        data: data.map(item => Object.values(item))
      },
    })
  })
</script> -->

<script type="text/javascript">
  // Fetch + dog API  
  //GLOBAL VARIABLES
  const randomButton = document.querySelector('.random');
  const dogList = document.getElementById('doggoDropDown');
  const listButton = document.querySelector('.list');
  const refreshButton = document.querySelector('.grid');


  //EVENT LISTENERS
  // window load
  window.addEventListener('load', populateList);
  // window.addEventListener('load', getDogTerm);
  window.addEventListener('load', createImageGrid);
  //click and change
  randomButton.addEventListener('click', getRandomDoggo);
  dogList.addEventListener('change', getBreedImage);
  listButton.addEventListener('click', getBreedImage);
  refreshButton.addEventListener('click', createImageGrid);

  //FETCH CALLS
  //wikipedia dog term serach
  // function getDogTerm() {
  //   fetch('https://en.wikipedia.org/w/api.php?action=opensearch&origin=*&search=dog&formatversion=2').
  //   then(checkStatus).
  //   then(response => response.json()).
  //   then(data => displayDogInfo(data)).
  //   catch(error => notifyUser(error));
  // }

  //random dog image
  function getRandomDoggo() {
    fetch('https://dog.ceo/api/breeds/image/random').
    then(checkStatus).
    then(response => response.json()).
    then(data => handleData(data)).
    catch(error => notifyUser(error));
  }

  //populate List
  function populateList() {
    fetch('https://dog.ceo/api/breeds/list/all').
    then(checkStatus).
    then(response => response.json()).
    then(data => createListItems(data.message)).
    catch(error => notifyUser(error));
  }

  //getBreedImage
  function getBreedImage() {
    //get list value
    let selectedBreed = dogList.options[dogList.selectedIndex].value;
    //build url
    let url = `https://dog.ceo/api/breed/${selectedBreed}/images`;
    //fetch call
    fetch(url).
    then(checkStatus).
    then(response => response.json()).
    then(data => getImageURL(data.message)).
    catch(error => console.log(error));
  }

  function createImageGrid() {
    fetch('https://dog.ceo/api/breeds/image/random/3').
    then(checkStatus).
    then(response => response.json()).
    then(data => createGrid(data.message)).
    catch(error => notifyUser(error));
  }

  //HELPER FUNCTIONS
  //checkStatus
  function checkStatus(response) {
    if (response.ok) {
      return Promise.resolve(response);
    } else {
      return Promise.reject(new Error(response.statusText));
    }
  }

  //display Dog Info
  // function displayDogInfo(data) {
  //   //populate paragraph
  //   document.getElementById('dogInfo').innerHTML = `<strong>${capitalize(data[0])}:</strong> ${data[2][0]} <a href="${data[3][0]}" alt="read more on wikipedia"> Read more on wikipedia</a>`;
  // }


  //handleData
  function handleData(data) {
    let url = data.message;
    console.log(url);
    let regex = /https:\/\/images\.dog\.ceo\/breeds\/(\w+\-?\w+)\/.+/g;
    let breedName = regex.exec(url);
    document.getElementById('randomImageContainer').innerHTML = `<img alt="random image of a ${fixBreed(breedName[1])}" src='${url}'/>`;
    document.querySelector('.dogInfo').innerHTML = `<p class="h5">Random image of a ${fixBreed(breedName[1])}</p>`;
  }

  //getImageURL
  function getImageURL(data) {
    //get random number
    let randomNumberURL = data[Math.floor(Math.random() * data.length) + 1];
    listImageContainer.innerHTML = `<img src="${randomNumberURL}" alt="${extractBreedName(data)}"/>`;
  }

  //createListItems
  function createListItems(data) {
    let output = '';
    Object.keys(data).forEach(key => output += `<option value="${key}">${fixBreed(key)}</option>`);
    document.getElementById('doggoDropDown').innerHTML = output;
  }

  //notifyUser
  // function notifyUser(error) {
  //   const errorContainer = document.querySelector('.alert');
  //   errorContainer.innerHTML = `There was an error with the server request (${error}). <br> Click the button again.`;
  //   errorContainer.style.display = 'block';
  //   setTimeout(() => {
  //     errorContainer.innerHTML = '';
  //     errorContainer.style.display = 'none';
  //   }, 4000);
  // }

  //fixBreed
  function fixBreed(breedName) {
    if (breedName === 'germanshepherd') {
      return 'German Shepherd';
    } else if (breedName === 'mexicanhairless') {
      return 'Mexican Hairless';
    } else if (breedName === 'stbernard') {
      return 'St. Bernard';
    } else if (breedName === "african") {
      return 'African Wild Dog';
    } else if (breedName === 'bullterrier') {
      return 'Bull Terier';
    }
    return capitalize(breedName);
  }

  //capitalize breed name
  function capitalize(breedName) {
    return breedName.replace(/\-/g, ' ').
    split(" ").
    map(word => word.charAt(0).toUpperCase() + word.slice(1)).
    join(" ");
  }

  //extract breed name
  function extractBreedName(data) {
    let regex = /https:\/\/images\.dog\.ceo\/breeds\/(\w+-?\w+)\/\w+\.\w+/g;
    let match = regex.exec(data);
    return fixBreed(match[1]);
  }

  //createGrid
  function createGrid(data) {
    let output = '';
    const container = document.querySelector('.card-deck');
    data.map(item => {
      output +=
      `
      <div class="card mb-4 box-shadow">
      <div class="card-header">
      <h4 class="my-0 font-weight-normal">${extractBreedName(item)}</h4>
      </div>
      <div class="card-body">
      <img src="${item}" class="img-fluid" alt="${extractBreedName(item)}"/>
      </div>
      </div>    
      `;
    });
    container.innerHTML = output;
  }
</script>

</script>
</body>
</html>