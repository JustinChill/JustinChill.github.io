<!DOCTYPE html>
<html lang="en">
<head>
  <title>Caffeine Data Viz</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Visualizing the amount of caffeine in foods.">
  <meta name="author" content="Justin Chill">

  <style type="text/css">
  article > figure{
    min-width: 0;
  }
  figcaption, figcaption > a {
    margin-bottom: 0;
    font-size: calc(8px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
    text-align: right;
  }
  .coffee-section{
    padding: 1em 0;
    margin-top: 2.5rem;
  }
  .cup {
    width:76px;
    height:76px;
    background:#dedede;
    border-radius:50%;
    position:relative;
    left:50%;
    margin-left:-38px;
    box-shadow:-4px -1px 0 rgba(0,0,0,0.2);
  }

  .cup:after{
    content:"";
    width:66px;
    height:66px;
    position:absolute;
    border-radius:50%;
    background:linear-gradient(-45deg, #cbcbcb, #f2f2f2 );
    left:50%;
    margin-left:-33px;
    top:5px;
  }

  .coffee{
    width:47px;
    height:47px;
    background:#613317;
    /*background-image: linear-gradient(15deg, transparent 0px, transparent 29px, rgba(255,255,255,0.05) 29px, rgba(255,255,255,0.05) 47px);*/
    border-radius:50%;
    position:absolute;
    left:50%;
    margin-left:-25px;
    z-index:1;
    top:50%;
    margin-top:-26px;
    border:3px solid #e9e9e9;
    box-shadow:-3px 2px 0 rgba(0,0,0,0.1);
    transform:rotate(30deg);
    transition:transform 0.3s;
  }

  .coffee:after{ /*assa*/
   content:"";
   width:15px;
   height:8px;
   position:absolute;
   left:-19px;
   top:18px;
   background:linear-gradient(90deg, #d6d6d6, #aeaeae);
   box-shadow:0px 2px 0 rgba(0,0,0,0.2);
 }

 .coffee:before {
  content:"";
  width:47px;
  height:47px;
  background-image: radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 95%), radial-gradient(5% 9%, ellipse, rgba(255,255,255,0.1), transparent 5%), radial-gradient(0% 0%, ellipse, rgba(255,255,255,0.3), transparent 55%);
  background-image: -webkit-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 95%), -webkit-radial-gradient(5% 9%, ellipse, rgba(255,255,255,0.1), transparent 5%), -webkit-radial-gradient(0% 0%, ellipse, rgba(255,255,255,0.3), transparent 55%);
  background-image: -moz-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 95%), -moz-radial-gradient(5% 9%, ellipse, rgba(255,255,255,0.1), transparent 5%), -moz-radial-gradient(0% 0%, ellipse, rgba(255,255,255,0.3), transparent 55%);
  position:absolute;
  left:0;
  border-radius:50%;
}
.cup:hover .coffee {
  transform:rotate(15deg);
}

.smoke {
  width:70px;
  height:100px; 
  background:;
  position:absolute;
  left:50%;
  margin-left:-40px;
  top:43px;
  background-image: -webkit-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -webkit-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -webkit-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%), -webkit-radial-gradient(55% 35%, ellipse, rgba(255,255,255,0.2), transparent 15%);
  background-image: -moz-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -moz-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -moz-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%), -moz-radial-gradient(55% 35%, ellipse, rgba(255,255,255,0.2), transparent 15%);
  background-image: radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%), radial-gradient(55% 35%, ellipse, rgba(255,255,255,0.2), transparent 15%);
  animation:bk 11s infinite ;
}

.smoke:after {
  content:"";
  width:100px;
  height:100px; 
  background:;
  position:absolute;
  background-image: -webkit-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -webkit-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -webkit-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%);
  background-image: -moz-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -moz-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -moz-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%);
  background-image: radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%);
  animation:bk 2s 1s infinite;
}


@keyframes bk {
  0%{ background-position:0 0; opacity:0; }
  15%, 85% { opacity:1;}
  100%{ background-position:-20px -25px, -5px -25px, 0px -25px, 0px -25px; opacity:0;}
}

@keyframes animateCubes {
  0% {
    transform: translateY(-2px) rotate(45deg);
  }
  100% {
    transform: translateY(2px) rotate(45deg);
  }
}

.mug, .container {
  display: flex;
  justify-content: center;
  align-items: center;
}

.soft-drink-cup-3-wrapper .soft-drink-cup, .soft-drink-cup-2-wrapper .soft-drink-cup, .soft-drink-cup-1-wrapper .soft-drink-cup {
  width: 52px;
  height: 80px;
  margin-left: 40px;
  background-color: #fff;
  clip-path: polygon(0 0, 100% 0%, 80% 100%, 20% 100%);
}

.container {
  height: 60vh;
  background-color: #bc9b71;
  border-radius: 5px;
  margin: 4rem 0;
}

.mug {
  width: 52px;
  height: 60px;
  background-color: #fff;
  z-index: 3;
  border-radius: 5px;
}
.mug:before {
  content: "";
  width: 25px;
  height: 25px;
  border: 10px solid #fff;
  border-radius: 50%;
  margin-left: -58px;
  z-index: 2;
}

.soft-drink-cup-1-wrapper .soft-drink-cup:before {
  content: "";
  position: absolute;
  width: 40px;
  height: 45px;
  margin: 30px 0 0 6px;
  background-color: #b58c6a;
  clip-path: polygon(5% 0, 95% 0%, 80% 100%, 20% 100%);
}
.soft-drink-cup-1-wrapper .soft-drink-cup .ice-cubes {
  position: absolute;
  width: 0;
  height: 0;
  border-top: 8px solid #d5b498;
  border-right: 8px solid #fff;
  margin: 26px 0 0 11px;
  background-color: #fff;
  transform: rotate(45deg);
  z-index: 2;
  animation: animateCubes 1s infinite alternate;
}
.soft-drink-cup-1-wrapper .soft-drink-cup .ice-cubes:before {
  content: "";
  position: absolute;
  width: 8px;
  height: 8px;
  margin: -4px 0 0 24px;
  transform: rotate(30deg);
  background-color: #fff;
  z-index: 3;
}
.soft-drink-cup-1-wrapper .soft-drink-cup .ice-cubes:after {
  content: "";
  position: absolute;
  width: 8px;
  height: 8px;
  margin: 2px 0 0 25px;
  transform: rotate(55deg);
  background-color: #d5b498;
}
.soft-drink-cup-1-wrapper .cap {
  position: absolute;
  width: 60px;
  height: 7px;
  margin: -85px 0 0 36px;
  background-color: #fff;
  z-index: 2;
}
.soft-drink-cup-1-wrapper .straw {
  position: absolute;
  width: 5px;
  height: 80px;
  margin: -130px 0 0 63px;
  background-color: #377c43;
}

.soft-drink-cup-2-wrapper .soft-drink-cup:before {
  content: "";
  position: absolute;
  width: 100%;
  height: 45px;
  margin-top: 5px;
  background-color: #a07d4e;
}
.soft-drink-cup-2-wrapper .cap {
  position: absolute;
  width: 60px;
  height: 7px;
  margin: -85px 0 0 36px;
  background-color: #333333;
  box-shadow: inset 0 2px 2px rgba(255, 255, 255, 0.2);
}
.soft-drink-cup-2-wrapper .cap:before {
  content: "";
  position: absolute;
  width: 60px;
  height: 12px;
  margin: -12px 0 0 0px;
  background-color: #333333;
  clip-path: polygon(25% 0, 75% 0, 100% 100%, 0 100%);
}

.soft-drink-cup-3-wrapper .soft-drink-cup {
  position: relative;
  z-index: 2;
}
.soft-drink-cup-3-wrapper .soft-drink-cup svg {
  position: relative;
  z-index: 3;
}
.soft-drink-cup-3-wrapper .soft-drink-cup:before {
  content: "";
  position: absolute;
  width: 100%;
  height: 35px;
  margin-top: 45px;
  background-color: #a07d4e;
}
.soft-drink-cup-3-wrapper .soft-drink-cup:after {
  content: "";
  position: absolute;
  width: 100%;
  height: 40px;
  margin: 5px 0 0 -52px;
  background-color: #d5b498;
  opacity: 0.5;
}
.soft-drink-cup-3-wrapper .cap {
  position: absolute;
  width: 60px;
  height: 55px;
  margin: -135px 0 0 36px;
  background-color: #333333;
  clip-path: circle(50% at 50% 100%);
  z-index: 2;
}
.soft-drink-cup-3-wrapper .straw {
  position: absolute;
  width: 5px;
  height: 50px;
  margin: -150px 0 0 73px;
  background-color: #377c43;
  transform: rotate(15deg);
}

@media screen and (max-width: 680px) {
  .container{
    margin: 1rem 0;
    height: 300px;
  }
  }
</style>
</head>
<body>
  <nav class="nav">
    <div class="nav__list">
      <a href="index.html" class="nav__item">Home</a>
      <a href="blog.html" class="nav__item">Blog</a>
      <a href="fun.html" class="nav__item">Fun</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>

  <section class="coffee-section">
    <div class="cup">
      <div class="coffee"></div>
    </div>
    <div class="smoke"></div>
  </section>
  
  <main role="main">
    <article>
     <div class="article-hero">
      <h2 class="article-category">Post</h2>
      <h1 class="article-title">Caffeine Data Viz</h1>
      <h2 class="article-subtitle">Analyzing caffeine in foods</h2>
    </div>

    <figure id="caffeine_bar"></figure>
    <figcaption>Data: <a href="">Reddit</a></figcaption>

    <p>The Reddit community <a href="https://www.reddit.com/r/dataisbeautiful/">Dataisbeautiful</a> used to host a "data visualization" battle, in which readers are challenged to work with a new dataset. July 2019's data battle challenges us to visualize the amount of caffeine in different foods. Data is provided by the National Center for Biotechnology Information <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4462044/table/T2/?report=objectonly">here</a>.</p>
    <h3>Caffeine distribution by class</h3>
    <figure id="caffeine_box"></figure>
    <p>It's clear that energy drinks contain the most amount of caffeine, on average, than any other category.</p>

    <h3>Caffeine in the "Hot Drink" class</h3>
    <figure id="caffeine_class"></figure>
    <p>Looking at the difference in caffeine levels between teas and coffee.</p>

    <h3>Item by class</h3>
    <figure id="caffeine_facet"></figure>
    <p>This view of the data helps to better show the distribution within each category.</p>

    <div class="container">
      <div class="mug"></div>
      <div class="soft-drink-cup-1-wrapper">
        <div class="soft-drink-cup">
          <div class="ice-cubes"></div>
        </div>
        <div class="cap"></div>
        <div class="straw"></div>
      </div>
      <div class="soft-drink-cup-2-wrapper">
        <div class="soft-drink-cup"></div>
        <div class="cap"></div>
      </div>
      <div class="soft-drink-cup-3-wrapper">
        <div class="soft-drink-cup">
          <svg viewBox="0 0 500 500" preserveAspectRatio="xMinYMin meet">
            <path d="M0,100 C150,200 350,0 500,100 L500,00 L0,0 Z" style="stroke: none; fill:#d5b498;"></path>
          </svg>
        </div>
        <div class="cap"></div>
        <div class="straw"></div>
      </div>
    </div>
  </article>
</main>
<footer>
  <h2 id="footnote-label">Footnotes</h2>
  <div>
    <p>Justin Chill © 2022. Thanks for reading!</p>
    <p><a href="https://github.com/JustinChill/JustinChill.github.io" target="_blank"><img src="imgs/github.svg" class="icon">Source code and feedback</a></p>    
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/d3"></script>
<script src="https://cdn.jsdelivr.net/npm/@observablehq/plot"></script>

<script type="text/javascript">
  // Use Promises to async request data
  var promises = [d3.csv("data/caffeine.csv",d3.autoType)];
  var element = d3.select('figure').node();
  var width = element.getBoundingClientRect().width; // get width of article so graphic is responsive
  var size = 12;
  var scheme = "tableau10";

  var boxY = function boxY(data, {
    x = null,
    y = {transform: x => x},
    fill = "#ccc",
    stroke = "currentColor",
  } = {}) {
    const group = x == null ? Plot.groupZ : Plot.groupX;
    return Plot.marks(
      Plot.ruleX(data, group({y1: iqr1, y2: iqr2}, {x, y, stroke})),
      Plot.barY(data, group({y1: quartile1, y2: quartile3}, {x, y, fill})),
      Plot.tickY(data, group({y: "median"}, {x, y, stroke, strokeWidth: 2})),
      Plot.dot(data, Plot.map({y: outliers}, {x, y, z: x, stroke}))
      );
  };
  var outliers = function outliers(values) {
    const r1 = iqr1(values);
    const r2 = iqr2(values);
    return values.map(v => v < r1 || v > r2 ? v : NaN);
  };

  var iqr1 = V => {
    const hi = quartile1(V);
    const lo = hi - 1.5 * (quartile3(V) - hi);
    return d3.min(V, v => lo <= v && v <= hi ? v : NaN);
  };

  var iqr2 = V => {
    const lo = quartile3(V);
    const hi = lo + 1.5 * (lo - quartile1(V));
    return d3.max(V, v => lo <= v && v <= hi ? v : NaN);
  };
  var quartile1 = V => d3.quantile(V, 0.25);
  var quartile3 = V => d3.quantile(V, 0.75);

  // You can request multiple srcs in a promise
  myDataPromises = Promise.all(promises);

  // After data is successfully fetched, generate viz
  myDataPromises.then(function(data) {
    // Define the data
    var caffeine = data[0];

    var caffeine_bar = {
      width: width,
      style:{fontSize: size},
      marginLeft: 160,
      marginRight: 60,
      marginBottom: 40,
      x: {
        labelOffset: 40,
        grid: true
      },
      color: {
        type: "categorical",
        scheme: scheme,
      },
      y: {
        // grid: true,
        label: null,
        reverse: true,
        domain: d3.sort(caffeine, d => -d["Caffeine (mg)"]).map(d => d.Item),
      },
      marks: [
      Plot.barX(caffeine, { x: "Caffeine (mg)", y: "Item", fill:"Class", title: (d) =>
        `${d.Item} \nCaffeine: ${d["Caffeine (mg)"]}\nClass: ${d.Class}`,}),
      Plot.text(caffeine, {x: "Caffeine (mg)", y: "Item", text: (d) =>
        `${d["Caffeine (mg)"]} mg`, textAnchor: "start", dx: 5})
      // Plot.text(caffeine, {x: "Drug", y: "Pleasure", text: d => (d.Pleasure).toFixed(1), dy: -5}),
      ]
    };

    var caffeine_box = {
      width: width,
      style:{fontSize: size},
      marginTop: 30,
      y: {
        grid: true,
        inset: 6,
      },
      x:{ label:"Class", labelOffset: 50, domain: d3.sort(caffeine, d => -d["Caffeine (mg)"]).map(d => d.Class)},
      color: {
        type: "categorical",
        scheme: scheme,
      },
      marks: [
      boxY(caffeine, {x: "Class", y: "Caffeine (mg)", fill: "Class"})
      ]
    };

    var caffeine_class = {
      width: width,
      style:{fontSize: size},
      marginTop: 30,
      marginBottom: 100,
      x: {
        tickRotate: -35,
        tickSize: 0,
        label: null,
      },
      y: {
        grid: true,
        tickSize: 0,
      },
      marks: [
      Plot.barY(caffeine.filter(d => (d.Class === "Hot Drink")), {x: "Item", y: "Caffeine (mg)", fill: "Class", title: (d) => `${d.Item} \n${d["Caffeine (mg)"]}mg of caffeine`})
      ]
    };

    var caffeine_facet = {
      width: width - 20,
      style:{fontSize: size},
      x: {label: null, ticks: 2, labelOffset: 50, axis: null},
      // y: {label: "↑ Highway mpg", ticks: 6, labelOffset: 90},
      // marginLeft: 20,
      marginTop: 40,
      // marginBottom: 50,
      inset: 4,
      color: {
        type: "categorical",
        scheme: scheme,
      },
      facet: {
        data : caffeine,
        x: "Class",
        label: null,
      },
      marks: [
      Plot.dot(caffeine, {x: "Class", y: "Caffeine (mg)", stroke: "Class", strokeWidth: 1, fill: "Class", title: (d) =>
        `${d.Item} \nCaffeine: ${d["Caffeine (mg)"]}\nClass: ${d.Class}`}),
      Plot.frame({stroke: "#ccc"}),
      ]
    };

    document.getElementById("caffeine_bar").appendChild(Plot.plot(caffeine_bar));
    document.getElementById("caffeine_box").appendChild(Plot.plot(caffeine_box));
    document.getElementById("caffeine_class").appendChild(Plot.plot(caffeine_class));
    document.getElementById("caffeine_facet").appendChild(Plot.plot(caffeine_facet));
  });
</script>
</body>
</html>