<!DOCTYPE html>
<html lang="en">
<head>
  <title>Caffeine Data Viz</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css" />

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Visualizing the amount of caffeine in foods.">
  <meta name="author" content="Justin Chill">

  <style type="text/css">

    figcaption{
      margin-bottom: 0;
      font-size: calc(8px + (22 - 16) * ((100vw - 320px) / (1300 - 320)));
      text-align: right;
    }
    .coffee-section{
      padding: 1em 0;
      margin-top: 2.5rem;
    }
    .cup {
      width:76px;
      height:76px;
      background:#dedede;
      border-radius:50%;
      position:relative;
      left:50%;
      margin-left:-38px;
      box-shadow:-4px -1px 0 rgba(0,0,0,0.2);
    }

    .cup:after{
      content:"";
      width:66px;
      height:66px;
      position:absolute;
      border-radius:50%;
      background:linear-gradient(-45deg, #cbcbcb, #f2f2f2 );
      left:50%;
      margin-left:-33px;
      top:5px;
    }

    .coffee{
      width:47px;
      height:47px;
      background:#613317;
      /*background-image: linear-gradient(15deg, transparent 0px, transparent 29px, rgba(255,255,255,0.05) 29px, rgba(255,255,255,0.05) 47px);*/
      border-radius:50%;
      position:absolute;
      left:50%;
      margin-left:-25px;
      z-index:1;
      top:50%;
      margin-top:-26px;
      border:3px solid #e9e9e9;
      box-shadow:-3px 2px 0 rgba(0,0,0,0.1);
      transform:rotate(30deg);
      transition:transform 0.3s;
    }

    .coffee:after{ /*assa*/
     content:"";
     width:15px;
     height:8px;
     position:absolute;
     left:-19px;
     top:18px;
     background:linear-gradient(90deg, #d6d6d6, #aeaeae);
     box-shadow:0px 2px 0 rgba(0,0,0,0.2);
   }

   .coffee:before {
    content:"";
    width:47px;
    height:47px;
    background-image: radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 95%), radial-gradient(5% 9%, ellipse, rgba(255,255,255,0.1), transparent 5%), radial-gradient(0% 0%, ellipse, rgba(255,255,255,0.3), transparent 55%);
    background-image: -webkit-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 95%), -webkit-radial-gradient(5% 9%, ellipse, rgba(255,255,255,0.1), transparent 5%), -webkit-radial-gradient(0% 0%, ellipse, rgba(255,255,255,0.3), transparent 55%);
    background-image: -moz-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 95%), -moz-radial-gradient(5% 9%, ellipse, rgba(255,255,255,0.1), transparent 5%), -moz-radial-gradient(0% 0%, ellipse, rgba(255,255,255,0.3), transparent 55%);
    position:absolute;
    left:0;
    border-radius:50%;
  }
  .cup:hover .coffee {
    transform:rotate(15deg);
  }

  .smoke {
    width:70px;
    height:100px; 
    background:;
    position:absolute;
    left:50%;
    margin-left:-40px;
    top:43px;
    background-image: -webkit-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -webkit-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -webkit-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%), -webkit-radial-gradient(55% 35%, ellipse, rgba(255,255,255,0.2), transparent 15%);
    background-image: -moz-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -moz-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -moz-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%), -moz-radial-gradient(55% 35%, ellipse, rgba(255,255,255,0.2), transparent 15%);
    background-image: radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%), radial-gradient(55% 35%, ellipse, rgba(255,255,255,0.2), transparent 15%);
    animation:bk 11s infinite ;
  }

  .smoke:after {
    content:"";
    width:100px;
    height:100px; 
    background:;
    position:absolute;
    background-image: -webkit-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -webkit-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -webkit-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%);
    background-image: -moz-radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), -moz-radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), -moz-radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%);
    background-image: radial-gradient(75% 59%, ellipse, rgba(255,255,255,0.2), transparent 25%), radial-gradient(25% 70%, ellipse, rgba(255,255,255,0.2), transparent 15%), radial-gradient(35% 61%, ellipse, rgba(255,255,255,0.2), transparent 10%);
    animation:bk 2s 1s infinite;
  }


  @keyframes bk {
    0%{ background-position:0 0; opacity:0; }
    15%, 85% { opacity:1;}
    100%{ background-position:-20px -25px, -5px -25px, 0px -25px, 0px -25px; opacity:0;}
  }

</style>
</head>
<body>
  <nav class="nav">
    <div class="nav__list">
      <a href="index.html" class="nav__item">Home</a>
      <a href="blog.html" class="nav__item">Blog</a>
    </div>
    <div class="nav__list">
      <a href="http://linkedin.com/in/justinrichardhill/" class="nav__item" target="_blank">LinkedIn</a>
      <a href="#" class="nav__item js-email-link">Email</a>
    </div>
  </nav>

  <section class="coffee-section">
    <div class="cup">
      <div class="coffee"></div>
    </div>
    <div class="smoke"></div>
  </section>
  
  <main role="main">
    <article>
     <div class="article-hero">
      <h2 class="article-category">Post</h2>
      <h1 class="article-title">Caffeine Overload</h1>
      <h2 class="article-subtitle">Analyzing caffeine in foods</h2>
    </div>

    <figure id="caffeine_bar"></figure>
    <figcaption>Data: <a href="">Reddit</a></figcaption>

    <p>The Reddit community <a href="https://www.reddit.com/r/dataisbeautiful/">Dataisbeautiful</a> used to host a "data visualization" battle, in which readers are challenged to work with a new dataset. July 2019's data battle challenges us to visualize the amount of caffeine in different foods. Data provided by the <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4462044/table/T2/?report=objectonly">National Center for Biotechnology Information</a>.</p>
    <h3>Caffeine distribution by class</h3>
    <figure id="caffeine_box"></figure>
    <p>It's clear that energy drinks contain the most amount of caffeine, on average, than any other category.</p>

    <h3>Caffeine in the "Hot Drink" class</h3>
    <figure id="caffeine_class"></figure>
    <p>Looking at the difference in caffeine levels between teas and coffee.</p>

    <h3>Item by class</h3>
    <figure id="caffeine_facet"></figure>
    <p>This view of the data helps to better show the distribution within each category.</p>
  </article>
</main>
<footer>
  <h2 class="visually-hidden" id="footnote-label">Footnotes</h2>
  <div>
    <p>Justin Chill © 2024. Thanks for reading!</p>
    <span><a href="https://github.com/JustinChill/JustinChill.github.io" target="_blank"><img src="imgs/github.svg" class="icon">Source code and feedback</a></span>    
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/d3"></script>
<script src="https://cdn.jsdelivr.net/npm/@observablehq/plot"></script>

<script type="text/javascript">
  // Use Promises to async request data
  var promises = [d3.csv("data/caffeine.csv",d3.autoType)];
  var element = d3.select('figure').node();
  var width = element.getBoundingClientRect().width; // get width of article so graphic is responsive
  var size = 12;
  var scheme = "tableau10";

  var boxY = function boxY(data, {
    x = null,
    y = {transform: x => x},
    fill = "#ccc",
    stroke = "currentColor",
  } = {}) {
    const group = x == null ? Plot.groupZ : Plot.groupX;
    return Plot.marks(
      Plot.ruleX(data, group({y1: iqr1, y2: iqr2}, {x, y, stroke})),
      Plot.barY(data, group({y1: quartile1, y2: quartile3}, {x, y, fill})),
      Plot.tickY(data, group({y: "median"}, {x, y, stroke, strokeWidth: 2})),
      Plot.dot(data, Plot.map({y: outliers}, {x, y, z: x, stroke}))
      );
  };
  var outliers = function outliers(values) {
    const r1 = iqr1(values);
    const r2 = iqr2(values);
    return values.map(v => v < r1 || v > r2 ? v : NaN);
  };

  var iqr1 = V => {
    const hi = quartile1(V);
    const lo = hi - 1.5 * (quartile3(V) - hi);
    return d3.min(V, v => lo <= v && v <= hi ? v : NaN);
  };

  var iqr2 = V => {
    const lo = quartile3(V);
    const hi = lo + 1.5 * (lo - quartile1(V));
    return d3.max(V, v => lo <= v && v <= hi ? v : NaN);
  };
  var quartile1 = V => d3.quantile(V, 0.25);
  var quartile3 = V => d3.quantile(V, 0.75);

  // You can request multiple srcs in a promise
  myDataPromises = Promise.all(promises);

  // After data is successfully fetched, generate viz
  myDataPromises.then(function(data) {
    // Define the data
    var caffeine = data[0];

    var caffeine_bar = {
      width: width,
      style:{fontSize: size},
      marginLeft: width/5,
      marginRight: width/33,
      x: {
        labelOffset: 40,
        grid: true,
        nice: true,
        labelAnchor: "center",
      },
      color: {
        type: "categorical",
        scheme: scheme,
      },
      y: {
        label: null,
        reverse: true,
        domain: d3.sort(caffeine, d => -d["Caffeine (mg)"]).map(d => d.Item),
        tickSize: 0,
      },
      marks: [
        Plot.axisY({anchor: "left", labelAnchor: "top", lineWidth: 10, tickSize: 0}),
        Plot.barX(caffeine, { x: "Caffeine (mg)", inset: 1, y: "Item", fill:"Class", tip: "xy"}),
        Plot.text(caffeine, {x: "Caffeine (mg)", y: "Item", text: (d) => `${d["Caffeine (mg)"]} mg`, textAnchor: "start", dx: 5}),
        ]
    };

    var caffeine_box = {
      width: width,
      style:{fontSize: size},
      marginLeft: width/20,
      marginRight: width/100,
      marginBottom: 30,
      marginTop: 20,
      y: {
        grid: true,
        inset: 6,
        anchor: "left",
        labelAnchor: "top",
      },
      x:{ 
        label: width > 450 ? "Class" : "", 
        labelOffset: 50, 
        tickRotate: width > 450 ? 0 : -30,
        domain: d3.sort(caffeine, d => -d["Caffeine (mg)"]).map(d => d.Class)
      },
      color: {
        type: "categorical",
        scheme: scheme,
      },
      marks: [
        boxY(caffeine, {
          x: "Class", 
          y: "Caffeine (mg)", 
          fill: "Class"})
        ]
    };

    var caffeine_class = {
      width: width,
      style:{fontSize: size},
      marginTop: 30,
      marginBottom: 100,
      marginLeft: width/20,
      marginRight: width/100,
      x: {
        tickRotate: -35,
        tickSize: 0,
        label: null,
        lineWidth: 8,        
      },
      y: {
        grid: true,
        tickSize: 0,
        anchor: "left",
        labelAnchor: "top",
      },
      marks: [
        Plot.barY(caffeine.filter(d => (d.Class === "Hot Drink")), {x: "Item", y: "Caffeine (mg)", fill: "Class", tip: "x", sort: {x: "-y"}},)
        ]
    };

    var caffeine_facet = {
      width: width - 20,
      style:{fontSize: size},
      // y: {label: "↑ Highway mpg", ticks: 6, labelOffset: 90},
      marginLeft: width/20,
      marginRight: width/100,
      marginTop: 40,
      // marginBottom: 50,
      inset: 4,
      color: {
        type: "categorical",
        scheme: scheme,
      },
      x: {
        label: null, 
        ticks: 2, 
        labelOffset: 50, 
        axis: null,
      },
      facet: {
        data : caffeine,
        x: "Class",
        label: null,
      },
      marks: [
        Plot.dot(caffeine, {x: "Class", y: "Caffeine (mg)", stroke: "Class", strokeWidth: 1, fill: "Class", tip: "x",}),
        Plot.frame({stroke: "#ccc"}),
        ]
    };

    document.getElementById("caffeine_bar").appendChild(Plot.plot(caffeine_bar));
    document.getElementById("caffeine_box").appendChild(Plot.plot(caffeine_box));
    document.getElementById("caffeine_class").appendChild(Plot.plot(caffeine_class));
    document.getElementById("caffeine_facet").appendChild(Plot.plot(caffeine_facet));
  });
</script>
</body>
</html>